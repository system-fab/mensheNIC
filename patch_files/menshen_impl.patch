diff -ruN '--exclude=.git' '--exclude=p4c' menshen/action/action_engine.v parametric_menshen/action/action_engine.v
--- menshen/action/action_engine.v	2025-05-06 16:14:21.366210000 +0200
+++ parametric_menshen/action/action_engine.v	2025-05-06 16:51:43.106256295 +0200
@@ -88,7 +88,7 @@
 reg							page_tbl_out_valid, page_tbl_out_valid_next;
 // reg							page_tbl_out_valid_d1;
 // output from ram
-wire [15:0]					page_tbl_out;
+reg [15:0]					page_tbl_out;
 // reg [15:0]					page_tbl_out_d1;
 
 /********intermediate variables declared here********/
@@ -210,11 +210,13 @@
 		vlan_fifo_state <= VLAN_FIFO_IDLE;
 		act_vlan_ready <= 1;
 		page_tbl_out_valid <= 0;
+		page_tbl_out <= 0;
 	end
 	else begin
 		vlan_fifo_state <= vlan_fifo_state_next;
 		act_vlan_ready <= act_vlan_ready_next;
 		page_tbl_out_valid <= page_tbl_out_valid_next;
+		page_tbl_out <= page_tbl_out_r;
 	end
 end
 
@@ -401,408 +403,191 @@
     CONTROL PATH
 */
 
-generate 
-	if (C_S_AXIS_DATA_WIDTH == 512) begin
-		/****control path for 512b*****/
-		wire [7:0]          mod_id; //module ID
-		wire [15:0]         control_flag; //dst udp port num
-		reg  [7:0]          c_index; //table index(addr)
-		reg                 c_wr_en; //enable table write(wen)
-		reg [15:0]			entry_reg;
-		
-		reg  [2:0]          c_state;
-		
-		localparam IDLE_C = 0,
-		           WRITE_C = 1,
-				   SU_WRITE_C = 2;
-		
-		assign mod_id = c_s_axis_tdata[368+:8];
-		assign control_flag = c_s_axis_tdata[335:320];
-		
-		//LE to BE switching
-		wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
-		assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
-											c_s_axis_tdata[8+:8],
-											c_s_axis_tdata[16+:8],
-											c_s_axis_tdata[24+:8],
-											c_s_axis_tdata[32+:8],
-											c_s_axis_tdata[40+:8],
-											c_s_axis_tdata[48+:8],
-											c_s_axis_tdata[56+:8],
-											c_s_axis_tdata[64+:8],
-											c_s_axis_tdata[72+:8],
-											c_s_axis_tdata[80+:8],
-											c_s_axis_tdata[88+:8],
-											c_s_axis_tdata[96+:8],
-											c_s_axis_tdata[104+:8],
-											c_s_axis_tdata[112+:8],
-											c_s_axis_tdata[120+:8],
-											c_s_axis_tdata[128+:8],
-											c_s_axis_tdata[136+:8],
-											c_s_axis_tdata[144+:8],
-											c_s_axis_tdata[152+:8],
-											c_s_axis_tdata[160+:8],
-											c_s_axis_tdata[168+:8],
-											c_s_axis_tdata[176+:8],
-											c_s_axis_tdata[184+:8],
-											c_s_axis_tdata[192+:8],
-											c_s_axis_tdata[200+:8],
-											c_s_axis_tdata[208+:8],
-											c_s_axis_tdata[216+:8],
-											c_s_axis_tdata[224+:8],
-											c_s_axis_tdata[232+:8],
-											c_s_axis_tdata[240+:8],
-											c_s_axis_tdata[248+:8],
-		                                    c_s_axis_tdata[256+:8],
-		                                    c_s_axis_tdata[264+:8],
-		                                    c_s_axis_tdata[272+:8],
-		                                    c_s_axis_tdata[280+:8],
-		                                    c_s_axis_tdata[288+:8],
-		                                    c_s_axis_tdata[296+:8],
-		                                    c_s_axis_tdata[304+:8],
-		                                    c_s_axis_tdata[312+:8],
-		                                    c_s_axis_tdata[320+:8],
-		                                    c_s_axis_tdata[328+:8],
-		                                    c_s_axis_tdata[336+:8],
-		                                    c_s_axis_tdata[344+:8],
-		                                    c_s_axis_tdata[352+:8],
-		                                    c_s_axis_tdata[360+:8],
-		                                    c_s_axis_tdata[368+:8],
-		                                    c_s_axis_tdata[376+:8],
-		                                    c_s_axis_tdata[384+:8],
-		                                    c_s_axis_tdata[392+:8],
-		                                    c_s_axis_tdata[400+:8],
-		                                    c_s_axis_tdata[408+:8],
-		                                    c_s_axis_tdata[416+:8],
-		                                    c_s_axis_tdata[424+:8],
-		                                    c_s_axis_tdata[432+:8],
-		                                    c_s_axis_tdata[440+:8],
-		                                    c_s_axis_tdata[448+:8],
-		                                    c_s_axis_tdata[456+:8],
-		                                    c_s_axis_tdata[464+:8],
-		                                    c_s_axis_tdata[472+:8],
-		                                    c_s_axis_tdata[480+:8],
-		                                    c_s_axis_tdata[488+:8],
-		                                    c_s_axis_tdata[496+:8],
-		                                    c_s_axis_tdata[504+:8]
-		                                };
-		
-		always @(posedge clk or negedge rst_n) begin
-		    if(~rst_n) begin
-		        c_wr_en <= 1'b0;
-		        c_index <= 4'b0;
-		
-		        c_m_axis_tdata <= 0;
-		        c_m_axis_tuser <= 0;
-		        c_m_axis_tkeep <= 0;
-		        c_m_axis_tvalid <= 0;
-		        c_m_axis_tlast <= 0;
-
-				entry_reg <= 0;
-		
-		        c_state <= IDLE_C;
-		    end
-		    else begin
-		        case(c_state)
-		            IDLE_C: begin
-		                if(c_s_axis_tvalid && mod_id[7:3] == STAGE_ID && mod_id[2:0] == ACTION_ID && control_flag == 16'hf2f1)begin
-		                    c_wr_en <= 1'b0;
-		                    c_index <= c_s_axis_tdata[384+:8];
-		
-		                    c_m_axis_tdata <= 0;
-		                    c_m_axis_tuser <= 0;
-		                    c_m_axis_tkeep <= 0;
-		                    c_m_axis_tvalid <= 0;
-		                    c_m_axis_tlast <= 0;
-		
-		                    c_state <= WRITE_C;
-		
-		                end
-		                else begin
-		                    c_wr_en <= 1'b0;
-		                    c_index <= 4'b0; 
-		
-		                    c_m_axis_tdata <= c_s_axis_tdata;
-		                    c_m_axis_tuser <= c_s_axis_tuser;
-		                    c_m_axis_tkeep <= c_s_axis_tkeep;
-		                    c_m_axis_tvalid <= c_s_axis_tvalid;
-		                    c_m_axis_tlast <= c_s_axis_tlast;
-		
-		                    c_state <= IDLE_C;
-		                end
-		            end
-		            //support full table flush
-					WRITE_C: begin
-						if(c_s_axis_tvalid) begin
-							c_wr_en <= 1'b1;
-							entry_reg <= c_s_axis_tdata_swapped[511 -: 16];
-							if(c_s_axis_tlast) begin
-								c_state <= IDLE_C;
-							end
-							else begin
-								c_state <= SU_WRITE_C;
-							end
-						end
-						else begin
-							c_wr_en <= 1'b0;
-						end
-					end
-
-					SU_WRITE_C: begin
-						if(c_s_axis_tvalid) begin
-							entry_reg <= c_s_axis_tdata_swapped[511 -: 16];
-							c_wr_en <= 1'b1;
-							c_index <= c_index + 1'b1;
-							if(c_s_axis_tlast) begin
-								c_state <= IDLE_C;
-							end
-							else begin
-								c_state <= SU_WRITE_C;
-							end
-						end
-						else begin
-							c_wr_en <= 1'b0;
-						end
-					end
-		        endcase
-		
-		    end
-		end
-		
-		
-		//page table
-		page_tbl_16w_32d
-		page_tbl_16w_32d
-		(
-		    //write
-		    .addra(c_index[4:0]),
-		    .clka(clk),
-		    .dina(entry_reg),
-		    .ena(1'b1),
-		    .wea(c_wr_en),
-		
-		    //match
-		    .addrb(act_vlan_in[8:4]),
-		    .clkb(clk),
-		    .doutb(page_tbl_out),
-		    .enb(1'b1)
-		);
-	end
-	else begin // control path for 256b
-		wire [7:0]          mod_id; //module ID
-		wire [15:0]         control_flag; //dst udp port num
-		wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
-		assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
-											c_s_axis_tdata[8+:8],
-											c_s_axis_tdata[16+:8],
-											c_s_axis_tdata[24+:8],
-											c_s_axis_tdata[32+:8],
-											c_s_axis_tdata[40+:8],
-											c_s_axis_tdata[48+:8],
-											c_s_axis_tdata[56+:8],
-											c_s_axis_tdata[64+:8],
-											c_s_axis_tdata[72+:8],
-											c_s_axis_tdata[80+:8],
-											c_s_axis_tdata[88+:8],
-											c_s_axis_tdata[96+:8],
-											c_s_axis_tdata[104+:8],
-											c_s_axis_tdata[112+:8],
-											c_s_axis_tdata[120+:8],
-											c_s_axis_tdata[128+:8],
-											c_s_axis_tdata[136+:8],
-											c_s_axis_tdata[144+:8],
-											c_s_axis_tdata[152+:8],
-											c_s_axis_tdata[160+:8],
-											c_s_axis_tdata[168+:8],
-											c_s_axis_tdata[176+:8],
-											c_s_axis_tdata[184+:8],
-											c_s_axis_tdata[192+:8],
-											c_s_axis_tdata[200+:8],
-											c_s_axis_tdata[208+:8],
-											c_s_axis_tdata[216+:8],
-											c_s_axis_tdata[224+:8],
-											c_s_axis_tdata[232+:8],
-											c_s_axis_tdata[240+:8],
-											c_s_axis_tdata[248+:8]};
-
-        assign mod_id = c_s_axis_tdata[112+:8];
-        assign control_flag = c_s_axis_tdata[64+:16];
-		localparam	IDLE_C = 0,
-					PARSE_C = 1,
-					RAM_ENTRY = 2,
-					FLUSH_REST_C = 3;
-		// 
-		reg [2:0] c_state, c_state_next;
-		reg [C_S_AXIS_DATA_WIDTH-1:0]		r_tdata, c_s_axis_tdata_d1;
-		reg [C_S_AXIS_TUSER_WIDTH-1:0]		r_tuser, c_s_axis_tuser_d1;
-		reg [C_S_AXIS_DATA_WIDTH/8-1:0]		r_tkeep, c_s_axis_tkeep_d1;
-		reg									r_tlast, c_s_axis_tlast_d1;
-		reg									r_tvalid, c_s_axis_tvalid_d1;
-
-		reg [C_S_AXIS_DATA_WIDTH-1:0]		r_1st_tdata, r_1st_tdata_next;
-		reg [C_S_AXIS_TUSER_WIDTH-1:0]		r_1st_tuser, r_1st_tuser_next;
-		reg [C_S_AXIS_DATA_WIDTH/8-1:0]		r_1st_tkeep, r_1st_tkeep_next;
-		reg									r_1st_tlast, r_1st_tlast_next;
-		reg									r_1st_tvalid, r_1st_tvalid_next;
-
-		reg [15:0]							c_wr_data_next, c_wr_data;
-		reg [7:0]							c_index_next, c_index;
-		reg									c_wr_en_next, c_wr_en;
-
-		always @(*) begin
-			c_state_next = c_state;
-
-			r_tdata = 0;
-			r_tkeep = 0;
-			r_tuser = 0;
-			r_tlast = 0;
-			r_tvalid = 0;
-
-			r_1st_tdata_next = r_1st_tdata;
-			r_1st_tkeep_next = r_1st_tkeep;
-			r_1st_tuser_next = r_1st_tuser;
-			r_1st_tlast_next = r_1st_tlast;
-			r_1st_tvalid_next = r_1st_tvalid;
-
-			c_index_next = c_index;
-			c_wr_en_next = 0;
-			c_wr_data_next = c_wr_data;
-
-			case (c_state) 
-				IDLE_C: begin // 1st segment
-					r_tvalid = 0;
-					if (c_s_axis_tvalid) begin
-						// store 1st segment
-						r_1st_tdata_next = c_s_axis_tdata;
-						r_1st_tuser_next = c_s_axis_tuser;
-						r_1st_tkeep_next = c_s_axis_tkeep;
-						r_1st_tlast_next = c_s_axis_tlast;
-						r_1st_tvalid_next = c_s_axis_tvalid;
-
-						c_state_next = PARSE_C;
-					end
-				end
-				PARSE_C: begin // 2nd segment
-					if (mod_id[7:3] == STAGE_ID && mod_id[2:0] == ACTION_ID && 
-						control_flag == 16'hf2f1 && c_s_axis_tvalid) begin
-						// should not emit segment
-						c_index_next = c_s_axis_tdata[128+:8];
-						c_state_next = RAM_ENTRY;
-					end
-					else if (!c_s_axis_tvalid) begin
-					end
-					else begin
-						// emit
-						r_tdata = r_1st_tdata;
-						r_tkeep = r_1st_tkeep;
-						r_tuser = r_1st_tuser;
-						r_tlast = r_1st_tlast;
-						r_tvalid = r_1st_tvalid;
-						c_state_next = FLUSH_REST_C;
-					end
-				end
-				RAM_ENTRY: begin // 3rd segment
-					if (c_s_axis_tvalid) begin
-						c_wr_en_next = 1; // next clk to write
-						c_wr_data_next = c_s_axis_tdata_swapped[255-:16];
-						
-						c_state_next = FLUSH_REST_C;
-					end
-				end
-				FLUSH_REST_C: begin
-					c_wr_en_next = 0;
-					r_tdata = c_s_axis_tdata_d1;
-					r_tkeep = c_s_axis_tkeep_d1;
-					r_tuser = c_s_axis_tuser_d1;
-					r_tlast = c_s_axis_tlast_d1;
-					r_tvalid = c_s_axis_tvalid_d1;
-					if (c_s_axis_tvalid_d1 && c_s_axis_tlast_d1) begin
-						c_state_next = IDLE_C;
-					end
-				end
-			endcase
-		end
+generate
+    /****control path for 512b*****/
+    wire [7:0]          mod_id; //module ID
+    wire [15:0]         control_flag; //dst udp port num
+    reg  [7:0]          c_index; //table index(addr)
+    reg                 c_wr_en; //enable table write(wen)
+    reg [15:0]			entry_reg;
+
+    reg  [2:0]          c_state;
+
+    localparam IDLE_C = 0,
+               WRITE_C = 1,
+		       SU_WRITE_C = 2;
+
+    assign mod_id = c_s_axis_tdata[368+:8];
+    assign control_flag = c_s_axis_tdata[303:288];
+
+    //LE to BE switching
+    wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
+    assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
+									    c_s_axis_tdata[8+:8],
+									    c_s_axis_tdata[16+:8],
+									    c_s_axis_tdata[24+:8],
+									    c_s_axis_tdata[32+:8],
+									    c_s_axis_tdata[40+:8],
+									    c_s_axis_tdata[48+:8],
+									    c_s_axis_tdata[56+:8],
+									    c_s_axis_tdata[64+:8],
+									    c_s_axis_tdata[72+:8],
+									    c_s_axis_tdata[80+:8],
+									    c_s_axis_tdata[88+:8],
+									    c_s_axis_tdata[96+:8],
+									    c_s_axis_tdata[104+:8],
+									    c_s_axis_tdata[112+:8],
+									    c_s_axis_tdata[120+:8],
+									    c_s_axis_tdata[128+:8],
+									    c_s_axis_tdata[136+:8],
+									    c_s_axis_tdata[144+:8],
+									    c_s_axis_tdata[152+:8],
+									    c_s_axis_tdata[160+:8],
+									    c_s_axis_tdata[168+:8],
+									    c_s_axis_tdata[176+:8],
+									    c_s_axis_tdata[184+:8],
+									    c_s_axis_tdata[192+:8],
+									    c_s_axis_tdata[200+:8],
+									    c_s_axis_tdata[208+:8],
+									    c_s_axis_tdata[216+:8],
+									    c_s_axis_tdata[224+:8],
+									    c_s_axis_tdata[232+:8],
+									    c_s_axis_tdata[240+:8],
+									    c_s_axis_tdata[248+:8],
+                                        c_s_axis_tdata[256+:8],
+                                        c_s_axis_tdata[264+:8],
+                                        c_s_axis_tdata[272+:8],
+                                        c_s_axis_tdata[280+:8],
+                                        c_s_axis_tdata[288+:8],
+                                        c_s_axis_tdata[296+:8],
+                                        c_s_axis_tdata[304+:8],
+                                        c_s_axis_tdata[312+:8],
+                                        c_s_axis_tdata[320+:8],
+                                        c_s_axis_tdata[328+:8],
+                                        c_s_axis_tdata[336+:8],
+                                        c_s_axis_tdata[344+:8],
+                                        c_s_axis_tdata[352+:8],
+                                        c_s_axis_tdata[360+:8],
+                                        c_s_axis_tdata[368+:8],
+                                        c_s_axis_tdata[376+:8],
+                                        c_s_axis_tdata[384+:8],
+                                        c_s_axis_tdata[392+:8],
+                                        c_s_axis_tdata[400+:8],
+                                        c_s_axis_tdata[408+:8],
+                                        c_s_axis_tdata[416+:8],
+                                        c_s_axis_tdata[424+:8],
+                                        c_s_axis_tdata[432+:8],
+                                        c_s_axis_tdata[440+:8],
+                                        c_s_axis_tdata[448+:8],
+                                        c_s_axis_tdata[456+:8],
+                                        c_s_axis_tdata[464+:8],
+                                        c_s_axis_tdata[472+:8],
+                                        c_s_axis_tdata[480+:8],
+                                        c_s_axis_tdata[488+:8],
+                                        c_s_axis_tdata[496+:8],
+                                        c_s_axis_tdata[504+:8]
+                                    };
+
+    always @(posedge clk or negedge rst_n) begin
+        if(~rst_n) begin
+            c_wr_en <= 1'b0;
+            c_index <= 4'b0;
+
+            c_m_axis_tdata <= 0;
+            c_m_axis_tuser <= 0;
+            c_m_axis_tkeep <= 0;
+            c_m_axis_tvalid <= 0;
+            c_m_axis_tlast <= 0;
+
+		    entry_reg <= 0;
+
+            c_state <= IDLE_C;
+        end
+        else begin
+            case(c_state)
+                IDLE_C: begin
+                    if(c_s_axis_tvalid && mod_id[7:3] == STAGE_ID && mod_id[2:0] == ACTION_ID && control_flag == 16'hf2f1)begin
+                        c_wr_en <= 1'b0;
+                        c_index <= c_s_axis_tdata[384+:8];
+
+                        c_m_axis_tdata <= 0;
+                        c_m_axis_tuser <= 0;
+                        c_m_axis_tkeep <= 0;
+                        c_m_axis_tvalid <= 0;
+                        c_m_axis_tlast <= 0;
+
+                        c_state <= WRITE_C;
+
+                    end
+                    else begin
+                        c_wr_en <= 1'b0;
+                        c_index <= 4'b0; 
+
+                        c_m_axis_tdata <= c_s_axis_tdata;
+                        c_m_axis_tuser <= c_s_axis_tuser;
+                        c_m_axis_tkeep <= c_s_axis_tkeep;
+                        c_m_axis_tvalid <= c_s_axis_tvalid;
+                        c_m_axis_tlast <= c_s_axis_tlast;
+
+                        c_state <= IDLE_C;
+                    end
+                end
+                //support full table flush
+			    WRITE_C: begin
+				    if(c_s_axis_tvalid) begin
+					    c_wr_en <= 1'b1;
+					    entry_reg <= c_s_axis_tdata_swapped[511 -: 16];
+					    if(c_s_axis_tlast) begin
+						    c_state <= IDLE_C;
+					    end
+					    else begin
+						    c_state <= SU_WRITE_C;
+					    end
+				    end
+				    else begin
+					    c_wr_en <= 1'b0;
+				    end
+			    end
+
+			    SU_WRITE_C: begin
+				    if(c_s_axis_tvalid) begin
+					    entry_reg <= c_s_axis_tdata_swapped[511 -: 16];
+					    c_wr_en <= 1'b1;
+					    c_index <= c_index + 1'b1;
+					    if(c_s_axis_tlast) begin
+						    c_state <= IDLE_C;
+					    end
+					    else begin
+						    c_state <= SU_WRITE_C;
+					    end
+				    end
+				    else begin
+					    c_wr_en <= 1'b0;
+				    end
+			    end
+            endcase
 
-		always @(posedge clk) begin
-			if (~rst_n) begin
-				c_state <= IDLE_C;
-
-				// control output
-				c_m_axis_tdata <= 0;
-				c_m_axis_tuser <= 0;
-				c_m_axis_tkeep <= 0;
-				c_m_axis_tlast <= 0;
-				c_m_axis_tvalid <= 0;
-				//
-				c_index <= 0;
-				c_wr_en <= 0;
-				c_wr_data <= 0;
-			end
-			else begin
-				c_state <= c_state_next;
+        end
+    end
 
 
-				// output ctrl master signals
-				c_m_axis_tdata <= r_tdata;
-				c_m_axis_tkeep <= r_tkeep;
-				c_m_axis_tuser <= r_tuser;
-				c_m_axis_tlast <= r_tlast;
-				c_m_axis_tvalid <= r_tvalid;
-				//
-				c_index <= c_index_next;
-				c_wr_en <= c_wr_en_next;
-				c_wr_data <= c_wr_data_next;
-			end
-		end
-
-		always @(posedge clk) begin
-			if (~rst_n) begin
-				// delayed 1 clk
-				c_s_axis_tdata_d1 <= 0;
-				c_s_axis_tuser_d1 <= 0;
-				c_s_axis_tkeep_d1 <= 0;
-				c_s_axis_tlast_d1 <= 0;
-				c_s_axis_tvalid_d1 <= 0;
-				//
-				r_1st_tdata <= 0;
-				r_1st_tkeep <= 0;
-				r_1st_tuser <= 0;
-				r_1st_tlast <= 0;
-				r_1st_tvalid <= 0;
-			end
-			else begin
-				// delayed 1 clk
-				c_s_axis_tdata_d1 <= c_s_axis_tdata;
-				c_s_axis_tuser_d1 <= c_s_axis_tuser;
-				c_s_axis_tkeep_d1 <= c_s_axis_tkeep;
-				c_s_axis_tlast_d1 <= c_s_axis_tlast;
-				c_s_axis_tvalid_d1 <= c_s_axis_tvalid;
-				// 
-				r_1st_tdata <= r_1st_tdata_next;
-				r_1st_tkeep <= r_1st_tkeep_next;
-				r_1st_tuser <= r_1st_tuser_next;
-				r_1st_tlast <= r_1st_tlast_next;
-				r_1st_tvalid <= r_1st_tvalid_next;
-			end
-		end
-		//page table
-		page_tbl_16w_32d
-		page_tbl_16w_32d
-		(
-		    //write
-		    .addra(c_index[4:0]),
-		    .clka(clk),
-		    .dina(c_wr_data),
-		    .ena(1'b1),
-		    .wea(c_wr_en),
-		
-		    //match
-		    .addrb(act_vlan_in[8:4]),
-		    .clkb(clk),
-		    .doutb(page_tbl_out),
-		    .enb(1'b1)
-		);
-	end
+    //page table
+    page_tbl_16w_32d
+    page_tbl_16w_32d
+    (
+        //write
+        .addra(c_index[4:0]),
+        .clka(clk),
+        .dina(entry_reg),
+        .ena(1'b1),
+        .wea(c_wr_en),
+
+        //match
+        .addrb(act_vlan_in[8:4]),
+        .clkb(clk),
+        .doutb(page_tbl_out_r),
+        .enb(1'b1)
+    );
 endgenerate
 
 
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/action/crossbar.v parametric_menshen/action/crossbar.v
--- menshen/action/crossbar.v	2025-05-06 16:14:21.366210000 +0200
+++ parametric_menshen/action/crossbar.v	2025-05-06 16:51:43.106256295 +0200
@@ -48,71 +48,91 @@
 wire [ACT_LEN-1:0]       sub_action [24:0];
 
 
+reg [PHV_LEN-1:0]         phv_in_r;
+reg                       phv_in_valid_r;
+reg [ACT_LEN*25-1:0]      action_in_r;
+reg                       action_in_valid_r;
+
+always @(posedge clk) begin
+	if (~rst_n) begin
+		phv_in_r <= 0;
+		phv_in_valid_r <= 0;
+		action_in_r <= 0;
+		action_in_valid_r <= 0;
+	end
+	else begin
+		phv_in_r <= phv_in;
+		phv_in_valid_r <= phv_in_valid;
+		action_in_r <= action_in;
+		action_in_valid_r <= action_in_valid;
+	end
+end
+
 /********intermediate variables declared here********/
 
-assign cont_6B[7] = phv_in[PHV_LEN-1            -: width_6B];
-assign cont_6B[6] = phv_in[PHV_LEN-1-  width_6B -: width_6B];
-assign cont_6B[5] = phv_in[PHV_LEN-1-2*width_6B -: width_6B];
-assign cont_6B[4] = phv_in[PHV_LEN-1-3*width_6B -: width_6B];
-assign cont_6B[3] = phv_in[PHV_LEN-1-4*width_6B -: width_6B];
-assign cont_6B[2] = phv_in[PHV_LEN-1-5*width_6B -: width_6B];
-assign cont_6B[1] = phv_in[PHV_LEN-1-6*width_6B -: width_6B];
-assign cont_6B[0] = phv_in[PHV_LEN-1-7*width_6B -: width_6B];
-
-assign cont_4B[7] = phv_in[PHV_LEN-1-8*width_6B           -: width_4B];
-assign cont_4B[6] = phv_in[PHV_LEN-1-8*width_6B-  width_4B -: width_4B];
-assign cont_4B[5] = phv_in[PHV_LEN-1-8*width_6B-2*width_4B -: width_4B];
-assign cont_4B[4] = phv_in[PHV_LEN-1-8*width_6B-3*width_4B -: width_4B];
-assign cont_4B[3] = phv_in[PHV_LEN-1-8*width_6B-4*width_4B -: width_4B];
-assign cont_4B[2] = phv_in[PHV_LEN-1-8*width_6B-5*width_4B -: width_4B];
-assign cont_4B[1] = phv_in[PHV_LEN-1-8*width_6B-6*width_4B -: width_4B];
-assign cont_4B[0] = phv_in[PHV_LEN-1-8*width_6B-7*width_4B -: width_4B];
-
-
-assign cont_2B[7] = phv_in[PHV_LEN-1-8*width_6B-8*width_4B            -: width_2B];
-assign cont_2B[6] = phv_in[PHV_LEN-1-8*width_6B-8*width_4B-  width_2B -: width_2B];
-assign cont_2B[5] = phv_in[PHV_LEN-1-8*width_6B-8*width_4B-2*width_2B -: width_2B];
-assign cont_2B[4] = phv_in[PHV_LEN-1-8*width_6B-8*width_4B-3*width_2B -: width_2B];
-assign cont_2B[3] = phv_in[PHV_LEN-1-8*width_6B-8*width_4B-4*width_2B -: width_2B];
-assign cont_2B[2] = phv_in[PHV_LEN-1-8*width_6B-8*width_4B-5*width_2B -: width_2B];
-assign cont_2B[1] = phv_in[PHV_LEN-1-8*width_6B-8*width_4B-6*width_2B -: width_2B];
-assign cont_2B[0] = phv_in[PHV_LEN-1-8*width_6B-8*width_4B-7*width_2B -: width_2B];
+assign cont_6B[7] = phv_in_r[PHV_LEN-1            -: width_6B];
+assign cont_6B[6] = phv_in_r[PHV_LEN-1-  width_6B -: width_6B];
+assign cont_6B[5] = phv_in_r[PHV_LEN-1-2*width_6B -: width_6B];
+assign cont_6B[4] = phv_in_r[PHV_LEN-1-3*width_6B -: width_6B];
+assign cont_6B[3] = phv_in_r[PHV_LEN-1-4*width_6B -: width_6B];
+assign cont_6B[2] = phv_in_r[PHV_LEN-1-5*width_6B -: width_6B];
+assign cont_6B[1] = phv_in_r[PHV_LEN-1-6*width_6B -: width_6B];
+assign cont_6B[0] = phv_in_r[PHV_LEN-1-7*width_6B -: width_6B];
+
+assign cont_4B[7] = phv_in_r[PHV_LEN-1-8*width_6B           -: width_4B];
+assign cont_4B[6] = phv_in_r[PHV_LEN-1-8*width_6B-  width_4B -: width_4B];
+assign cont_4B[5] = phv_in_r[PHV_LEN-1-8*width_6B-2*width_4B -: width_4B];
+assign cont_4B[4] = phv_in_r[PHV_LEN-1-8*width_6B-3*width_4B -: width_4B];
+assign cont_4B[3] = phv_in_r[PHV_LEN-1-8*width_6B-4*width_4B -: width_4B];
+assign cont_4B[2] = phv_in_r[PHV_LEN-1-8*width_6B-5*width_4B -: width_4B];
+assign cont_4B[1] = phv_in_r[PHV_LEN-1-8*width_6B-6*width_4B -: width_4B];
+assign cont_4B[0] = phv_in_r[PHV_LEN-1-8*width_6B-7*width_4B -: width_4B];
+
+
+assign cont_2B[7] = phv_in_r[PHV_LEN-1-8*width_6B-8*width_4B            -: width_2B];
+assign cont_2B[6] = phv_in_r[PHV_LEN-1-8*width_6B-8*width_4B-  width_2B -: width_2B];
+assign cont_2B[5] = phv_in_r[PHV_LEN-1-8*width_6B-8*width_4B-2*width_2B -: width_2B];
+assign cont_2B[4] = phv_in_r[PHV_LEN-1-8*width_6B-8*width_4B-3*width_2B -: width_2B];
+assign cont_2B[3] = phv_in_r[PHV_LEN-1-8*width_6B-8*width_4B-4*width_2B -: width_2B];
+assign cont_2B[2] = phv_in_r[PHV_LEN-1-8*width_6B-8*width_4B-5*width_2B -: width_2B];
+assign cont_2B[1] = phv_in_r[PHV_LEN-1-8*width_6B-8*width_4B-6*width_2B -: width_2B];
+assign cont_2B[0] = phv_in_r[PHV_LEN-1-8*width_6B-8*width_4B-7*width_2B -: width_2B];
 
 // Tao: get action for each PHV container
-assign sub_action[24] = action_in[ACT_LEN*25-1-:ACT_LEN];					// 1st action
-assign sub_action[23] = action_in[ACT_LEN*25-1 -  ACT_LEN-:ACT_LEN];		// 2nd action
-assign sub_action[22] = action_in[ACT_LEN*25-1 -2*ACT_LEN-:ACT_LEN];		// 3rd action
-assign sub_action[21] = action_in[ACT_LEN*25-1 -3*ACT_LEN-:ACT_LEN];
-assign sub_action[20] = action_in[ACT_LEN*25-1 -4*ACT_LEN-:ACT_LEN];
-assign sub_action[19] = action_in[ACT_LEN*25-1 -5*ACT_LEN-:ACT_LEN];
-assign sub_action[18] = action_in[ACT_LEN*25-1 -6*ACT_LEN-:ACT_LEN];
-assign sub_action[17] = action_in[ACT_LEN*25-1 -7*ACT_LEN-:ACT_LEN];
-
-assign sub_action[16] = action_in[ACT_LEN*25-1 -8*ACT_LEN-:ACT_LEN];
-assign sub_action[15] = action_in[ACT_LEN*25-1 -9*ACT_LEN-:ACT_LEN];
-assign sub_action[14] = action_in[ACT_LEN*25-1 -10*ACT_LEN-:ACT_LEN];
-assign sub_action[13] = action_in[ACT_LEN*25-1 -11*ACT_LEN-:ACT_LEN];
-assign sub_action[12] = action_in[ACT_LEN*25-1 -12*ACT_LEN-:ACT_LEN];
-assign sub_action[11] = action_in[ACT_LEN*25-1 -13*ACT_LEN-:ACT_LEN];
-assign sub_action[10] = action_in[ACT_LEN*25-1 -14*ACT_LEN-:ACT_LEN];
-assign sub_action[9] = action_in[ACT_LEN*25-1 -15*ACT_LEN-:ACT_LEN];
-
-assign sub_action[8] = action_in[ACT_LEN*25-1 -16*ACT_LEN-:ACT_LEN];
-assign sub_action[7] = action_in[ACT_LEN*25-1 -17*ACT_LEN-:ACT_LEN];
-assign sub_action[6] = action_in[ACT_LEN*25-1 -18*ACT_LEN-:ACT_LEN];
-assign sub_action[5] = action_in[ACT_LEN*25-1 -19*ACT_LEN-:ACT_LEN];
-assign sub_action[4] = action_in[ACT_LEN*25-1 -20*ACT_LEN-:ACT_LEN];
-assign sub_action[3] = action_in[ACT_LEN*25-1 -21*ACT_LEN-:ACT_LEN];
-assign sub_action[2] = action_in[ACT_LEN*25-1 -22*ACT_LEN-:ACT_LEN];
-assign sub_action[1] = action_in[ACT_LEN*25-1 -23*ACT_LEN-:ACT_LEN];
+assign sub_action[24] = action_in_r[ACT_LEN*25-1-:ACT_LEN];					// 1st action
+assign sub_action[23] = action_in_r[ACT_LEN*25-1 -  ACT_LEN-:ACT_LEN];		// 2nd action
+assign sub_action[22] = action_in_r[ACT_LEN*25-1 -2*ACT_LEN-:ACT_LEN];		// 3rd action
+assign sub_action[21] = action_in_r[ACT_LEN*25-1 -3*ACT_LEN-:ACT_LEN];
+assign sub_action[20] = action_in_r[ACT_LEN*25-1 -4*ACT_LEN-:ACT_LEN];
+assign sub_action[19] = action_in_r[ACT_LEN*25-1 -5*ACT_LEN-:ACT_LEN];
+assign sub_action[18] = action_in_r[ACT_LEN*25-1 -6*ACT_LEN-:ACT_LEN];
+assign sub_action[17] = action_in_r[ACT_LEN*25-1 -7*ACT_LEN-:ACT_LEN];
+
+assign sub_action[16] = action_in_r[ACT_LEN*25-1 -8*ACT_LEN-:ACT_LEN];
+assign sub_action[15] = action_in_r[ACT_LEN*25-1 -9*ACT_LEN-:ACT_LEN];
+assign sub_action[14] = action_in_r[ACT_LEN*25-1 -10*ACT_LEN-:ACT_LEN];
+assign sub_action[13] = action_in_r[ACT_LEN*25-1 -11*ACT_LEN-:ACT_LEN];
+assign sub_action[12] = action_in_r[ACT_LEN*25-1 -12*ACT_LEN-:ACT_LEN];
+assign sub_action[11] = action_in_r[ACT_LEN*25-1 -13*ACT_LEN-:ACT_LEN];
+assign sub_action[10] = action_in_r[ACT_LEN*25-1 -14*ACT_LEN-:ACT_LEN];
+assign sub_action[9] = action_in_r[ACT_LEN*25-1 -15*ACT_LEN-:ACT_LEN];
+
+assign sub_action[8] = action_in_r[ACT_LEN*25-1 -16*ACT_LEN-:ACT_LEN];
+assign sub_action[7] = action_in_r[ACT_LEN*25-1 -17*ACT_LEN-:ACT_LEN];
+assign sub_action[6] = action_in_r[ACT_LEN*25-1 -18*ACT_LEN-:ACT_LEN];
+assign sub_action[5] = action_in_r[ACT_LEN*25-1 -19*ACT_LEN-:ACT_LEN];
+assign sub_action[4] = action_in_r[ACT_LEN*25-1 -20*ACT_LEN-:ACT_LEN];
+assign sub_action[3] = action_in_r[ACT_LEN*25-1 -21*ACT_LEN-:ACT_LEN];
+assign sub_action[2] = action_in_r[ACT_LEN*25-1 -22*ACT_LEN-:ACT_LEN];
+assign sub_action[1] = action_in_r[ACT_LEN*25-1 -23*ACT_LEN-:ACT_LEN];
 
-assign sub_action[0] = action_in[ACT_LEN*25-1 -24*ACT_LEN-:ACT_LEN];
+assign sub_action[0] = action_in_r[ACT_LEN*25-1 -24*ACT_LEN-:ACT_LEN];
 
 //assign inputs for ALUs 
 
 always @(posedge clk) begin
-	action_out <= action_in;
-	action_valid_out <= action_in_valid;
+	action_out <= action_in_r;
+	action_valid_out <= action_in_valid_r;
 end
 
 localparam IDLE = 0,
@@ -127,18 +147,8 @@
         // action_full_reg <= 625'b0;
         // phv_valid_reg <= 1'b0;
         // action_valid_reg <= 1'b0;
-        //reset outputs
         alu_in_valid <= 1'b0;
-        phv_remain_data <= 256'b0;
-        //reset all the outputs
-        alu_in_6B_1 <= 384'b0;
-        alu_in_6B_2 <= 384'b0;
-        alu_in_4B_1 <= 256'b0;
-        alu_in_4B_2 <= 256'b0;
-        alu_in_4B_3 <= 256'b0;
-        alu_in_2B_1 <= 128'b0;
-        alu_in_2B_2 <= 128'b0;
-       
+        
 		state <= IDLE;
 		ready_out <= 1;
     end
@@ -147,7 +157,7 @@
 		case (state) 
 			IDLE: begin
 
-				if(phv_in_valid == 1'b1) begin
+				if(phv_in_valid_r == 1'b1) begin
 					if (ready_in) begin
 						alu_in_valid <= 1'b1;
 					end
@@ -155,93 +165,8 @@
 						ready_out <= 0;
 						state <= HALT;
 					end
-        		    //assign values one by one (of course need to consider act format)
-        		    for(i=7; i>=0; i=i-1) begin
-        		        case(sub_action[16+i+1][24:21])
-        		            //be noted that 2 ops need to be the same width
-        		            4'b0001, 4'b0010: begin
-        		                alu_in_6B_1[(i+1)*width_6B-1 -: width_6B] <= cont_6B[sub_action[16+i+1][18:16]];
-        		                alu_in_6B_2[(i+1)*width_6B-1 -: width_6B] <= cont_6B[sub_action[16+i+1][13:11]];
-        		            end
-        		            //extracted from action field (imm)
-        		            4'b1001, 4'b1010: begin
-        		                alu_in_6B_1[(i+1)*width_6B-1 -: width_6B] <= cont_6B[sub_action[16+i+1][18:16]];
-        		                alu_in_6B_2[(i+1)*width_6B-1 -: width_6B] <= {32'b0,sub_action[16+i+1][15:0]};
-        		            end
-							// set operation, operand A set to 0, operand B set to imm
-							4'b1110: begin
-        		                alu_in_6B_1[(i+1)*width_6B-1 -: width_6B] <= 48'b0;
-        		                alu_in_6B_2[(i+1)*width_6B-1 -: width_6B] <= {32'b0,sub_action[16+i+1][15:0]};
-							end
-        		            //if there is no action to take, output the original value
-        		            default: begin
-        		                //alu_1 should be set to the phv value
-        		                alu_in_6B_1[(i+1)*width_6B-1 -: width_6B] <= cont_6B[i];
-        		                alu_in_6B_2[(i+1)*width_6B-1 -: width_6B] <= 48'b0;
-        		            end
-        		        endcase
-        		    end
-        		    //4B is a bit of differernt from 2B and 6B
-        		    for(i=7; i>=0; i=i-1) begin
-        		        alu_in_4B_3[(i+1)*width_4B-1 -: width_4B] <= cont_4B[i];
-        		        casez(sub_action[8+i+1][24:21])
-        		            //be noted that 2 ops need to be the same width
-        		            4'b0001, 4'b0010: begin
-        		                alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][18:16]];
-        		                alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][13:11]];
-        		            end
-        		            4'b1001, 4'b1010: begin
-        		                alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][18:16]];
-        		                alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= {16'b0,sub_action[8+i+1][15:0]};
-        		            end
-							// set operation, operand A set to 0, operand B set to imm
-							4'b1110: begin
-        		                alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= 32'b0;
-        		                alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= {16'b0,sub_action[8+i+1][15:0]};
-							end
-        		            //loadd put here
-        		            4'b1011, 4'b1000, 4'b0111: begin
-        		                alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][18:16]];
-        		                //alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= {16'b0,sub_action[8+i+1][15:0]};
-        		                alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][13:11]];
-        		            end
-        		            //if there is no action to take, output the original value
-        		            default: begin
-        		                //alu_1 should be set to the phv value
-        		                alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= cont_4B[i];
-        		                alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= 32'b0;
-        		            end
-        		        endcase
-        		    end
-        		    for(i=7; i>=0; i=i-1) begin
-        		        casez(sub_action[i+1][24:21])
-        		            //be noted that 2 ops need to be the same width
-        		            4'b0001, 4'b0010: begin
-        		                alu_in_2B_1[(i+1)*width_2B-1 -: width_2B] <= cont_2B[sub_action[i+1][18:16]];
-        		                alu_in_2B_2[(i+1)*width_2B-1 -: width_2B] <= cont_2B[sub_action[i+1][13:11]];
-        		            end
-        		            4'b1001, 4'b1010: begin
-        		                alu_in_2B_1[(i+1)*width_2B-1 -: width_2B] <= cont_2B[sub_action[i+1][18:16]];
-        		                alu_in_2B_2[(i+1)*width_2B-1 -: width_2B] <= sub_action[i+1][15:0];
-        		            end
-							// set operation, operand A set to 0, operand B set to imm
-							4'b1110: begin
-        		                alu_in_2B_1[(i+1)*width_2B-1 -: width_2B] <= 16'b0;
-        		                alu_in_2B_2[(i+1)*width_2B-1 -: width_2B] <= sub_action[i+1][15:0];
-							end
-        		            //if there is no action to take, output the original value
-        		            default: begin
-        		                //alu_1 should be set to the phv value
-        		                alu_in_2B_1[(i+1)*width_2B-1 -: width_2B] <= cont_2B[i];
-        		                alu_in_2B_2[(i+1)*width_2B-1 -: width_2B] <= 16'b0;
-        		            end
-        		        endcase
-        		    end
-        		    
-        		    //the left is metadata & conditional ins, no need to modify
-        		    phv_remain_data <= phv_in[255:0];
+        		    ///////////////// see second always block for output assignment /////////////////
         		end 
-
         		else begin
         		    alu_in_valid <= 1'b0;
         		end
@@ -257,4 +182,106 @@
     end
 end
 
+
+always @(posedge clk) begin
+    if(~rst_n) begin
+        alu_in_6B_1 <= 384'b0;
+        alu_in_6B_2 <= 384'b0;
+        alu_in_4B_1 <= 256'b0;
+        alu_in_4B_2 <= 256'b0;
+        alu_in_4B_3 <= 256'b0;
+        alu_in_2B_1 <= 128'b0;
+        alu_in_2B_2 <= 128'b0;
+        
+        phv_remain_data <= 256'b0;
+    end
+    else begin
+        //assign values one by one (of course need to consider act format)
+        for(i=7; i>=0; i=i-1) begin
+            case(sub_action[16+i+1][24:21])
+                //be noted that 2 ops need to be the same width
+                4'b0001, 4'b0010: begin
+                    alu_in_6B_1[(i+1)*width_6B-1 -: width_6B] <= cont_6B[sub_action[16+i+1][18:16]];
+                    alu_in_6B_2[(i+1)*width_6B-1 -: width_6B] <= cont_6B[sub_action[16+i+1][13:11]];
+                end
+                //extracted from action field (imm)
+                4'b1001, 4'b1010: begin
+                    alu_in_6B_1[(i+1)*width_6B-1 -: width_6B] <= cont_6B[sub_action[16+i+1][18:16]];
+                    alu_in_6B_2[(i+1)*width_6B-1 -: width_6B] <= {32'b0,sub_action[16+i+1][15:0]};
+                end
+                // set operation, operand A set to 0, operand B set to imm
+                4'b1110: begin
+                    alu_in_6B_1[(i+1)*width_6B-1 -: width_6B] <= 48'b0;
+                    alu_in_6B_2[(i+1)*width_6B-1 -: width_6B] <= {32'b0,sub_action[16+i+1][15:0]};
+                end
+                //if there is no action to take, output the original value
+                default: begin
+                    //alu_1 should be set to the phv value
+                    alu_in_6B_1[(i+1)*width_6B-1 -: width_6B] <= cont_6B[i];
+                    alu_in_6B_2[(i+1)*width_6B-1 -: width_6B] <= 48'b0;
+                end
+            endcase
+        end
+        //4B is a bit of differernt from 2B and 6B
+        for(i=7; i>=0; i=i-1) begin
+            alu_in_4B_3[(i+1)*width_4B-1 -: width_4B] <= cont_4B[i];
+            casez(sub_action[8+i+1][24:21])
+                //be noted that 2 ops need to be the same width
+                4'b0001, 4'b0010: begin
+                    alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][18:16]];
+                    alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][13:11]];
+                end
+                4'b1001, 4'b1010: begin
+                    alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][18:16]];
+                    alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= {16'b0,sub_action[8+i+1][15:0]};
+                end
+                // set operation, operand A set to 0, operand B set to imm
+                4'b1110: begin
+                    alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= 32'b0;
+                    alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= {16'b0,sub_action[8+i+1][15:0]};
+                end
+                //loadd put here
+                4'b1011, 4'b1000, 4'b0111: begin
+                    alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][18:16]];
+                    //alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= {16'b0,sub_action[8+i+1][15:0]};
+                    alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= cont_4B[sub_action[8+i+1][13:11]];
+                end
+                //if there is no action to take, output the original value
+                default: begin
+                    //alu_1 should be set to the phv value
+                    alu_in_4B_1[(i+1)*width_4B-1 -: width_4B] <= cont_4B[i];
+                    alu_in_4B_2[(i+1)*width_4B-1 -: width_4B] <= 32'b0;
+                end
+            endcase
+        end
+        for(i=7; i>=0; i=i-1) begin
+            casez(sub_action[i+1][24:21])
+                //be noted that 2 ops need to be the same width
+                4'b0001, 4'b0010: begin
+                    alu_in_2B_1[(i+1)*width_2B-1 -: width_2B] <= cont_2B[sub_action[i+1][18:16]];
+                    alu_in_2B_2[(i+1)*width_2B-1 -: width_2B] <= cont_2B[sub_action[i+1][13:11]];
+                end
+                4'b1001, 4'b1010: begin
+                    alu_in_2B_1[(i+1)*width_2B-1 -: width_2B] <= cont_2B[sub_action[i+1][18:16]];
+                    alu_in_2B_2[(i+1)*width_2B-1 -: width_2B] <= sub_action[i+1][15:0];
+                end
+                // set operation, operand A set to 0, operand B set to imm
+                4'b1110: begin
+                    alu_in_2B_1[(i+1)*width_2B-1 -: width_2B] <= 16'b0;
+                    alu_in_2B_2[(i+1)*width_2B-1 -: width_2B] <= sub_action[i+1][15:0];
+                end
+                //if there is no action to take, output the original value
+                default: begin
+                    //alu_1 should be set to the phv value
+                    alu_in_2B_1[(i+1)*width_2B-1 -: width_2B] <= cont_2B[i];
+                    alu_in_2B_2[(i+1)*width_2B-1 -: width_2B] <= 16'b0;
+                end
+            endcase
+        end
+        
+        //the left is metadata & conditional ins, no need to modify
+        phv_remain_data <= phv_in_r[255:0];
+    end
+end
+
 endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/depar_do_deparsing.v parametric_menshen/depar_do_deparsing.v
--- menshen/depar_do_deparsing.v	2025-05-06 16:14:21.367210000 +0200
+++ parametric_menshen/depar_do_deparsing.v	2025-05-06 16:51:43.106256295 +0200
@@ -98,17 +98,39 @@
 wire [9:0] parse_action_ind_10b [0:9];
 
 
-wire [15:0] parse_action [0:9];		// we have 10 parse action
-assign parse_action[9] = bram_out_d1[0+:16];
-assign parse_action[8] = bram_out_d1[16+:16];
-assign parse_action[7] = bram_out_d1[32+:16];
-assign parse_action[6] = bram_out_d1[48+:16];
-assign parse_action[5] = bram_out_d1[64+:16];
-assign parse_action[4] = bram_out_d1[80+:16];
-assign parse_action[3] = bram_out_d1[96+:16];
-assign parse_action[2] = bram_out_d1[112+:16];
-assign parse_action[1] = bram_out_d1[128+:16];
-assign parse_action[0] = bram_out_d1[144+:16];
+reg [C_PKT_VEC_WIDTH-1:0] sub_depar_in;
+reg [15:0]                parse_action [0:9];		// we have 10 parse action
+
+always @(posedge clk) begin
+    if(~aresetn) begin
+        sub_depar_in <= 0;
+        
+        parse_action[9] <= 0;
+        parse_action[8] <= 0;
+        parse_action[7] <= 0;
+        parse_action[6] <= 0;
+        parse_action[5] <= 0;
+        parse_action[4] <= 0;
+        parse_action[3] <= 0;
+        parse_action[2] <= 0;
+        parse_action[1] <= 0;
+        parse_action[0] <= 0;
+    end
+    else begin
+        sub_depar_in <= phv_fifo_out;
+    
+        parse_action[9] <= bram_out_d1[0+:16];
+        parse_action[8] <= bram_out_d1[16+:16];
+        parse_action[7] <= bram_out_d1[32+:16];
+        parse_action[6] <= bram_out_d1[48+:16];
+        parse_action[5] <= bram_out_d1[64+:16];
+        parse_action[4] <= bram_out_d1[80+:16];
+        parse_action[3] <= bram_out_d1[96+:16];
+        parse_action[2] <= bram_out_d1[112+:16];
+        parse_action[1] <= bram_out_d1[128+:16];
+        parse_action[0] <= bram_out_d1[144+:16];
+    end
+end
 
 assign parse_action_ind[0] = parse_action[0][12:6];
 assign parse_action_ind[1] = parse_action[1][12:6];
@@ -252,11 +274,9 @@
 					phv_fifo_rd_en = 1;
 				end
 				else begin
-					sub_depar_act_valid = 10'b1111111111;
-
-					state_next = EMPTY_2;
+					state_next = EMPTY_1;
 					pkts_tdata_stored_1p_next = fst_half_fifo_tdata;
-					pkts_tuser_stored_1p_next = phv_fifo_out[0+:128];
+					pkts_tuser_stored_1p_next = phv_fifo_out[0+:C_AXIS_TUSER_WIDTH];
 					pkts_tkeep_stored_1p_next = fst_half_fifo_tkeep;
 					pkts_tlast_stored_1p_next = fst_half_fifo_tlast;
 					//
@@ -264,7 +284,7 @@
 			end
 		end
 		EMPTY_1: begin
-			// sub_depar_act_valid = 10'b1111111111;
+			sub_depar_act_valid = 10'b1111111111;
 			state_next = EMPTY_2;
 		end
 		EMPTY_2: begin
@@ -430,7 +450,7 @@
 			.aresetn			(aresetn),
 			.parse_act_valid	(sub_depar_act_valid[index]),
 			.parse_act			(parse_action[index][5:0]),
-			.phv_in				(phv_fifo_out),
+			.phv_in				(sub_depar_in),
 			.val_out_valid		(sub_depar_val_out_valid[index]),
 			.val_out			(sub_depar_val_out[index]),
 			.val_out_type		(sub_depar_val_out_type[index])
@@ -454,7 +474,7 @@
            SU_WRITE_C = 3;
 
 assign mod_id = ctrl_s_axis_tdata[368+:8];
-assign control_flag = ctrl_s_axis_tdata[335:320];
+assign control_flag = ctrl_s_axis_tdata[303:288];
 
 //LE to BE switching
 wire[C_AXIS_DATA_WIDTH-1:0] ctrl_s_axis_tdata_swapped;
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/deparser_top.v parametric_menshen/deparser_top.v
--- menshen/deparser_top.v	2025-05-06 16:14:21.367210000 +0200
+++ parametric_menshen/deparser_top.v	2025-05-06 16:51:43.106256295 +0200
@@ -142,16 +142,16 @@
 wire [C_AXIS_TUSER_WIDTH-1:0]	seg_fifo_tuser_in, seg_fifo_tuser_out;
 wire [C_AXIS_DATA_WIDTH/8-1:0]	seg_fifo_tkeep_in, seg_fifo_tkeep_out;
 wire							seg_fifo_tlast_in, seg_fifo_tlast_out;
-wire seg_fifo_valid_in;
-wire seg_fifo_rd_en;
-wire seg_fifo_full;
-wire seg_fifo_empty;
-
-reg [C_AXIS_DATA_WIDTH-1:0]		seg_fifo_tdata_in_r;
-reg [C_AXIS_TUSER_WIDTH-1:0]	seg_fifo_tuser_in_r;
-reg [C_AXIS_DATA_WIDTH/8-1:0]	seg_fifo_tkeep_in_r;
-reg								seg_fifo_tlast_in_r;
-reg								seg_fifo_valid_in_r;
+wire                            seg_fifo_valid_in, seg_fifo_rd_en;
+wire                            seg_fifo_full;
+wire                            seg_fifo_empty;
+
+reg [C_AXIS_DATA_WIDTH-1:0]		seg_fifo_tdata_in_r, seg_fifo_tdata_out_r;
+reg [C_AXIS_TUSER_WIDTH-1:0]	seg_fifo_tuser_in_r, seg_fifo_tuser_out_r;
+reg [C_AXIS_DATA_WIDTH/8-1:0]	seg_fifo_tkeep_in_r, seg_fifo_tkeep_out_r;
+reg								seg_fifo_tlast_in_r, seg_fifo_tlast_out_r;
+reg								seg_fifo_valid_in_r, seg_fifo_rd_en_r;
+reg                             seg_fifo_empty_r;
 // seg fifo
 fallthrough_small_fifo #(
 	.WIDTH(C_AXIS_DATA_WIDTH+C_AXIS_TUSER_WIDTH+C_AXIS_DATA_WIDTH/8+1),
@@ -163,7 +163,7 @@
 	// .din					({seg_fifo_tdata_in, seg_fifo_tuser_in, seg_fifo_tkeep_in, seg_fifo_tlast_in}),
 	// .wr_en					(seg_fifo_valid_in),
 	//
-	.rd_en					(seg_fifo_rd_en),
+	.rd_en					(seg_fifo_rd_en_r),
 	.dout					({seg_fifo_tdata_out, seg_fifo_tuser_out, seg_fifo_tkeep_out, seg_fifo_tlast_out}),
 	//
 	.full					(),
@@ -176,6 +176,7 @@
 
 //
 depar_wait_segs #(
+    .C_AXIS_TUSER_WIDTH(C_AXIS_TUSER_WIDTH)
 )
 wait_segs
 (
@@ -218,7 +219,8 @@
 //
 depar_do_deparsing #(
 	.C_PKT_VEC_WIDTH(C_PKT_VEC_WIDTH),
-	.DEPARSER_MOD_ID(DEPARSER_MOD_ID)
+	.DEPARSER_MOD_ID(DEPARSER_MOD_ID),
+	.C_AXIS_TUSER_WIDTH(C_AXIS_TUSER_WIDTH)
 )
 do_deparsing
 (
@@ -247,11 +249,11 @@
 	.snd_half_fifo_empty						(snd_half_fifo_empty),
 	.snd_half_fifo_rd_en						(snd_half_fifo_rd_en),
 	// segs
-	.pkt_fifo_tdata								(seg_fifo_tdata_out),
-	.pkt_fifo_tuser								(seg_fifo_tuser_out),
-	.pkt_fifo_tkeep								(seg_fifo_tkeep_out),
-	.pkt_fifo_tlast								(seg_fifo_tlast_out),
-	.pkt_fifo_empty								(seg_fifo_empty),
+	.pkt_fifo_tdata								(seg_fifo_tdata_out_r),
+	.pkt_fifo_tuser								(seg_fifo_tuser_out_r),
+	.pkt_fifo_tkeep								(seg_fifo_tkeep_out_r),
+	.pkt_fifo_tlast								(seg_fifo_tlast_out_r),
+	.pkt_fifo_empty								(seg_fifo_empty_r),
 	.pkt_fifo_rd_en								(seg_fifo_rd_en),
 	// output
 	.depar_out_tdata							(depar_out_tdata),
@@ -289,6 +291,13 @@
 		seg_fifo_tkeep_in_r <= 0;
 		seg_fifo_tlast_in_r <= 0;
 		seg_fifo_valid_in_r <= 0;
+		//
+		seg_fifo_tdata_out_r <= 0;
+		seg_fifo_tuser_out_r <= 0;
+		seg_fifo_tkeep_out_r <= 0;
+		seg_fifo_tlast_out_r <= 0;
+		seg_fifo_rd_en_r <= 0;
+		seg_fifo_empty_r <= 0;
 	end
 	else begin
 		//
@@ -309,6 +318,13 @@
 		seg_fifo_tkeep_in_r <= seg_fifo_tkeep_in;
 		seg_fifo_tlast_in_r <= seg_fifo_tlast_in;
 		seg_fifo_valid_in_r <= seg_fifo_valid_in;
+		//
+		seg_fifo_tdata_out_r <= seg_fifo_tdata_out;
+		seg_fifo_tuser_out_r <= seg_fifo_tuser_out;
+		seg_fifo_tkeep_out_r <= seg_fifo_tkeep_out;
+		seg_fifo_tlast_out_r <= seg_fifo_tlast_out;
+		seg_fifo_rd_en_r <= seg_fifo_rd_en;
+		seg_fifo_empty_r <= seg_fifo_empty;
 	end
 end
 
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/depar_wait_segs.v parametric_menshen/depar_wait_segs.v
--- menshen/depar_wait_segs.v	2025-05-06 16:14:21.367210000 +0200
+++ parametric_menshen/depar_wait_segs.v	2025-05-06 16:51:43.106256295 +0200
@@ -107,7 +107,7 @@
 				fst_half_tkeep_next = pkt_fifo_tkeep;
 				fst_half_tlast_next = pkt_fifo_tlast;
 
-				vlan_next = pkt_fifo_tdata[116+:12];
+				vlan_next = pkt_fifo_tdata[288+:12];
 
 				if (pkt_fifo_tlast) begin
 					if (fst_half_fifo_ready && snd_half_fifo_ready) begin
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/extract/key_extract_top.v parametric_menshen/extract/key_extract_top.v
--- menshen/extract/key_extract_top.v	2025-05-06 16:14:21.368210000 +0200
+++ parametric_menshen/extract/key_extract_top.v	2025-05-06 16:51:43.107256295 +0200
@@ -153,18 +153,6 @@
 
 
 
-
-
-
-
-
-
-
-
-
-
-
-
 //======================================================================================
 /****control path for 512b*****/
 wire [7:0]          mod_id; //module ID
@@ -187,507 +175,252 @@
            SU_WRITE_MASK_C = 5,
 		   FLUSH_PKT_C = 6;
 
-generate 
-    if(C_S_AXIS_DATA_WIDTH == 512) begin
-        assign mod_id = c_s_axis_tdata[368+:8];
-        //4'b0 for key offset
-        //4'b1 for key mask
-        assign resv = c_s_axis_tdata[376+:4];
-        assign control_flag = c_s_axis_tdata[335:320];
-
-        reg [37:0]                    key_off_entry_reg;
-        reg [192:0]                   key_mask_entry_reg;
-        //LE to BE switching
-        wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
-
-		assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
-											c_s_axis_tdata[8+:8],
-											c_s_axis_tdata[16+:8],
-											c_s_axis_tdata[24+:8],
-											c_s_axis_tdata[32+:8],
-											c_s_axis_tdata[40+:8],
-											c_s_axis_tdata[48+:8],
-											c_s_axis_tdata[56+:8],
-											c_s_axis_tdata[64+:8],
-											c_s_axis_tdata[72+:8],
-											c_s_axis_tdata[80+:8],
-											c_s_axis_tdata[88+:8],
-											c_s_axis_tdata[96+:8],
-											c_s_axis_tdata[104+:8],
-											c_s_axis_tdata[112+:8],
-											c_s_axis_tdata[120+:8],
-											c_s_axis_tdata[128+:8],
-											c_s_axis_tdata[136+:8],
-											c_s_axis_tdata[144+:8],
-											c_s_axis_tdata[152+:8],
-											c_s_axis_tdata[160+:8],
-											c_s_axis_tdata[168+:8],
-											c_s_axis_tdata[176+:8],
-											c_s_axis_tdata[184+:8],
-											c_s_axis_tdata[192+:8],
-											c_s_axis_tdata[200+:8],
-											c_s_axis_tdata[208+:8],
-											c_s_axis_tdata[216+:8],
-											c_s_axis_tdata[224+:8],
-											c_s_axis_tdata[232+:8],
-											c_s_axis_tdata[240+:8],
-											c_s_axis_tdata[248+:8],
-                                            c_s_axis_tdata[256+:8],
-                                            c_s_axis_tdata[264+:8],
-                                            c_s_axis_tdata[272+:8],
-                                            c_s_axis_tdata[280+:8],
-                                            c_s_axis_tdata[288+:8],
-                                            c_s_axis_tdata[296+:8],
-                                            c_s_axis_tdata[304+:8],
-                                            c_s_axis_tdata[312+:8],
-                                            c_s_axis_tdata[320+:8],
-                                            c_s_axis_tdata[328+:8],
-                                            c_s_axis_tdata[336+:8],
-                                            c_s_axis_tdata[344+:8],
-                                            c_s_axis_tdata[352+:8],
-                                            c_s_axis_tdata[360+:8],
-                                            c_s_axis_tdata[368+:8],
-                                            c_s_axis_tdata[376+:8],
-                                            c_s_axis_tdata[384+:8],
-                                            c_s_axis_tdata[392+:8],
-                                            c_s_axis_tdata[400+:8],
-                                            c_s_axis_tdata[408+:8],
-                                            c_s_axis_tdata[416+:8],
-                                            c_s_axis_tdata[424+:8],
-                                            c_s_axis_tdata[432+:8],
-                                            c_s_axis_tdata[440+:8],
-                                            c_s_axis_tdata[448+:8],
-                                            c_s_axis_tdata[456+:8],
-                                            c_s_axis_tdata[464+:8],
-                                            c_s_axis_tdata[472+:8],
-                                            c_s_axis_tdata[480+:8],
-                                            c_s_axis_tdata[488+:8],
-                                            c_s_axis_tdata[496+:8],
-                                            c_s_axis_tdata[504+:8]
-                                            };
-        always @(posedge clk or negedge rst_n) begin
-            if(~rst_n) begin
-                c_wr_en_off <= 1'b0;
-                c_wr_en_mask <= 1'b0;
-                c_index <= 8'b0;
-        
-                c_m_axis_tdata <= 0;
-                c_m_axis_tuser <= 0;
-                c_m_axis_tkeep <= 0;
-                c_m_axis_tvalid <= 0;
-                c_m_axis_tlast <= 0;
-
-                key_off_entry_reg <= 0;
-                key_mask_entry_reg <= 0;
-        
-                c_state <= IDLE_C;
-        
-            end
-            else begin
-                case(c_state)
-                    IDLE_C: begin
-                        if(c_s_axis_tvalid && mod_id[7:3] == STAGE_ID && mod_id[2:0] == KEY_EX_ID &&
-                         control_flag == 16'hf2f1)begin
-                            //c_wr_en <= 1'b1;
-                            c_index <= c_s_axis_tdata[384+:8];
-        
-                            c_m_axis_tdata <= 0;
-                            c_m_axis_tuser <= 0;
-                            c_m_axis_tkeep <= 0;
-                            c_m_axis_tvalid <= 0;
-                            c_m_axis_tlast <= 0;
-        
-                            //c_state <= WRITE_C;
-                            if(resv == 4'b0) begin
-                                c_wr_en_off <= 1'b0;
-                                c_state <= WRITE_OFF_C;
-                            end
-                            else begin
-                                c_wr_en_mask <= 1'b0;
-                                c_state <= WRITE_MASK_C;
-                            end
+generate
+    assign mod_id = c_s_axis_tdata[368+:8];
+    //4'b0 for key offset
+    //4'b1 for key mask
+    assign resv = c_s_axis_tdata[376+:4];
+    assign control_flag = c_s_axis_tdata[303:288];
+
+    reg [37:0]                    key_off_entry_reg;
+    reg [192:0]                   key_mask_entry_reg;
+    //LE to BE switching
+    wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
+
+    assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
+									    c_s_axis_tdata[8+:8],
+									    c_s_axis_tdata[16+:8],
+									    c_s_axis_tdata[24+:8],
+									    c_s_axis_tdata[32+:8],
+									    c_s_axis_tdata[40+:8],
+									    c_s_axis_tdata[48+:8],
+									    c_s_axis_tdata[56+:8],
+									    c_s_axis_tdata[64+:8],
+									    c_s_axis_tdata[72+:8],
+									    c_s_axis_tdata[80+:8],
+									    c_s_axis_tdata[88+:8],
+									    c_s_axis_tdata[96+:8],
+									    c_s_axis_tdata[104+:8],
+									    c_s_axis_tdata[112+:8],
+									    c_s_axis_tdata[120+:8],
+									    c_s_axis_tdata[128+:8],
+									    c_s_axis_tdata[136+:8],
+									    c_s_axis_tdata[144+:8],
+									    c_s_axis_tdata[152+:8],
+									    c_s_axis_tdata[160+:8],
+									    c_s_axis_tdata[168+:8],
+									    c_s_axis_tdata[176+:8],
+									    c_s_axis_tdata[184+:8],
+									    c_s_axis_tdata[192+:8],
+									    c_s_axis_tdata[200+:8],
+									    c_s_axis_tdata[208+:8],
+									    c_s_axis_tdata[216+:8],
+									    c_s_axis_tdata[224+:8],
+									    c_s_axis_tdata[232+:8],
+									    c_s_axis_tdata[240+:8],
+									    c_s_axis_tdata[248+:8],
+                                        c_s_axis_tdata[256+:8],
+                                        c_s_axis_tdata[264+:8],
+                                        c_s_axis_tdata[272+:8],
+                                        c_s_axis_tdata[280+:8],
+                                        c_s_axis_tdata[288+:8],
+                                        c_s_axis_tdata[296+:8],
+                                        c_s_axis_tdata[304+:8],
+                                        c_s_axis_tdata[312+:8],
+                                        c_s_axis_tdata[320+:8],
+                                        c_s_axis_tdata[328+:8],
+                                        c_s_axis_tdata[336+:8],
+                                        c_s_axis_tdata[344+:8],
+                                        c_s_axis_tdata[352+:8],
+                                        c_s_axis_tdata[360+:8],
+                                        c_s_axis_tdata[368+:8],
+                                        c_s_axis_tdata[376+:8],
+                                        c_s_axis_tdata[384+:8],
+                                        c_s_axis_tdata[392+:8],
+                                        c_s_axis_tdata[400+:8],
+                                        c_s_axis_tdata[408+:8],
+                                        c_s_axis_tdata[416+:8],
+                                        c_s_axis_tdata[424+:8],
+                                        c_s_axis_tdata[432+:8],
+                                        c_s_axis_tdata[440+:8],
+                                        c_s_axis_tdata[448+:8],
+                                        c_s_axis_tdata[456+:8],
+                                        c_s_axis_tdata[464+:8],
+                                        c_s_axis_tdata[472+:8],
+                                        c_s_axis_tdata[480+:8],
+                                        c_s_axis_tdata[488+:8],
+                                        c_s_axis_tdata[496+:8],
+                                        c_s_axis_tdata[504+:8]
+                                        };
+    always @(posedge clk or negedge rst_n) begin
+        if(~rst_n) begin
+            c_wr_en_off <= 1'b0;
+            c_wr_en_mask <= 1'b0;
+            c_index <= 8'b0;
+
+            c_m_axis_tdata <= 0;
+            c_m_axis_tuser <= 0;
+            c_m_axis_tkeep <= 0;
+            c_m_axis_tvalid <= 0;
+            c_m_axis_tlast <= 0;
+
+            key_off_entry_reg <= 0;
+            key_mask_entry_reg <= 0;
+
+            c_state <= IDLE_C;
+
+        end
+        else begin
+            case(c_state)
+                IDLE_C: begin
+                    if(c_s_axis_tvalid && mod_id[7:3] == STAGE_ID && mod_id[2:0] == KEY_EX_ID &&
+                     control_flag == 16'hf2f1)begin
+                        //c_wr_en <= 1'b1;
+                        c_index <= c_s_axis_tdata[384+:8];
+
+                        c_m_axis_tdata <= 0;
+                        c_m_axis_tuser <= 0;
+                        c_m_axis_tkeep <= 0;
+                        c_m_axis_tvalid <= 0;
+                        c_m_axis_tlast <= 0;
+
+                        //c_state <= WRITE_C;
+                        if(resv == 4'b0) begin
+                            c_wr_en_off <= 1'b0;
+                            c_state <= WRITE_OFF_C;
                         end
                         else begin
-                            c_wr_en_off <= 1'b0;
                             c_wr_en_mask <= 1'b0;
-                            c_index <= 8'b0; 
-        
-                            c_m_axis_tdata <= c_s_axis_tdata;
-                            c_m_axis_tuser <= c_s_axis_tuser;
-                            c_m_axis_tkeep <= c_s_axis_tkeep;
-                            c_m_axis_tvalid <= c_s_axis_tvalid;
-                            c_m_axis_tlast <= c_s_axis_tlast;
-        
-                            c_state <= IDLE_C;
+                            c_state <= WRITE_MASK_C;
                         end
                     end
-                    //support full table flush
-                    WRITE_OFF_C: begin
-                        if(c_s_axis_tvalid) begin
-                            key_off_entry_reg <= c_s_axis_tdata_swapped[511 -: 38];
-                            c_wr_en_off <= 1'b1;
-                            if(c_s_axis_tlast) begin
-                                c_state <= IDLE_C;
-                            end
-                            else begin
-                                c_state <= SU_WRITE_OFF_C;
-                            end
+                    else begin
+                        c_wr_en_off <= 1'b0;
+                        c_wr_en_mask <= 1'b0;
+                        c_index <= 8'b0; 
+
+                        c_m_axis_tdata <= c_s_axis_tdata;
+                        c_m_axis_tuser <= c_s_axis_tuser;
+                        c_m_axis_tkeep <= c_s_axis_tkeep;
+                        c_m_axis_tvalid <= c_s_axis_tvalid;
+                        c_m_axis_tlast <= c_s_axis_tlast;
+
+                        c_state <= IDLE_C;
+                    end
+                end
+                //support full table flush
+                WRITE_OFF_C: begin
+                    if(c_s_axis_tvalid) begin
+                        key_off_entry_reg <= c_s_axis_tdata_swapped[511 -: 38];
+                        c_wr_en_off <= 1'b1;
+                        if(c_s_axis_tlast) begin
+                            c_state <= IDLE_C;
                         end
                         else begin
-                            c_wr_en_off <= 0;
+                            c_state <= SU_WRITE_OFF_C;
                         end
                     end
+                    else begin
+                        c_wr_en_off <= 0;
+                    end
+                end
 
-                    SU_WRITE_OFF_C: begin
-                        if(c_s_axis_tvalid) begin
-                            key_off_entry_reg <= c_s_axis_tdata_swapped[511 -: 38];
-                            c_wr_en_off <= 1'b1;
-                            c_index <= c_index + 1'b1;
-                            if(c_s_axis_tlast) begin
-                                c_state <= IDLE_C;
-                            end
-                            else begin
-                                c_state <= SU_WRITE_OFF_C;
-                            end
+                SU_WRITE_OFF_C: begin
+                    if(c_s_axis_tvalid) begin
+                        key_off_entry_reg <= c_s_axis_tdata_swapped[511 -: 38];
+                        c_wr_en_off <= 1'b1;
+                        c_index <= c_index + 1'b1;
+                        if(c_s_axis_tlast) begin
+                            c_state <= IDLE_C;
                         end
                         else begin
-                            c_wr_en_off <= 1'b0;
+                            c_state <= SU_WRITE_OFF_C;
                         end
                     end
+                    else begin
+                        c_wr_en_off <= 1'b0;
+                    end
+                end
 
-                    WRITE_MASK_C: begin
-                        if(c_s_axis_tvalid) begin
-                            key_mask_entry_reg <= c_s_axis_tdata_swapped[511 -: 193];
-                            c_wr_en_mask <= 1'b1;
-                            if(c_s_axis_tlast) begin
-                                c_state <= IDLE_C;
-                            end
-                            else begin
-                                c_state <= SU_WRITE_MASK_C;
-                            end
+                WRITE_MASK_C: begin
+                    if(c_s_axis_tvalid) begin
+                        key_mask_entry_reg <= c_s_axis_tdata_swapped[511 -: 193];
+                        c_wr_en_mask <= 1'b1;
+                        if(c_s_axis_tlast) begin
+                            c_state <= IDLE_C;
                         end
                         else begin
-                            c_wr_en_mask <= 0;
+                            c_state <= SU_WRITE_MASK_C;
                         end
                     end
+                    else begin
+                        c_wr_en_mask <= 0;
+                    end
+                end
 
-                    SU_WRITE_MASK_C: begin
-                        if(c_s_axis_tvalid) begin
-                            key_mask_entry_reg <= c_s_axis_tdata_swapped[511 -: 193];
-                            c_wr_en_mask <= 1'b1;
-                            c_index <= c_index + 1'b1;
-                            if(c_s_axis_tlast) begin
-                                c_state <= IDLE_C;
-                            end
-                            else begin
-                                c_state <= SU_WRITE_MASK_C;
-                            end
+                SU_WRITE_MASK_C: begin
+                    if(c_s_axis_tvalid) begin
+                        key_mask_entry_reg <= c_s_axis_tdata_swapped[511 -: 193];
+                        c_wr_en_mask <= 1'b1;
+                        c_index <= c_index + 1'b1;
+                        if(c_s_axis_tlast) begin
+                            c_state <= IDLE_C;
                         end
                         else begin
-                            c_wr_en_mask <= 1'b0;
+                            c_state <= SU_WRITE_MASK_C;
                         end
                     end
-
-                    default: begin
-                        c_wr_en_off <= 1'b0;
+                    else begin
                         c_wr_en_mask <= 1'b0;
-                        c_index <= 8'b0; 
-                        c_m_axis_tdata <= c_s_axis_tdata;
-                        c_m_axis_tuser <= c_s_axis_tuser;
-                        c_m_axis_tkeep <= c_s_axis_tkeep;
-                        c_m_axis_tvalid <= c_s_axis_tvalid;
-                        c_m_axis_tlast <= c_s_axis_tlast;
                     end
-                endcase
-        
-            end
-        end
-        //ram for key extract
-        blk_mem_gen_2
-        key_ram_38w_32d
-        (
-            .addra(c_index[4:0]),
-            .clka(clk),
-            .dina(key_off_entry_reg),
-            .ena(1'b1),
-            .wea(c_wr_en_off),
-
-            //only [3:0] is needed for addressing
-            .addrb(vlan_in[8:4]),
-            .clkb(clk),
-            .doutb(key_offset_w),
-            .enb(1'b1)
-        );
-
-        blk_mem_gen_3
-        mask_ram_193w_32d
-        (
-            .addra(c_index[4:0]),
-            .clka(clk),
-            .dina(key_mask_entry_reg),
-            .ena(1'b1),
-            .wea(c_wr_en_mask),
-
-            //only [3:0] is needed for addressing
-            .addrb(vlan_in[8:4]),
-            .clkb(clk),
-            .doutb(key_mask_out_w),
-            .enb(1'b1)
-        );
-    end
+                end
 
-    else if(C_S_AXIS_DATA_WIDTH == 256) begin
+                default: begin
+                    c_wr_en_off <= 1'b0;
+                    c_wr_en_mask <= 1'b0;
+                    c_index <= 8'b0; 
+                    c_m_axis_tdata <= c_s_axis_tdata;
+                    c_m_axis_tuser <= c_s_axis_tuser;
+                    c_m_axis_tkeep <= c_s_axis_tkeep;
+                    c_m_axis_tvalid <= c_s_axis_tvalid;
+                    c_m_axis_tlast <= c_s_axis_tlast;
+                end
+            endcase
 
-		wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
-		assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
-											c_s_axis_tdata[8+:8],
-											c_s_axis_tdata[16+:8],
-											c_s_axis_tdata[24+:8],
-											c_s_axis_tdata[32+:8],
-											c_s_axis_tdata[40+:8],
-											c_s_axis_tdata[48+:8],
-											c_s_axis_tdata[56+:8],
-											c_s_axis_tdata[64+:8],
-											c_s_axis_tdata[72+:8],
-											c_s_axis_tdata[80+:8],
-											c_s_axis_tdata[88+:8],
-											c_s_axis_tdata[96+:8],
-											c_s_axis_tdata[104+:8],
-											c_s_axis_tdata[112+:8],
-											c_s_axis_tdata[120+:8],
-											c_s_axis_tdata[128+:8],
-											c_s_axis_tdata[136+:8],
-											c_s_axis_tdata[144+:8],
-											c_s_axis_tdata[152+:8],
-											c_s_axis_tdata[160+:8],
-											c_s_axis_tdata[168+:8],
-											c_s_axis_tdata[176+:8],
-											c_s_axis_tdata[184+:8],
-											c_s_axis_tdata[192+:8],
-											c_s_axis_tdata[200+:8],
-											c_s_axis_tdata[208+:8],
-											c_s_axis_tdata[216+:8],
-											c_s_axis_tdata[224+:8],
-											c_s_axis_tdata[232+:8],
-											c_s_axis_tdata[240+:8],
-											c_s_axis_tdata[248+:8]};
-
-        assign mod_id = c_s_axis_tdata[112+:8];
-        //4'b0 for key offset
-        //4'b1 for key mask
-        assign resv = c_s_axis_tdata[120+:4];
-        assign control_flag = c_s_axis_tdata[64+:16];
-
-		reg [7:0] c_index_next;
-		reg [2:0] c_state_next;
-		reg c_wr_en_off_next, c_wr_en_mask_next;
-		reg [37:0] key_off_entry_reg, key_off_entry_reg_next;
-		reg [192:0] key_mask_entry_reg, key_mask_entry_reg_next;
-
-		reg [C_S_AXIS_DATA_WIDTH-1:0]		r_tdata, c_s_axis_tdata_d1;
-		reg [C_S_AXIS_TUSER_WIDTH-1:0]		r_tuser, c_s_axis_tuser_d1;
-		reg [C_S_AXIS_DATA_WIDTH/8-1:0]		r_tkeep, c_s_axis_tkeep_d1;
-		reg									r_tlast, c_s_axis_tlast_d1;
-		reg									r_tvalid, c_s_axis_tvalid_d1;
-
-		reg [C_S_AXIS_DATA_WIDTH-1:0]		r_1st_tdata, r_1st_tdata_next;
-		reg [C_S_AXIS_TUSER_WIDTH-1:0]		r_1st_tuser, r_1st_tuser_next;
-		reg [C_S_AXIS_DATA_WIDTH/8-1:0]		r_1st_tkeep, r_1st_tkeep_next;
-		reg									r_1st_tlast, r_1st_tlast_next;
-		reg									r_1st_tvalid, r_1st_tvalid_next;
-
-		always @(*) begin
-			c_state_next = c_state;
-
-			r_tdata = 0;
-			r_tkeep = 0;
-			r_tuser = 0;
-			r_tlast = 0;
-			r_tvalid = 0;
-
-			r_1st_tdata_next = r_1st_tdata;
-			r_1st_tkeep_next = r_1st_tkeep;
-			r_1st_tuser_next = r_1st_tuser;
-			r_1st_tlast_next = r_1st_tlast;
-			r_1st_tvalid_next = r_1st_tvalid;
-
-			c_wr_en_mask_next = 0;
-			c_wr_en_off_next = 0;
-			c_index_next = c_index;
-			key_off_entry_reg_next = key_off_entry_reg;
-			key_mask_entry_reg_next = key_mask_entry_reg;
-
-			case (c_state)
-				IDLE_C: begin
-					r_tvalid = 0; // 1st segment
-					if (c_s_axis_tvalid) begin
-						// store 1st element
-						r_1st_tdata_next = c_s_axis_tdata;
-						r_1st_tuser_next = c_s_axis_tuser;
-						r_1st_tkeep_next = c_s_axis_tkeep;
-						r_1st_tlast_next = c_s_axis_tlast;
-						r_1st_tvalid_next = c_s_axis_tvalid;
-
-						c_state_next = PARSE_C;
-					end
-				end
-				PARSE_C: begin // 2nd segment
-					if (mod_id[7:3] == STAGE_ID && mod_id[2:0] == KEY_EX_ID &&
-							control_flag == 16'hf2f1 && c_s_axis_tvalid) begin
-						if (resv == 4'b0 && c_s_axis_tvalid) begin
-							c_index_next = c_s_axis_tdata[128+:8];
-							c_state_next = WRITE_OFF_C;
-						end
-						else begin
-							c_index_next = c_s_axis_tdata[128+:8];
-							c_state_next = WRITE_MASK_C;
-						end
-					end
-					else if (!c_s_axis_tvalid) begin
-					end
-					else begin
-						// emit
-						r_tdata = r_1st_tdata;
-						r_tkeep = r_1st_tkeep;
-						r_tuser = r_1st_tuser;
-						r_tlast = r_1st_tlast;
-						r_tvalid = r_1st_tvalid;
-						c_state_next = FLUSH_PKT_C;
-					end
-				end
-				WRITE_OFF_C: begin
-					if (c_s_axis_tvalid) begin
-						c_wr_en_off_next = 1;
-						key_off_entry_reg_next = c_s_axis_tdata_swapped[255-:38];
-
-						c_state_next = FLUSH_PKT_C;
-					end
-				end
-				WRITE_MASK_C: begin
-					if (c_s_axis_tvalid) begin
-						c_wr_en_mask_next = 1;
-						key_mask_entry_reg_next = c_s_axis_tdata_swapped[255-:193];
-
-						c_state_next = FLUSH_PKT_C;
-					end
-				end
-				FLUSH_PKT_C: begin
-					c_wr_en_off_next = 0;
-					c_wr_en_mask_next = 0;
-					r_tdata = c_s_axis_tdata_d1;
-					r_tkeep = c_s_axis_tkeep_d1;
-					r_tuser = c_s_axis_tuser_d1;
-					r_tlast = c_s_axis_tlast_d1;
-					r_tvalid = c_s_axis_tvalid_d1;
-					if (c_s_axis_tvalid_d1 && c_s_axis_tlast_d1) begin
-						c_state_next = IDLE_C;
-					end
-				end
-			endcase
-		end
-
-		always @(posedge clk) begin
-			if (~rst_n) begin
-				c_state <= IDLE_C;
-
-				// ctrl output
-				c_m_axis_tdata <= 0;
-				c_m_axis_tuser <= 0;
-				c_m_axis_tkeep <= 0;
-				c_m_axis_tlast <= 0;
-				c_m_axis_tvalid <= 0;
-				//
-				c_index <= 0;
-				c_wr_en_off <= 0;
-				c_wr_en_mask <= 0;
-				key_off_entry_reg <= 0;
-				key_mask_entry_reg <= 0;
-			end
-			else begin
-				c_state <= c_state_next;
-				// output ctrl master signals
-				c_m_axis_tdata <= r_tdata;
-				c_m_axis_tkeep <= r_tkeep;
-				c_m_axis_tuser <= r_tuser;
-				c_m_axis_tlast <= r_tlast;
-				c_m_axis_tvalid <= r_tvalid;
-				//
-				c_index <= c_index_next;
-				c_wr_en_off <= c_wr_en_off_next;
-				c_wr_en_mask <= c_wr_en_mask_next;
-				key_off_entry_reg <= key_off_entry_reg_next;
-				key_mask_entry_reg <= key_mask_entry_reg_next;
-			end
-		end
-
-		always @(posedge clk) begin
-			if (~rst_n) begin
-				// delayed 1 clk
-				c_s_axis_tdata_d1 <= 0;
-				c_s_axis_tuser_d1 <= 0;
-				c_s_axis_tkeep_d1 <= 0;
-				c_s_axis_tlast_d1 <= 0;
-				c_s_axis_tvalid_d1 <= 0;
-				//
-				r_1st_tdata <= 0;
-				r_1st_tkeep <= 0;
-				r_1st_tuser <= 0;
-				r_1st_tlast <= 0;
-				r_1st_tvalid <= 0;
-			end
-			else begin
-				// delayed 1 clk
-				c_s_axis_tdata_d1 <= c_s_axis_tdata;
-				c_s_axis_tuser_d1 <= c_s_axis_tuser;
-				c_s_axis_tkeep_d1 <= c_s_axis_tkeep;
-				c_s_axis_tlast_d1 <= c_s_axis_tlast;
-				c_s_axis_tvalid_d1 <= c_s_axis_tvalid;
-				// 
-				r_1st_tdata <= r_1st_tdata_next;
-				r_1st_tkeep <= r_1st_tkeep_next;
-				r_1st_tuser <= r_1st_tuser_next;
-				r_1st_tlast <= r_1st_tlast_next;
-				r_1st_tvalid <= r_1st_tvalid_next;
-			end
-		end
-        //ram for key extract
-        //blk_mem_gen_2 act_ram_18w_16d
-        // blk_mem_gen_2 #(
-        // 	.C_INIT_FILE_NAME	("./key_extract.mif"),
-        // 	.C_LOAD_INIT_FILE	(1)
-        // )
-        blk_mem_gen_2
-        key_ram_38w_32d
-        (
-            .addra(c_index[4:0]),
-            .clka(clk),
-            .dina(key_off_entry_reg),
-            .ena(1'b1),
-            .wea(c_wr_en_off),
-
-            //only [3:0] is needed for addressing
-            .addrb(vlan_in[8:4]),
-            .clkb(clk),
-            .doutb(key_offset_w),
-            .enb(1'b1)
-        );
-
-        blk_mem_gen_3
-        mask_ram_193w_16d
-        (
-            .addra(c_index[4:0]),
-            .clka(clk),
-            .dina(key_mask_entry_reg),
-            .ena(1'b1),
-            .wea(c_wr_en_mask),
-
-            //only [3:0] is needed for addressing
-            .addrb(vlan_in[8:4]),
-            .clkb(clk),
-            .doutb(key_mask_out_w),
-            .enb(1'b1)
-        );
+        end
     end
+    //ram for key extract
+    blk_mem_gen_2
+    key_ram_38w_32d
+    (
+        .addra(c_index[4:0]),
+        .clka(clk),
+        .dina(key_off_entry_reg),
+        .ena(1'b1),
+        .wea(c_wr_en_off),
+
+        //only [3:0] is needed for addressing
+        .addrb(vlan_in[8:4]),
+        .clkb(clk),
+        .doutb(key_offset_w),
+        .enb(1'b1)
+    );
+
+    blk_mem_gen_3
+    mask_ram_193w_32d
+    (
+        .addra(c_index[4:0]),
+        .clka(clk),
+        .dina(key_mask_entry_reg),
+        .ena(1'b1),
+        .wea(c_wr_en_mask),
+
+        //only [3:0] is needed for addressing
+        .addrb(vlan_in[8:4]),
+        .clkb(clk),
+        .doutb(key_mask_out_w),
+        .enb(1'b1)
+    );
 endgenerate
 
 //==========================================================
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/extract/key_extract.v parametric_menshen/extract/key_extract.v
--- menshen/extract/key_extract.v	2025-05-06 16:14:21.367210000 +0200
+++ parametric_menshen/extract/key_extract.v	2025-05-06 16:51:43.106256295 +0200
@@ -39,7 +39,25 @@
 localparam WIDTH_4B = 32;
 localparam WIDTH_6B = 48;
 
-//reg [KEY_LEN-1:0] key_out;
+reg [PHV_LEN-1:0] phv_in_r;
+reg               phv_valid_in_r;
+reg [KEY_OFF-1:0] key_offset_w_r;
+reg [KEY_LEN-1:0] key_mask_w_r;
+
+always @(posedge clk) begin
+	if (~rst_n) begin
+		phv_in_r <= 0;
+		phv_valid_in_r <= 0;
+		key_offset_w_r <= 0;
+		key_mask_w_r <= 0;
+	end
+	else begin
+		phv_in_r <= phv_in;
+		phv_valid_in_r <= phv_valid_in;
+		key_offset_w_r <= key_offset_w;
+		key_mask_w_r <= key_mask_w;
+	end
+end
 
 //24 fields to be retrived from the pkt header
 reg [WIDTH_2B-1:0]		cont_2B [0:7];
@@ -101,37 +119,37 @@
 	else begin
 		case (state)
 			IDLE_S: begin
-				if (phv_valid_in) begin
-					key_offset_r <= key_offset_w;
-					key_mask_out_r <= key_mask_w;
-					phv_out <= phv_in;
-
-					cont_6B[7] <= phv_in[PHV_LEN-1            -: WIDTH_6B];
-					cont_6B[6] <= phv_in[PHV_LEN-1-  WIDTH_6B -: WIDTH_6B];
-					cont_6B[5] <= phv_in[PHV_LEN-1-2*WIDTH_6B -: WIDTH_6B];
-					cont_6B[4] <= phv_in[PHV_LEN-1-3*WIDTH_6B -: WIDTH_6B];
-					cont_6B[3] <= phv_in[PHV_LEN-1-4*WIDTH_6B -: WIDTH_6B];
-					cont_6B[2] <= phv_in[PHV_LEN-1-5*WIDTH_6B -: WIDTH_6B];
-					cont_6B[1] <= phv_in[PHV_LEN-1-6*WIDTH_6B -: WIDTH_6B];
-					cont_6B[0] <= phv_in[PHV_LEN-1-7*WIDTH_6B -: WIDTH_6B];
-
-					cont_4B[7] <= phv_in[PHV_LEN-1-8*WIDTH_6B            -: WIDTH_4B];
-					cont_4B[6] <= phv_in[PHV_LEN-1-8*WIDTH_6B-  WIDTH_4B -: WIDTH_4B];
-					cont_4B[5] <= phv_in[PHV_LEN-1-8*WIDTH_6B-2*WIDTH_4B -: WIDTH_4B];
-					cont_4B[4] <= phv_in[PHV_LEN-1-8*WIDTH_6B-3*WIDTH_4B -: WIDTH_4B];
-					cont_4B[3] <= phv_in[PHV_LEN-1-8*WIDTH_6B-4*WIDTH_4B -: WIDTH_4B];
-					cont_4B[2] <= phv_in[PHV_LEN-1-8*WIDTH_6B-5*WIDTH_4B -: WIDTH_4B];
-					cont_4B[1] <= phv_in[PHV_LEN-1-8*WIDTH_6B-6*WIDTH_4B -: WIDTH_4B];
-					cont_4B[0] <= phv_in[PHV_LEN-1-8*WIDTH_6B-7*WIDTH_4B -: WIDTH_4B];
-
-					cont_2B[7] <= phv_in[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B            -: WIDTH_2B];
-					cont_2B[6] <= phv_in[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-  WIDTH_2B -: WIDTH_2B];
-					cont_2B[5] <= phv_in[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-2*WIDTH_2B -: WIDTH_2B];
-					cont_2B[4] <= phv_in[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-3*WIDTH_2B -: WIDTH_2B];
-					cont_2B[3] <= phv_in[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-4*WIDTH_2B -: WIDTH_2B];
-					cont_2B[2] <= phv_in[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-5*WIDTH_2B -: WIDTH_2B];
-					cont_2B[1] <= phv_in[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-6*WIDTH_2B -: WIDTH_2B];
-					cont_2B[0] <= phv_in[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-7*WIDTH_2B -: WIDTH_2B];
+				if (phv_valid_in_r) begin
+					key_offset_r <= key_offset_w_r;
+					key_mask_out_r <= key_mask_w_r;
+					phv_out <= phv_in_r;
+
+					cont_6B[7] <= phv_in_r[PHV_LEN-1            -: WIDTH_6B];
+					cont_6B[6] <= phv_in_r[PHV_LEN-1-  WIDTH_6B -: WIDTH_6B];
+					cont_6B[5] <= phv_in_r[PHV_LEN-1-2*WIDTH_6B -: WIDTH_6B];
+					cont_6B[4] <= phv_in_r[PHV_LEN-1-3*WIDTH_6B -: WIDTH_6B];
+					cont_6B[3] <= phv_in_r[PHV_LEN-1-4*WIDTH_6B -: WIDTH_6B];
+					cont_6B[2] <= phv_in_r[PHV_LEN-1-5*WIDTH_6B -: WIDTH_6B];
+					cont_6B[1] <= phv_in_r[PHV_LEN-1-6*WIDTH_6B -: WIDTH_6B];
+					cont_6B[0] <= phv_in_r[PHV_LEN-1-7*WIDTH_6B -: WIDTH_6B];
+
+					cont_4B[7] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B            -: WIDTH_4B];
+					cont_4B[6] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-  WIDTH_4B -: WIDTH_4B];
+					cont_4B[5] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-2*WIDTH_4B -: WIDTH_4B];
+					cont_4B[4] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-3*WIDTH_4B -: WIDTH_4B];
+					cont_4B[3] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-4*WIDTH_4B -: WIDTH_4B];
+					cont_4B[2] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-5*WIDTH_4B -: WIDTH_4B];
+					cont_4B[1] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-6*WIDTH_4B -: WIDTH_4B];
+					cont_4B[0] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-7*WIDTH_4B -: WIDTH_4B];
+
+					cont_2B[7] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B            -: WIDTH_2B];
+					cont_2B[6] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-  WIDTH_2B -: WIDTH_2B];
+					cont_2B[5] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-2*WIDTH_2B -: WIDTH_2B];
+					cont_2B[4] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-3*WIDTH_2B -: WIDTH_2B];
+					cont_2B[3] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-4*WIDTH_2B -: WIDTH_2B];
+					cont_2B[2] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-5*WIDTH_2B -: WIDTH_2B];
+					cont_2B[1] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-6*WIDTH_2B -: WIDTH_2B];
+					cont_2B[0] <= phv_in_r[PHV_LEN-1-8*WIDTH_6B-8*WIDTH_4B-7*WIDTH_2B -: WIDTH_2B];
 
 					state <= CYCLE_1;
 				end
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/last_stage.v parametric_menshen/last_stage.v
--- menshen/last_stage.v	2025-05-06 16:14:21.368210000 +0200
+++ parametric_menshen/last_stage.v	2025-05-06 16:24:50.216223027 +0200
@@ -4,13 +4,14 @@
 module last_stage #(
     parameter C_S_AXIS_DATA_WIDTH = 512,
     parameter C_S_AXIS_TUSER_WIDTH = 128,
-    parameter STAGE_ID = 0,  // valid: 0-4
+    parameter STAGE_ID = 0,  // valid: 0-32
     parameter PHV_LEN = 48*8+32*8+16*8+256,
     parameter KEY_LEN = 48*2+32*2+16*2+1,
     parameter ACT_LEN = 25,
     parameter KEY_OFF = 6*3+20,
-	parameter C_NUM_QUEUES = 4,
-	parameter C_VLANID_WIDTH = 12
+    parameter C_NUM_QUEUES = 1,
+    parameter C_VLANID_WIDTH = 12,
+    parameter NUM_OF_STAGES = 5
 )
 (
     input									axis_clk,
@@ -29,18 +30,6 @@
     output reg                       phv_out_valid_0,
 	input                        phv_fifo_ready_0,
 
-    output reg [PHV_LEN-1:0]         phv_out_1,
-    output reg                       phv_out_valid_1,
-	input                        phv_fifo_ready_1,
-
-    output reg [PHV_LEN-1:0]         phv_out_2,
-    output reg                       phv_out_valid_2,
-	input                        phv_fifo_ready_2,
-
-    output reg [PHV_LEN-1:0]         phv_out_3,
-    output reg                       phv_out_valid_3,
-	input                        phv_fifo_ready_3,
-
 
     //control path
     input [C_S_AXIS_DATA_WIDTH-1:0]			c_s_axis_tdata,
@@ -166,7 +155,8 @@
     .PHV_LEN(),
     .KEY_LEN(KEY_LEN),
     .ACT_LEN(),
-    .LOOKUP_ID()
+    .LOOKUP_ID(),
+    .NUM_OF_STAGES(NUM_OF_STAGES)
 ) lookup_engine(
     .clk(axis_clk),
     .rst_n(aresetn),
@@ -223,7 +213,7 @@
     //signals output from ALUs
     .phv_out(phv_out),
     .phv_valid_out(phv_out_valid_from_ae),
-    .ready_in(phv_fifo_ready_0&&phv_fifo_ready_1&&phv_fifo_ready_2&&phv_fifo_ready_3),
+    .ready_in(phv_fifo_ready_0),
 	.act_vlan_in			(act_vlan_out_r),
 	.act_vlan_valid_in		(act_vlan_out_valid_r),
 	.act_vlan_ready			(act_vlan_ready),
@@ -245,77 +235,29 @@
 	.c_m_axis_tlast(c_m_axis_tlast)
 );
 
-// pkt_hdr_vec_next = {pkt_hdr_vec_w[PKT_HDR_LEN-1:145], p_cur_queue_val, pkt_hdr_vec_w[0+:141]}; 
-// position: [141+:4]
-//
-
-// assign phv_out_0 = phv_out;
-// assign phv_out_1 = phv_out;
-// assign phv_out_2 = phv_out;
-// assign phv_out_3 = phv_out;
-// 
-// 
-// assign phv_out_valid_0 = (phv_out[141]==1?1:0) & phv_out_valid_from_ae;
-// assign phv_out_valid_1 = (phv_out[142]==1?1:0) & phv_out_valid_from_ae;
-// assign phv_out_valid_2 = (phv_out[143]==1?1:0) & phv_out_valid_from_ae;
-// assign phv_out_valid_3 = (phv_out[144]==1?1:0) & phv_out_valid_from_ae;
-
 reg [PHV_LEN-1:0] phv_out_0_next;
-reg [PHV_LEN-1:0] phv_out_1_next;
-reg [PHV_LEN-1:0] phv_out_2_next;
-reg [PHV_LEN-1:0] phv_out_3_next;
 reg phv_out_valid_0_next;
-reg phv_out_valid_1_next;
-reg phv_out_valid_2_next;
-reg phv_out_valid_3_next;
 
 always @(*) begin
 	phv_out_valid_0_next = 0;
-	phv_out_valid_1_next = 0;
-	phv_out_valid_2_next = 0;
-	phv_out_valid_3_next = 0;
 
 	phv_out_0_next = phv_out;
-	phv_out_1_next = phv_out;
-	phv_out_2_next = phv_out;
-	phv_out_3_next = phv_out;
 
 	if (phv_out_valid_from_ae) begin
 		if (phv_out[141]) begin
 			phv_out_valid_0_next = 1;
 		end
-		if (phv_out[142]) begin
-			phv_out_valid_1_next = 1;
-		end
-		if (phv_out[143]) begin
-			phv_out_valid_2_next = 1;
-		end
-		if (phv_out[144]) begin
-			phv_out_valid_3_next = 1;
-		end
 	end
 end
 
 always @(posedge axis_clk) begin
 	if (~aresetn) begin
 		phv_out_0 <= 0;
-		phv_out_1 <= 0;
-		phv_out_2 <= 0;
-		phv_out_3 <= 0;
 		phv_out_valid_0 <= 0;
-		phv_out_valid_1 <= 0;
-		phv_out_valid_2 <= 0;
-		phv_out_valid_3 <= 0;
 	end
 	else begin
 		phv_out_0 <= phv_out_0_next;
-		phv_out_1 <= phv_out_1_next;
-		phv_out_2 <= phv_out_2_next;
-		phv_out_3 <= phv_out_3_next;
 		phv_out_valid_0 <= phv_out_valid_0_next;
-		phv_out_valid_1 <= phv_out_valid_1_next;
-		phv_out_valid_2 <= phv_out_valid_2_next;
-		phv_out_valid_3 <= phv_out_valid_3_next;
 	end
 end
 
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/lookup/lke_cam_part.v parametric_menshen/lookup/lke_cam_part.v
--- menshen/lookup/lke_cam_part.v	2025-05-06 16:14:21.368210000 +0200
+++ parametric_menshen/lookup/lke_cam_part.v	2025-05-06 16:51:43.107256295 +0200
@@ -8,7 +8,8 @@
     parameter KEY_LEN = 48*2+32*2+16*2+5,
     parameter ACT_LEN = 625,
     parameter LOOKUP_ID = 2,
-	parameter C_VLANID_WIDTH = 12
+    parameter C_VLANID_WIDTH = 12,
+    parameter NUM_OF_STAGES = 5
 )
 (
     input clk,
@@ -44,101 +45,116 @@
 );
 
 /********intermediate variables declared here********/
-wire [3:0]		match_addr;
-wire			match;
-
-reg [PHV_LEN-1:0] phv_reg;
-reg [2:0] lookup_state;
-
-wire [11:0] vlan_id;
-
-assign vlan_id = phv_in[140:129];
-
-wire [204:0] dbg_input;
-
-assign dbg_input = {vlan_id[3:0], vlan_id[11:4], extract_key};
-
-/********intermediate variables declared here********/
-
-//here, the output should be controlled.
-localparam IDLE_S = 3'd0,
-           WAIT1_S = 3'd1,
-           WAIT2_S = 3'd2,
-           TRANS_S = 3'd3,
-		   HALT_S = 3'd4,
-		   EMPTY1_S = 3'd5,
-		   OUTPUT_S = 3'd6;
+reg                key_valid_ff;
+reg [PHV_LEN-1:0]  phv_in_ff;
+reg [KEY_LEN-1:0]  extract_key_ff;
+reg [223:0]        cam_out_data_ff;
+reg                cam_out_valid_ff;
+reg [2:0]          rst_counter;
+reg                cam_rst;
+
+wire [3:0]         match_addr;
+wire               match;
+reg [223:0]        cam_out_data;
+reg                cam_out_valid;
+reg                rst_busy;
+reg                cam_lkup_ready;
+reg                cam_hwui_ready;
+wire [PHV_LEN-1:0] fifo_phv_out;
+wire               fifo_full;
+
+wire [11:0]        vlan_id_ff;
+
+wire               rst_busy_r;
+reg [207:0]        cam_in;
+reg                key_valid_r;
+reg                ready_in_r;
+wire [223:0]       cam_out_data_r;
+wire               cam_out_valid_r;
+wire               cam_lkup_ready_r;
+reg [223:0]        conf_in;
+reg                c_wr_en_cam_r;
+wire               cam_hwui_ready_r;
+
+assign vlan_id_ff = phv_in_ff[140:129];
+
+assign match_addr = cam_out_data_ff[3:0];
+
+assign match = cam_out_data_ff[8];
+
+assign ready_out = (~fifo_full) & (~rst_busy) & cam_lkup_ready & cam_hwui_ready;
+
+fallthrough_small_fifo #(
+	.WIDTH(PHV_LEN),
+	.MAX_DEPTH_BITS(5)
+)
+phv_fifo_cam (
+	.clk            (clk),
+	.reset          (~rst_n),
+	.din            (phv_in_ff),
+	.wr_en          (key_valid_ff),
+	.rd_en          (cam_out_valid_ff && ready_in),
+	.dout           (fifo_phv_out),
+	.full           (),
+	.nearly_full    (fifo_full),
+	.empty          ()
+);
 
-assign ready_out = lookup_state!=HALT_S;
+always @(posedge clk or negedge rst_n) begin
+	if (~rst_n) begin
+		rst_counter <= 0;
+		cam_rst <= 0;
+		key_valid_ff <= 0;
+		phv_in_ff <= 0;
+		extract_key_ff <= 0;
+		cam_out_data_ff <= 0;
+		cam_out_valid_ff <= 0;
+	end
+	else begin
+		key_valid_ff <= key_valid;
+		phv_in_ff <= phv_in;
+		extract_key_ff <= extract_key;
+		cam_out_data_ff <= cam_out_data;
+		cam_out_valid_ff <= cam_out_valid;
+		if(rst_counter < 4) begin
+			rst_counter <= rst_counter + 1;
+			cam_rst <= 0;
+		end
+		else begin
+			cam_rst <= 1;
+		end
+	end
+end
 
 always @(posedge clk or negedge rst_n) begin
 
     if (~rst_n) begin
-        phv_reg <= 0;
-        lookup_state <= IDLE_S;
-
         phv_out <= 0;
-		phv_out_valid <= 0;
-		match_addr_out <= 0;
-		if_match <= 0;
-
+        phv_out_valid <= 0;
+        if_match <= 0;
+        match_addr_out <= 0;
 		// ready_out <= 1'b1;
     end
-
-    else begin
-        case(lookup_state)
-            IDLE_S: begin
-                if (key_valid == 1'b1) begin
-					// ready_out <= 1'b0;
-                    phv_reg <= phv_in;
-                    lookup_state <= WAIT1_S;
-                end
-                else begin
-					phv_out_valid <= 0;
-					if_match <= 0;
-					// ready_out <= 1'b1;
-                    lookup_state <= IDLE_S;
-                end
+    else
+    begin
+        if (cam_out_valid_ff && ready_in) begin
+            phv_out <= fifo_phv_out;
+            phv_out_valid <= 1'b1;
+            if(match == 1'b0) begin // CAM miss
+                if_match <= 0;
+                match_addr_out <= 4'hf;
             end
-
-            WAIT1_S: begin
-				if (ready_in) begin
-					phv_out <= phv_reg;
-					phv_out_valid <= 1'b1;
-
-					if(match == 1'b0) begin // CAM miss
-						if_match <= 0;
-						match_addr_out <= 4'hf;
-                	end
-                	else begin // CAM hit
-						if_match <= 1;
-						match_addr_out <= match_addr;
-                	end
-                	lookup_state <= IDLE_S;
-					// ready_out <= 1'b1;
-				end
-				else begin
-					lookup_state <= HALT_S;
-				end
+            else begin // CAM hit
+                if_match <= 1;
+                match_addr_out <= match_addr;
             end
-			HALT_S: begin
-				if (ready_in) begin
-					phv_out <= phv_reg;
-					phv_out_valid <= 1'b1;
-
-					if(match == 1'b0) begin // CAM miss
-						if_match <= 0;
-						match_addr_out <= 4'hf;
-                	end
-                	else begin // CAM hit
-						if_match <= 1;
-						match_addr_out <= match_addr;
-                	end
-                	lookup_state <= IDLE_S;
-					// ready_out <= 1'b1;
-				end
-			end
-        endcase
+        end
+        else begin
+            phv_out <= 0;
+            phv_out_valid <= 0;
+            if_match <= 0;
+            match_addr_out <= 4'hf;
+        end
     end
 end
 
@@ -162,17 +178,12 @@
 
 reg  [7:0]          c_index_act;
 reg                 c_wr_en_act;
-reg  [ACT_LEN-1:0]  act_entry_tmp;             
 reg                 continous_flag;
 reg [204:0]         cam_entry_reg;
 
 
 reg [2:0]           c_state;
 
-/****for 256b exclusively*****/
-reg                                 c_m_axis_tvalid_r;
-reg                                 c_m_axis_tlast_r;
-
 
 localparam IDLE_C = 0,
            PARSE_C = 1,
@@ -183,133 +194,111 @@
            ACT_TMP_ENTRY = 6,
 		   FLUSH_REST_C = 7;
 
-generate 
-    if(C_S_AXIS_DATA_WIDTH == 512) begin
-        assign mod_id = c_s_axis_tdata[368+:8];
-        assign resv   = c_s_axis_tdata[376+:4];
-        assign control_flag = c_s_axis_tdata[335:320];
-        //LE to BE switching
-        wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
-
-		assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
-											c_s_axis_tdata[8+:8],
-											c_s_axis_tdata[16+:8],
-											c_s_axis_tdata[24+:8],
-											c_s_axis_tdata[32+:8],
-											c_s_axis_tdata[40+:8],
-											c_s_axis_tdata[48+:8],
-											c_s_axis_tdata[56+:8],
-											c_s_axis_tdata[64+:8],
-											c_s_axis_tdata[72+:8],
-											c_s_axis_tdata[80+:8],
-											c_s_axis_tdata[88+:8],
-											c_s_axis_tdata[96+:8],
-											c_s_axis_tdata[104+:8],
-											c_s_axis_tdata[112+:8],
-											c_s_axis_tdata[120+:8],
-											c_s_axis_tdata[128+:8],
-											c_s_axis_tdata[136+:8],
-											c_s_axis_tdata[144+:8],
-											c_s_axis_tdata[152+:8],
-											c_s_axis_tdata[160+:8],
-											c_s_axis_tdata[168+:8],
-											c_s_axis_tdata[176+:8],
-											c_s_axis_tdata[184+:8],
-											c_s_axis_tdata[192+:8],
-											c_s_axis_tdata[200+:8],
-											c_s_axis_tdata[208+:8],
-											c_s_axis_tdata[216+:8],
-											c_s_axis_tdata[224+:8],
-											c_s_axis_tdata[232+:8],
-											c_s_axis_tdata[240+:8],
-											c_s_axis_tdata[248+:8],
-                                            c_s_axis_tdata[256+:8],
-                                            c_s_axis_tdata[264+:8],
-                                            c_s_axis_tdata[272+:8],
-                                            c_s_axis_tdata[280+:8],
-                                            c_s_axis_tdata[288+:8],
-                                            c_s_axis_tdata[296+:8],
-                                            c_s_axis_tdata[304+:8],
-                                            c_s_axis_tdata[312+:8],
-                                            c_s_axis_tdata[320+:8],
-                                            c_s_axis_tdata[328+:8],
-                                            c_s_axis_tdata[336+:8],
-                                            c_s_axis_tdata[344+:8],
-                                            c_s_axis_tdata[352+:8],
-                                            c_s_axis_tdata[360+:8],
-                                            c_s_axis_tdata[368+:8],
-                                            c_s_axis_tdata[376+:8],
-                                            c_s_axis_tdata[384+:8],
-                                            c_s_axis_tdata[392+:8],
-                                            c_s_axis_tdata[400+:8],
-                                            c_s_axis_tdata[408+:8],
-                                            c_s_axis_tdata[416+:8],
-                                            c_s_axis_tdata[424+:8],
-                                            c_s_axis_tdata[432+:8],
-                                            c_s_axis_tdata[440+:8],
-                                            c_s_axis_tdata[448+:8],
-                                            c_s_axis_tdata[456+:8],
-                                            c_s_axis_tdata[464+:8],
-                                            c_s_axis_tdata[472+:8],
-                                            c_s_axis_tdata[480+:8],
-                                            c_s_axis_tdata[488+:8],
-                                            c_s_axis_tdata[496+:8],
-                                            c_s_axis_tdata[504+:8]
-                                            };
-        always @(posedge clk or negedge rst_n) begin
-            if(~rst_n) begin
-                c_index_cam <= 0;
-                c_wr_en_cam <= 0;
-
-                c_index_act <= 0;
-                c_wr_en_act <= 0;
-
-                act_entry_tmp <= 0;
-                cam_entry_reg <= 0;
-                continous_flag <= 0;
-
-                c_m_axis_tdata <= 0;
-                c_m_axis_tuser <= 0;
-                c_m_axis_tkeep <= 0;
-                c_m_axis_tvalid <= 0;
-                c_m_axis_tlast <= 0;
+generate
+    assign mod_id = c_s_axis_tdata[368+:8];
+    assign resv   = c_s_axis_tdata[376+:4];
+    assign control_flag = c_s_axis_tdata[303:288];
+    //LE to BE switching
+    wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
+
+    assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
+									    c_s_axis_tdata[8+:8],
+									    c_s_axis_tdata[16+:8],
+									    c_s_axis_tdata[24+:8],
+									    c_s_axis_tdata[32+:8],
+									    c_s_axis_tdata[40+:8],
+									    c_s_axis_tdata[48+:8],
+									    c_s_axis_tdata[56+:8],
+									    c_s_axis_tdata[64+:8],
+									    c_s_axis_tdata[72+:8],
+									    c_s_axis_tdata[80+:8],
+									    c_s_axis_tdata[88+:8],
+									    c_s_axis_tdata[96+:8],
+									    c_s_axis_tdata[104+:8],
+									    c_s_axis_tdata[112+:8],
+									    c_s_axis_tdata[120+:8],
+									    c_s_axis_tdata[128+:8],
+									    c_s_axis_tdata[136+:8],
+									    c_s_axis_tdata[144+:8],
+									    c_s_axis_tdata[152+:8],
+									    c_s_axis_tdata[160+:8],
+									    c_s_axis_tdata[168+:8],
+									    c_s_axis_tdata[176+:8],
+									    c_s_axis_tdata[184+:8],
+									    c_s_axis_tdata[192+:8],
+									    c_s_axis_tdata[200+:8],
+									    c_s_axis_tdata[208+:8],
+									    c_s_axis_tdata[216+:8],
+									    c_s_axis_tdata[224+:8],
+									    c_s_axis_tdata[232+:8],
+									    c_s_axis_tdata[240+:8],
+									    c_s_axis_tdata[248+:8],
+                                        c_s_axis_tdata[256+:8],
+                                        c_s_axis_tdata[264+:8],
+                                        c_s_axis_tdata[272+:8],
+                                        c_s_axis_tdata[280+:8],
+                                        c_s_axis_tdata[288+:8],
+                                        c_s_axis_tdata[296+:8],
+                                        c_s_axis_tdata[304+:8],
+                                        c_s_axis_tdata[312+:8],
+                                        c_s_axis_tdata[320+:8],
+                                        c_s_axis_tdata[328+:8],
+                                        c_s_axis_tdata[336+:8],
+                                        c_s_axis_tdata[344+:8],
+                                        c_s_axis_tdata[352+:8],
+                                        c_s_axis_tdata[360+:8],
+                                        c_s_axis_tdata[368+:8],
+                                        c_s_axis_tdata[376+:8],
+                                        c_s_axis_tdata[384+:8],
+                                        c_s_axis_tdata[392+:8],
+                                        c_s_axis_tdata[400+:8],
+                                        c_s_axis_tdata[408+:8],
+                                        c_s_axis_tdata[416+:8],
+                                        c_s_axis_tdata[424+:8],
+                                        c_s_axis_tdata[432+:8],
+                                        c_s_axis_tdata[440+:8],
+                                        c_s_axis_tdata[448+:8],
+                                        c_s_axis_tdata[456+:8],
+                                        c_s_axis_tdata[464+:8],
+                                        c_s_axis_tdata[472+:8],
+                                        c_s_axis_tdata[480+:8],
+                                        c_s_axis_tdata[488+:8],
+                                        c_s_axis_tdata[496+:8],
+                                        c_s_axis_tdata[504+:8]
+                                        };
+    always @(posedge clk or negedge rst_n) begin
+        if(~rst_n) begin
+            c_index_cam <= 0;
+            c_wr_en_cam <= 0;
+
+            c_index_act <= 0;
+            c_wr_en_act <= 0;
+
+            cam_entry_reg <= 0;
+            continous_flag <= 0;
+
+            c_m_axis_tdata <= 0;
+            c_m_axis_tuser <= 0;
+            c_m_axis_tkeep <= 0;
+            c_m_axis_tvalid <= 0;
+            c_m_axis_tlast <= 0;
 
-                c_state <= IDLE_C;
+            c_state <= IDLE_C;
 
-            end
-
-            else begin
-                case(c_state)
-                    IDLE_C: begin
-                        if(c_s_axis_tvalid) begin
-                            if(mod_id[7:3] == STAGE_ID && mod_id[2:0] == LOOKUP_ID 
-									&& control_flag == 16'hf2f1
-									&& resv == 4'b0) begin // TCAM entry
-                                c_wr_en_cam <= 1'b0;
-                                c_index_cam <= c_s_axis_tdata[384+:8];
-                                c_state <= CAM_TMP_ENTRY;
-                            end
-                            //not for lookup
-                            else begin
-                                c_index_cam <= 0;
-                                c_wr_en_cam <= 0;
-
-                                c_index_act <= 0;
-                                c_wr_en_act <= 0;
-
-                                act_entry_tmp <= 0;
-                                continous_flag <= 0;
-
-                                c_m_axis_tdata <= c_s_axis_tdata;
-                                c_m_axis_tuser <= c_s_axis_tuser;
-                                c_m_axis_tkeep <= c_s_axis_tkeep;
-                                c_m_axis_tvalid <= c_s_axis_tvalid;
-                                c_m_axis_tlast <= c_s_axis_tlast;
+        end
 
-                                c_state <= IDLE_C;
-                            end
+        else begin
+            case(c_state)
+                IDLE_C: begin
+                    if(c_s_axis_tvalid) begin
+                        if(mod_id[7:3] == STAGE_ID && mod_id[2:0] == LOOKUP_ID 
+							    && control_flag == 16'hf2f1
+							    && resv == 4'b0) begin // TCAM entry
+                            c_wr_en_cam <= 1'b0;
+                            c_index_cam <= c_s_axis_tdata[384+:8];
+                            c_state <= CAM_TMP_ENTRY;
                         end
-                        //stay halt
+                        //not for lookup
                         else begin
                             c_index_cam <= 0;
                             c_wr_en_cam <= 0;
@@ -317,391 +306,165 @@
                             c_index_act <= 0;
                             c_wr_en_act <= 0;
 
-                            act_entry_tmp <= 0;
                             continous_flag <= 0;
 
-                            c_m_axis_tdata <= 0;
-                            c_m_axis_tuser <= 0;
-                            c_m_axis_tkeep <= 0;
-                            c_m_axis_tvalid <= 0;
-                            c_m_axis_tlast <= 0;
+                            c_m_axis_tdata <= c_s_axis_tdata;
+                            c_m_axis_tuser <= c_s_axis_tuser;
+                            c_m_axis_tkeep <= c_s_axis_tkeep;
+                            c_m_axis_tvalid <= c_s_axis_tvalid;
+                            c_m_axis_tlast <= c_s_axis_tlast;
 
                             c_state <= IDLE_C;
                         end
                     end
+                    //stay halt
+                    else begin
+                        c_index_cam <= 0;
+                        c_wr_en_cam <= 0;
+
+                        c_index_act <= 0;
+                        c_wr_en_act <= 0;
+
+                        continous_flag <= 0;
+
+                        c_m_axis_tdata <= 0;
+                        c_m_axis_tuser <= 0;
+                        c_m_axis_tkeep <= 0;
+                        c_m_axis_tvalid <= 0;
+                        c_m_axis_tlast <= 0;
 
-                    CAM_TMP_ENTRY: begin
-                        if(c_s_axis_tvalid) begin
-                            cam_entry_reg <= c_s_axis_tdata_swapped[511 -: 205];
-                            c_wr_en_cam <= 1'b1;
-                            if(c_s_axis_tlast) begin
-                                c_state <= IDLE_C;
-                            end
-                            else begin
-                                c_state <= SU_CAM_TMP_ENTRY;
-                            end
+                        c_state <= IDLE_C;
+                    end
+                end
+
+                CAM_TMP_ENTRY: begin
+                    if(c_s_axis_tvalid) begin
+                        cam_entry_reg <= c_s_axis_tdata_swapped[511 -: 205];
+                        c_wr_en_cam <= 1'b1;
+                        if(c_s_axis_tlast) begin
+                            c_state <= IDLE_C;
                         end
                         else begin
-                            c_wr_en_cam <= 1'b0;
+                            c_state <= SU_CAM_TMP_ENTRY;
                         end
                     end
+                    else begin
+                        c_wr_en_cam <= 1'b0;
+                    end
+                end
 
-                    SU_CAM_TMP_ENTRY: begin
-                        if(c_s_axis_tvalid) begin
-                            cam_entry_reg <= c_s_axis_tdata_swapped[511 -: 205];
-                            c_wr_en_cam <= 1'b1;
-                            c_index_cam <= c_index_cam + 1'b1;
-                            if(c_s_axis_tlast) begin
-                                c_state <= IDLE_C;
-                            end
-                            else begin
-                                c_state <= SU_CAM_TMP_ENTRY;
-                            end
+                SU_CAM_TMP_ENTRY: begin
+                    if(c_s_axis_tvalid) begin
+                        cam_entry_reg <= c_s_axis_tdata_swapped[511 -: 205];
+                        c_wr_en_cam <= 1'b1;
+                        c_index_cam <= c_index_cam + 1'b1;
+                        if(c_s_axis_tlast) begin
+                            c_state <= IDLE_C;
                         end
                         else begin
-                            c_wr_en_cam <= 1'b0;
+                            c_state <= SU_CAM_TMP_ENTRY;
                         end
                     end
-                endcase
-            end
+                    else begin
+                        c_wr_en_cam <= 1'b0;
+                    end
+                end
+            endcase
         end
-
-		if (STAGE_ID == 4) begin
-			// tcam1 for lookup
-        	cam_top # ( 
-        	    .C_DEPTH			(16),
-        	    // .C_WIDTH			(256),
-        	    .C_WIDTH			(205),
-        	    .C_MEM_INIT			(0)
-        	    // .C_MEM_INIT_FILE	("./cam_init_file.mif")
-        	)
-        	cam_0
-        	(
-        	    .CLK				(clk),
-        	    .CMP_DIN			({vlan_id[3:0], vlan_id[11:4], extract_key}),
-        	    //.CMP_DATA_MASK		({4'b1111, extract_mask}),
-        	    .CMP_DATA_MASK      (),
-				.BUSY				(),
-        	    .MATCH				(match),
-        	    .MATCH_ADDR			(match_addr[3:0]),
-
-        	    //.WE				(lookup_din_en),
-        	    //.WR_ADDR			(lookup_din_addr),
-        	    //.DATA_MASK		(lookup_din_mask),  
-        	    //.DIN				(lookup_din),
-
-        	    .WE                 (c_wr_en_cam),
-        	    .WR_ADDR            (c_index_cam[3:0]),
-        	    .DATA_MASK          (),  //TODO do we need ternary matching?
-        	    .DIN                (cam_entry_reg),
-        	    .EN					(1'b1)
-        	);
-		end
-		else begin
-			// tcam1 for lookup
-        	cam_top # ( 
-        	    .C_DEPTH			(16),
-        	    // .C_WIDTH			(256),
-        	    .C_WIDTH			(205),
-        	    .C_MEM_INIT			(0)
-        	    // .C_MEM_INIT_FILE	("./cam_init_file.mif")
-        	)
-        	cam_0
-        	(
-        	    .CLK				(clk),
-        	    .CMP_DIN			({vlan_id[3:0], vlan_id[11:4], extract_key}),
-        	    //.CMP_DATA_MASK		({4'b0000, extract_mask}),
-        	    .CMP_DATA_MASK      (),
-        	    .BUSY				(),
-        	    .MATCH				(match),
-        	    .MATCH_ADDR			(match_addr[3:0]),
-
-        	    //.WE				(lookup_din_en),
-        	    //.WR_ADDR			(lookup_din_addr),
-        	    //.DATA_MASK		(lookup_din_mask),  
-        	    //.DIN				(lookup_din),
-
-        	    .WE                 (c_wr_en_cam),
-        	    .WR_ADDR            (c_index_cam[3:0]),
-        	    .DATA_MASK          (),  //TODO do we need ternary matching?
-        	    .DIN                (cam_entry_reg),
-        	    .EN					(1'b1)
-        	);
-		end
     end
-    //NOTE: data width is 256b
-    else begin
-		wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
-		assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
-											c_s_axis_tdata[8+:8],
-											c_s_axis_tdata[16+:8],
-											c_s_axis_tdata[24+:8],
-											c_s_axis_tdata[32+:8],
-											c_s_axis_tdata[40+:8],
-											c_s_axis_tdata[48+:8],
-											c_s_axis_tdata[56+:8],
-											c_s_axis_tdata[64+:8],
-											c_s_axis_tdata[72+:8],
-											c_s_axis_tdata[80+:8],
-											c_s_axis_tdata[88+:8],
-											c_s_axis_tdata[96+:8],
-											c_s_axis_tdata[104+:8],
-											c_s_axis_tdata[112+:8],
-											c_s_axis_tdata[120+:8],
-											c_s_axis_tdata[128+:8],
-											c_s_axis_tdata[136+:8],
-											c_s_axis_tdata[144+:8],
-											c_s_axis_tdata[152+:8],
-											c_s_axis_tdata[160+:8],
-											c_s_axis_tdata[168+:8],
-											c_s_axis_tdata[176+:8],
-											c_s_axis_tdata[184+:8],
-											c_s_axis_tdata[192+:8],
-											c_s_axis_tdata[200+:8],
-											c_s_axis_tdata[208+:8],
-											c_s_axis_tdata[216+:8],
-											c_s_axis_tdata[224+:8],
-											c_s_axis_tdata[232+:8],
-											c_s_axis_tdata[240+:8],
-											c_s_axis_tdata[248+:8]};
-
-        assign mod_id = c_s_axis_tdata[112+:8];
-        assign resv = c_s_axis_tdata[120+:4];
-        assign control_flag = c_s_axis_tdata[64+:16];
-		// 
-		reg [2:0] c_state_next;
-		reg [C_S_AXIS_DATA_WIDTH-1:0]		r_tdata, c_s_axis_tdata_d1;
-		reg [C_S_AXIS_TUSER_WIDTH-1:0]		r_tuser, c_s_axis_tuser_d1;
-		reg [C_S_AXIS_DATA_WIDTH/8-1:0]		r_tkeep, c_s_axis_tkeep_d1;
-		reg									r_tlast, c_s_axis_tlast_d1;
-		reg									r_tvalid, c_s_axis_tvalid_d1;
-
-		reg [C_S_AXIS_DATA_WIDTH-1:0]		r_1st_tdata, r_1st_tdata_next;
-		reg [C_S_AXIS_TUSER_WIDTH-1:0]		r_1st_tuser, r_1st_tuser_next;
-		reg [C_S_AXIS_DATA_WIDTH/8-1:0]		r_1st_tkeep, r_1st_tkeep_next;
-		reg									r_1st_tlast, r_1st_tlast_next;
-		reg									r_1st_tvalid, r_1st_tvalid_next;
-
-		reg [7:0]							c_index_cam_next, c_index_act_next;
-		reg									c_wr_en_cam_next, c_wr_en_act_next;
-		reg [204:0]							c_wr_cam_data, c_wr_cam_data_next;
-		reg [ACT_LEN-1:0]					c_wr_act_data, c_wr_act_data_next;
-
-		always @(*) begin
-			c_state_next = c_state;
-
-			r_tdata = 0;
-			r_tkeep = 0;
-			r_tuser = 0;
-			r_tlast = 0;
-			r_tvalid = 0;
-
-			r_1st_tdata_next = r_1st_tdata;
-			r_1st_tkeep_next = r_1st_tkeep;
-			r_1st_tuser_next = r_1st_tuser;
-			r_1st_tlast_next = r_1st_tlast;
-			r_1st_tvalid_next = r_1st_tvalid;
-
-			c_index_cam_next = c_index_cam;
-			c_index_act_next = c_index_act;
-			c_wr_en_cam_next = 0;
-			c_wr_en_act_next = 0;
-			c_wr_cam_data_next = c_wr_cam_data;
-			c_wr_act_data_next = c_wr_act_data;
-
-			case (c_state) 
-				IDLE_C: begin // 1st segment
-					r_tvalid = 0;
-					if (c_s_axis_tvalid) begin
-						// store 1st segment
-						r_1st_tdata_next = c_s_axis_tdata;
-						r_1st_tuser_next = c_s_axis_tuser;
-						r_1st_tkeep_next = c_s_axis_tkeep;
-						r_1st_tlast_next = c_s_axis_tlast;
-						r_1st_tvalid_next = c_s_axis_tvalid;
-
-						c_state_next = PARSE_C;
-					end
-				end
-				PARSE_C: begin // 2nd segment
-					if (mod_id[7:3] == STAGE_ID && mod_id[2:0] == LOOKUP_ID && 
-						control_flag == 16'hf2f1 && c_s_axis_tvalid && resv==4'b0) begin
-						// should not emit segment
-						c_index_cam_next = c_s_axis_tdata[128+:8];
-						c_state_next = CAM_TMP_ENTRY;
-					end
-					else if (!c_s_axis_tvalid) begin
-					end
-					else begin
-						// emit
-						r_tdata = r_1st_tdata;
-						r_tkeep = r_1st_tkeep;
-						r_tuser = r_1st_tuser;
-						r_tlast = r_1st_tlast;
-						r_tvalid = r_1st_tvalid;
-						c_state_next = FLUSH_REST_C;
-					end
-				end
-				CAM_TMP_ENTRY: begin
-					if (c_s_axis_tvalid) begin
-						c_wr_en_cam_next = 1; // next clk to write
-						c_wr_cam_data_next = c_s_axis_tdata_swapped[51+:205];
-						
-						c_state_next = IDLE_C;
-					end
-				end
-				FLUSH_REST_C: begin
-					c_wr_en_cam_next = 0;
-					c_wr_en_act_next = 0;
-					r_tdata = c_s_axis_tdata_d1;
-					r_tkeep = c_s_axis_tkeep_d1;
-					r_tuser = c_s_axis_tuser_d1;
-					r_tlast = c_s_axis_tlast_d1;
-					r_tvalid = c_s_axis_tvalid_d1;
-					if (c_s_axis_tvalid_d1 && c_s_axis_tlast_d1) begin
-						c_state_next = IDLE_C;
-					end
-				end
-			endcase
-		end
-
-		always @(posedge clk) begin
-			if (~rst_n) begin
-				c_state <= IDLE_C;
-
-				// control output
-				c_m_axis_tdata <= 0;
-				c_m_axis_tuser <= 0;
-				c_m_axis_tkeep <= 0;
-				c_m_axis_tlast <= 0;
-				c_m_axis_tvalid <= 0;
-				//
-				c_index_cam <= 0;
-				c_index_act <= 0;
-				c_wr_en_cam <= 0;
-				c_wr_en_act <= 0;
-				c_wr_cam_data <= 0;
-				c_wr_act_data <= 0;
-			end
-			else begin
-				c_state <= c_state_next;
-
-
-				// output ctrl master signals
-				c_m_axis_tdata <= r_tdata;
-				c_m_axis_tkeep <= r_tkeep;
-				c_m_axis_tuser <= r_tuser;
-				c_m_axis_tlast <= r_tlast;
-				c_m_axis_tvalid <= r_tvalid;
-				//
-				c_index_cam <= c_index_cam_next;
-				c_index_act <= c_index_act_next;
-				c_wr_en_cam <= c_wr_en_cam_next;
-				c_wr_en_act <= c_wr_en_act_next;
-				c_wr_cam_data <= c_wr_cam_data_next;
-				c_wr_act_data <= c_wr_act_data_next;
-			end
-		end
-
-		always @(posedge clk) begin
-			if (~rst_n) begin
-				// delayed 1 clk
-				c_s_axis_tdata_d1 <= 0;
-				c_s_axis_tuser_d1 <= 0;
-				c_s_axis_tkeep_d1 <= 0;
-				c_s_axis_tlast_d1 <= 0;
-				c_s_axis_tvalid_d1 <= 0;
-				//
-				r_1st_tdata <= 0;
-				r_1st_tkeep <= 0;
-				r_1st_tuser <= 0;
-				r_1st_tlast <= 0;
-				r_1st_tvalid <= 0;
-			end
-			else begin
-				// delayed 1 clk
-				c_s_axis_tdata_d1 <= c_s_axis_tdata;
-				c_s_axis_tuser_d1 <= c_s_axis_tuser;
-				c_s_axis_tkeep_d1 <= c_s_axis_tkeep;
-				c_s_axis_tlast_d1 <= c_s_axis_tlast;
-				c_s_axis_tvalid_d1 <= c_s_axis_tvalid;
-				// 
-				r_1st_tdata <= r_1st_tdata_next;
-				r_1st_tkeep <= r_1st_tkeep_next;
-				r_1st_tuser <= r_1st_tuser_next;
-				r_1st_tlast <= r_1st_tlast_next;
-				r_1st_tvalid <= r_1st_tvalid_next;
-			end
-		end
-
-		if (STAGE_ID == 4) begin
-			// tcam1 for lookup
-        	cam_top # ( 
-        	    .C_DEPTH			(16),
-        	    // .C_WIDTH			(256),
-        	    .C_WIDTH			(205), // 192+1+12
-        	    .C_MEM_INIT			(0)
-        	    // .C_MEM_INIT_FILE	("./cam_init_file.mif")
-        	)
-        	//TODO remember to change it back.
-        	cam_0
-        	(
-        	    .CLK				(clk),
-        	    .CMP_DIN			({vlan_id[3:0], vlan_id[11:4], extract_key}),
-        	    // .CMP_DATA_MASK		({4'b1111, extract_mask}),
-        	    .CMP_DATA_MASK		(),
-        	    .BUSY				(),
-        	    .MATCH				(match),
-        	    .MATCH_ADDR			(match_addr),
-
-        	    //.WE				(lookup_din_en),
-        	    //.WR_ADDR			(lookup_din_addr),
-        	    //.DATA_MASK		(lookup_din_mask),  
-        	    //.DIN				(lookup_din),
-
-        	    .WE                 (c_wr_en_cam),
-        	    .WR_ADDR            (c_index_cam[3:0]),
-        	    // .WR_ADDR            (c_index_cam),
-        	    .DATA_MASK          (),  //TODO do we need ternary matching?
-        	    .DIN                (c_wr_cam_data),
-        	    .EN					(1'b1)
-        	);
-		end
-		else begin
-			// tcam1 for lookup
-        	cam_top # ( 
-        	    .C_DEPTH			(16),
-        	    // .C_WIDTH			(256),
-        	    .C_WIDTH			(205), // 192+1+12
-        	    .C_MEM_INIT			(0)
-        	    // .C_MEM_INIT_FILE	("./cam_init_file.mif")
-        	)
-        	//TODO remember to change it back.
-        	cam_0
-        	(
-        	    .CLK				(clk),
-        	    .CMP_DIN			({vlan_id[3:0], vlan_id[11:4], extract_key}),
-        	    // .CMP_DATA_MASK		({4'b0000, extract_mask}),
-        	    .CMP_DATA_MASK		(),
-        	    .BUSY				(),
-        	    .MATCH				(match),
-        	    .MATCH_ADDR			(match_addr),
-
-        	    //.WE				(lookup_din_en),
-        	    //.WR_ADDR			(lookup_din_addr),
-        	    //.DATA_MASK		(lookup_din_mask),  
-        	    //.DIN				(lookup_din),
-
-        	    .WE                 (c_wr_en_cam),
-        	    .WR_ADDR            (c_index_cam[3:0]),
-        	    // .WR_ADDR            (c_index_cam),
-        	    .DATA_MASK          (),  //TODO do we need ternary matching?
-        	    .DIN                (c_wr_cam_data),
-        	    .EN					(1'b1)
-        	);
-		end
+    
+    always @(posedge clk) begin
+        if(~rst_n) begin
+            rst_busy <= 0;
+            
+            cam_in <= 0;
+            key_valid_r <= 0;
+            ready_in_r <= 0;
+            
+            cam_out_data <= 0;
+            cam_out_valid <= 0;
+            cam_lkup_ready <= 0;
+            
+            conf_in <= 0;
+            c_wr_en_cam_r <= 0;
+            
+            cam_hwui_ready <= 0;
+        end
+        else begin
+            rst_busy <= rst_busy_r;
+            
+            cam_in <= {3'b000, vlan_id_ff[3:0], vlan_id_ff[11:4], extract_key_ff};
+            key_valid_r <= key_valid_ff;
+            ready_in_r <= ready_in;
+            
+            cam_out_data <= cam_out_data_r;
+            cam_out_valid <= cam_out_valid_r;
+            cam_lkup_ready <= cam_lkup_ready_r;
+            
+            conf_in <= {4'b0000, c_index_cam[3:0], 3'b000, cam_entry_reg, 8'h00};
+            c_wr_en_cam_r <= c_wr_en_cam;
+            
+            cam_hwui_ready <= cam_hwui_ready_r;
+        end
     end
-
+    
+    cam_top
+    cam_inst
+    (
+        // Inputs
+        .s_axi_aclk(clk),
+        .s_axi_aresetn(cam_rst),
+        .rstn(cam_rst),
+        .key_clk(clk),
+        .ram_clk(clk),
+        
+        // Outputs
+        .rst_busy(rst_busy_r),
+        .sbiterr(),
+        .dbiterr(),
+        .debug_status(),
+        
+        // axi stream inputs
+        .s_axis_lkup_tdata(cam_in),
+        .s_axis_lkup_tvalid(key_valid_r),
+        .m_axis_lkup_tready(ready_in_r),
+        
+        // axi stream outputs
+        .m_axis_lkup_tdata(cam_out_data_r),
+        .m_axis_lkup_tvalid(cam_out_valid_r),
+        .s_axis_lkup_tready(cam_lkup_ready_r),
+        
+        // axi stream config in
+        .s_axis_hwui_tdata(conf_in),
+        .s_axis_hwui_tvalid(c_wr_en_cam_r),
+        .m_axis_hwui_tready(1'b1),
+        
+        // axi stream config out
+        .m_axis_hwui_tdata(),
+        .m_axis_hwui_tvalid(),
+        .s_axis_hwui_tready(cam_hwui_ready_r),
+        
+        // axi light inputs
+        .s_axi_araddr(13'b0000000000000),
+        .s_axi_arvalid(1'b0),
+        .s_axi_rready(1'b1),
+        .s_axi_awaddr(13'b0000000000000),
+        .s_axi_awvalid(1'b0),
+        .s_axi_wdata(32'h00000000),
+        .s_axi_wvalid(1'b0),
+        .s_axi_wstrb(4'b0000),
+        .s_axi_bready(1'b1),
+        
+        // axi light outputs
+        .s_axi_rdata(),
+        .s_axi_rresp(),
+        .s_axi_rvalid(),
+        .s_axi_arready(),
+        .s_axi_bresp(),
+        .s_axi_bvalid(),
+        .s_axi_awready(),
+        .s_axi_wready()
+    );
 endgenerate
 
 endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/lookup/lke_ram_part.v parametric_menshen/lookup/lke_ram_part.v
--- menshen/lookup/lke_ram_part.v	2025-05-06 16:14:21.368210000 +0200
+++ parametric_menshen/lookup/lke_ram_part.v	2025-05-06 16:51:43.107256295 +0200
@@ -164,10 +164,6 @@
 
 reg [2:0]           c_state;
 
-/****for 256b exclusively*****/
-reg                                 c_m_axis_tvalid_r;
-reg                                 c_m_axis_tlast_r;
-
 
 localparam IDLE_C = 0,
            PARSE_C = 1,
@@ -178,134 +174,113 @@
            ACT_TMP_ENTRY = 6,
 		   FLUSH_REST_C = 7;
 
-generate 
-    if(C_S_AXIS_DATA_WIDTH == 512) begin
-        assign mod_id = c_s_axis_tdata[368+:8];
-        assign resv   = c_s_axis_tdata[376+:4];
-        assign control_flag = c_s_axis_tdata[335:320];
-        //LE to BE switching
-        wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
-
-		assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
-											c_s_axis_tdata[8+:8],
-											c_s_axis_tdata[16+:8],
-											c_s_axis_tdata[24+:8],
-											c_s_axis_tdata[32+:8],
-											c_s_axis_tdata[40+:8],
-											c_s_axis_tdata[48+:8],
-											c_s_axis_tdata[56+:8],
-											c_s_axis_tdata[64+:8],
-											c_s_axis_tdata[72+:8],
-											c_s_axis_tdata[80+:8],
-											c_s_axis_tdata[88+:8],
-											c_s_axis_tdata[96+:8],
-											c_s_axis_tdata[104+:8],
-											c_s_axis_tdata[112+:8],
-											c_s_axis_tdata[120+:8],
-											c_s_axis_tdata[128+:8],
-											c_s_axis_tdata[136+:8],
-											c_s_axis_tdata[144+:8],
-											c_s_axis_tdata[152+:8],
-											c_s_axis_tdata[160+:8],
-											c_s_axis_tdata[168+:8],
-											c_s_axis_tdata[176+:8],
-											c_s_axis_tdata[184+:8],
-											c_s_axis_tdata[192+:8],
-											c_s_axis_tdata[200+:8],
-											c_s_axis_tdata[208+:8],
-											c_s_axis_tdata[216+:8],
-											c_s_axis_tdata[224+:8],
-											c_s_axis_tdata[232+:8],
-											c_s_axis_tdata[240+:8],
-											c_s_axis_tdata[248+:8],
-                                            c_s_axis_tdata[256+:8],
-                                            c_s_axis_tdata[264+:8],
-                                            c_s_axis_tdata[272+:8],
-                                            c_s_axis_tdata[280+:8],
-                                            c_s_axis_tdata[288+:8],
-                                            c_s_axis_tdata[296+:8],
-                                            c_s_axis_tdata[304+:8],
-                                            c_s_axis_tdata[312+:8],
-                                            c_s_axis_tdata[320+:8],
-                                            c_s_axis_tdata[328+:8],
-                                            c_s_axis_tdata[336+:8],
-                                            c_s_axis_tdata[344+:8],
-                                            c_s_axis_tdata[352+:8],
-                                            c_s_axis_tdata[360+:8],
-                                            c_s_axis_tdata[368+:8],
-                                            c_s_axis_tdata[376+:8],
-                                            c_s_axis_tdata[384+:8],
-                                            c_s_axis_tdata[392+:8],
-                                            c_s_axis_tdata[400+:8],
-                                            c_s_axis_tdata[408+:8],
-                                            c_s_axis_tdata[416+:8],
-                                            c_s_axis_tdata[424+:8],
-                                            c_s_axis_tdata[432+:8],
-                                            c_s_axis_tdata[440+:8],
-                                            c_s_axis_tdata[448+:8],
-                                            c_s_axis_tdata[456+:8],
-                                            c_s_axis_tdata[464+:8],
-                                            c_s_axis_tdata[472+:8],
-                                            c_s_axis_tdata[480+:8],
-                                            c_s_axis_tdata[488+:8],
-                                            c_s_axis_tdata[496+:8],
-                                            c_s_axis_tdata[504+:8]
-                                            };
-        always @(posedge clk or negedge rst_n) begin
-            if(~rst_n) begin
-                c_index_cam <= 0;
-                c_wr_en_cam <= 0;
-
-                c_index_act <= 0;
-                c_wr_en_act <= 0;
-
-                act_entry_tmp <= 0;
-                cam_entry_reg <= 0;
-                continous_flag <= 0;
-
-                c_m_axis_tdata <= 0;
-                c_m_axis_tuser <= 0;
-                c_m_axis_tkeep <= 0;
-                c_m_axis_tvalid <= 0;
-                c_m_axis_tlast <= 0;
-
-                c_state <= IDLE_C;
-
-            end
-
-            else begin
-                case(c_state)
-                    IDLE_C: begin
-                        if(c_s_axis_tvalid) begin
-                            if(mod_id[7:3] == STAGE_ID && mod_id[2:0] == LOOKUP_ID 
-									&& control_flag == 16'hf2f1
-									&& resv != 4'b0) begin
-                                //ACTION entry
-                                continous_flag <= 1'b0;
-                                c_index_act <= c_s_axis_tdata[384+:8];
-                                c_state <= ACT_TMP_ENTRY_WAIT;
-                            end
-                            //not for lookup
-                            else begin
-                                c_index_cam <= 0;
-                                c_wr_en_cam <= 0;
-
-                                c_index_act <= 0;
-                                c_wr_en_act <= 0;
-
-                                act_entry_tmp <= 0;
-                                continous_flag <= 0;
-
-                                c_m_axis_tdata <= c_s_axis_tdata;
-                                c_m_axis_tuser <= c_s_axis_tuser;
-                                c_m_axis_tkeep <= c_s_axis_tkeep;
-                                c_m_axis_tvalid <= c_s_axis_tvalid;
-                                c_m_axis_tlast <= c_s_axis_tlast;
+generate
+    assign mod_id = c_s_axis_tdata[368+:8];
+    assign resv   = c_s_axis_tdata[376+:4];
+    assign control_flag = c_s_axis_tdata[303:288];
+    //LE to BE switching
+    wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
+
+    assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
+									    c_s_axis_tdata[8+:8],
+									    c_s_axis_tdata[16+:8],
+									    c_s_axis_tdata[24+:8],
+									    c_s_axis_tdata[32+:8],
+									    c_s_axis_tdata[40+:8],
+									    c_s_axis_tdata[48+:8],
+									    c_s_axis_tdata[56+:8],
+									    c_s_axis_tdata[64+:8],
+									    c_s_axis_tdata[72+:8],
+									    c_s_axis_tdata[80+:8],
+									    c_s_axis_tdata[88+:8],
+									    c_s_axis_tdata[96+:8],
+									    c_s_axis_tdata[104+:8],
+									    c_s_axis_tdata[112+:8],
+									    c_s_axis_tdata[120+:8],
+									    c_s_axis_tdata[128+:8],
+									    c_s_axis_tdata[136+:8],
+									    c_s_axis_tdata[144+:8],
+									    c_s_axis_tdata[152+:8],
+									    c_s_axis_tdata[160+:8],
+									    c_s_axis_tdata[168+:8],
+									    c_s_axis_tdata[176+:8],
+									    c_s_axis_tdata[184+:8],
+									    c_s_axis_tdata[192+:8],
+									    c_s_axis_tdata[200+:8],
+									    c_s_axis_tdata[208+:8],
+									    c_s_axis_tdata[216+:8],
+									    c_s_axis_tdata[224+:8],
+									    c_s_axis_tdata[232+:8],
+									    c_s_axis_tdata[240+:8],
+									    c_s_axis_tdata[248+:8],
+                                        c_s_axis_tdata[256+:8],
+                                        c_s_axis_tdata[264+:8],
+                                        c_s_axis_tdata[272+:8],
+                                        c_s_axis_tdata[280+:8],
+                                        c_s_axis_tdata[288+:8],
+                                        c_s_axis_tdata[296+:8],
+                                        c_s_axis_tdata[304+:8],
+                                        c_s_axis_tdata[312+:8],
+                                        c_s_axis_tdata[320+:8],
+                                        c_s_axis_tdata[328+:8],
+                                        c_s_axis_tdata[336+:8],
+                                        c_s_axis_tdata[344+:8],
+                                        c_s_axis_tdata[352+:8],
+                                        c_s_axis_tdata[360+:8],
+                                        c_s_axis_tdata[368+:8],
+                                        c_s_axis_tdata[376+:8],
+                                        c_s_axis_tdata[384+:8],
+                                        c_s_axis_tdata[392+:8],
+                                        c_s_axis_tdata[400+:8],
+                                        c_s_axis_tdata[408+:8],
+                                        c_s_axis_tdata[416+:8],
+                                        c_s_axis_tdata[424+:8],
+                                        c_s_axis_tdata[432+:8],
+                                        c_s_axis_tdata[440+:8],
+                                        c_s_axis_tdata[448+:8],
+                                        c_s_axis_tdata[456+:8],
+                                        c_s_axis_tdata[464+:8],
+                                        c_s_axis_tdata[472+:8],
+                                        c_s_axis_tdata[480+:8],
+                                        c_s_axis_tdata[488+:8],
+                                        c_s_axis_tdata[496+:8],
+                                        c_s_axis_tdata[504+:8]
+                                        };
+    always @(posedge clk or negedge rst_n) begin
+        if(~rst_n) begin
+            c_index_cam <= 0;
+            c_wr_en_cam <= 0;
+
+            c_index_act <= 0;
+            c_wr_en_act <= 0;
+
+            act_entry_tmp <= 0;
+            cam_entry_reg <= 0;
+            continous_flag <= 0;
+
+            c_m_axis_tdata <= 0;
+            c_m_axis_tuser <= 0;
+            c_m_axis_tkeep <= 0;
+            c_m_axis_tvalid <= 0;
+            c_m_axis_tlast <= 0;
+
+            c_state <= IDLE_C;
 
-                                c_state <= IDLE_C;
-                            end
+        end
+
+        else begin
+            case(c_state)
+                IDLE_C: begin
+                    if(c_s_axis_tvalid) begin
+                        if(mod_id[7:3] == STAGE_ID && mod_id[2:0] == LOOKUP_ID 
+							    && control_flag == 16'hf2f1
+							    && resv != 4'b0) begin
+                            //ACTION entry
+                            continous_flag <= 1'b0;
+                            c_index_act <= c_s_axis_tdata[384+:8];
+                            c_state <= ACT_TMP_ENTRY_WAIT;
                         end
-                        //stay halt
+                        //not for lookup
                         else begin
                             c_index_cam <= 0;
                             c_wr_en_cam <= 0;
@@ -316,316 +291,95 @@
                             act_entry_tmp <= 0;
                             continous_flag <= 0;
 
-                            c_m_axis_tdata <= 0;
-                            c_m_axis_tuser <= 0;
-                            c_m_axis_tkeep <= 0;
-                            c_m_axis_tvalid <= 0;
-                            c_m_axis_tlast <= 0;
+                            c_m_axis_tdata <= c_s_axis_tdata;
+                            c_m_axis_tuser <= c_s_axis_tuser;
+                            c_m_axis_tkeep <= c_s_axis_tkeep;
+                            c_m_axis_tvalid <= c_s_axis_tvalid;
+                            c_m_axis_tlast <= c_s_axis_tlast;
 
                             c_state <= IDLE_C;
                         end
                     end
+                    //stay halt
+                    else begin
+                        c_index_cam <= 0;
+                        c_wr_en_cam <= 0;
+
+                        c_index_act <= 0;
+                        c_wr_en_act <= 0;
+
+                        act_entry_tmp <= 0;
+                        continous_flag <= 0;
+
+                        c_m_axis_tdata <= 0;
+                        c_m_axis_tuser <= 0;
+                        c_m_axis_tkeep <= 0;
+                        c_m_axis_tvalid <= 0;
+                        c_m_axis_tlast <= 0;
 
-                    ACT_TMP_ENTRY_WAIT: begin
-                        c_m_axis_tvalid_r <= 1'b0;
-                        c_m_axis_tlast_r <= 1'b0;
-                        //flush the whole table
-                        if(c_s_axis_tvalid && ~c_s_axis_tlast) begin
-                            if (continous_flag)   c_index_act <= c_index_act + 8'b1;
-                            else                  c_index_act <= c_index_act;
-                            act_entry_tmp[624 -: 512] <= c_s_axis_tdata_swapped;
-                            c_wr_en_act <= 1'b0;
-                            c_state <= ACT_TMP_ENTRY;
-                        end
-                        else if(c_s_axis_tvalid && c_s_axis_tlast) begin
-                            c_wr_en_act <= 1'b0;
-                            c_state <= IDLE_C;
-                        end
-                        else begin
-                            c_wr_en_act <= 1'b0;
-                            c_state <= c_state;
-                        end
+                        c_state <= IDLE_C;
                     end
+                end
 
-                    ACT_TMP_ENTRY: begin
-                        if(c_s_axis_tvalid) begin
-                            act_entry_tmp[112:0] <= c_s_axis_tdata_swapped[511-:113];
-                            c_wr_en_act <= 1'b1;
-                            if(c_s_axis_tlast)   c_state <= IDLE_C;
-                            else begin
-                                continous_flag <= 1'b1;
-                                c_state <= ACT_TMP_ENTRY_WAIT;
-                            end
-                        end
+                ACT_TMP_ENTRY_WAIT: begin
+                    //flush the whole table
+                    if(c_s_axis_tvalid && ~c_s_axis_tlast) begin
+                        if (continous_flag)   c_index_act <= c_index_act + 8'b1;
+                        else                  c_index_act <= c_index_act;
+                        act_entry_tmp[624 -: 512] <= c_s_axis_tdata_swapped;
+                        c_wr_en_act <= 1'b0;
+                        c_state <= ACT_TMP_ENTRY;
+                    end
+                    else if(c_s_axis_tvalid && c_s_axis_tlast) begin
+                        c_wr_en_act <= 1'b0;
+                        c_state <= IDLE_C;
+                    end
+                    else begin
+                        c_wr_en_act <= 1'b0;
+                        c_state <= c_state;
+                    end
+                end
+
+                ACT_TMP_ENTRY: begin
+                    if(c_s_axis_tvalid) begin
+                        act_entry_tmp[112:0] <= c_s_axis_tdata_swapped[511-:113];
+                        c_wr_en_act <= 1'b1;
+                        if(c_s_axis_tlast)   c_state <= IDLE_C;
                         else begin
-                            c_state <= c_state;
-                            act_entry_tmp <= act_entry_tmp;
-                            c_wr_en_act <= c_wr_en_act;
+                            continous_flag <= 1'b1;
+                            c_state <= ACT_TMP_ENTRY_WAIT;
                         end
                     end
+                    else begin
+                        c_state <= c_state;
+                        act_entry_tmp <= act_entry_tmp;
+                        c_wr_en_act <= c_wr_en_act;
+                    end
+                end
 
-                endcase
-            end
+            endcase
         end
-
-        //ram for action
-        // blk_mem_gen_1 #(
-        // 	.C_INIT_FILE_NAME	("./llup.mif"),
-        // 	.C_LOAD_INIT_FILE	(1)
-        // )
-        blk_mem_gen_1
-        act_ram_625w_16d
-        (
-            .addra(c_index_act[3:0]),
-            .clka(clk),
-            .dina(act_entry_tmp),
-            .ena(1'b1),
-            .wea(c_wr_en_act),
-
-            .addrb(match_addr[3:0]),
-            .clkb(clk),
-            .doutb(action_wire),
-            .enb(1'b1)
-        );
-
-    end
-    //NOTE: data width is 256b
-    else begin
-		wire[C_S_AXIS_DATA_WIDTH-1:0] c_s_axis_tdata_swapped;
-		assign c_s_axis_tdata_swapped = {	c_s_axis_tdata[0+:8],
-											c_s_axis_tdata[8+:8],
-											c_s_axis_tdata[16+:8],
-											c_s_axis_tdata[24+:8],
-											c_s_axis_tdata[32+:8],
-											c_s_axis_tdata[40+:8],
-											c_s_axis_tdata[48+:8],
-											c_s_axis_tdata[56+:8],
-											c_s_axis_tdata[64+:8],
-											c_s_axis_tdata[72+:8],
-											c_s_axis_tdata[80+:8],
-											c_s_axis_tdata[88+:8],
-											c_s_axis_tdata[96+:8],
-											c_s_axis_tdata[104+:8],
-											c_s_axis_tdata[112+:8],
-											c_s_axis_tdata[120+:8],
-											c_s_axis_tdata[128+:8],
-											c_s_axis_tdata[136+:8],
-											c_s_axis_tdata[144+:8],
-											c_s_axis_tdata[152+:8],
-											c_s_axis_tdata[160+:8],
-											c_s_axis_tdata[168+:8],
-											c_s_axis_tdata[176+:8],
-											c_s_axis_tdata[184+:8],
-											c_s_axis_tdata[192+:8],
-											c_s_axis_tdata[200+:8],
-											c_s_axis_tdata[208+:8],
-											c_s_axis_tdata[216+:8],
-											c_s_axis_tdata[224+:8],
-											c_s_axis_tdata[232+:8],
-											c_s_axis_tdata[240+:8],
-											c_s_axis_tdata[248+:8]};
-
-        assign mod_id = c_s_axis_tdata[112+:8];
-        assign resv = c_s_axis_tdata[120+:4];
-        assign control_flag = c_s_axis_tdata[64+:16];
-		// 
-		reg [2:0] c_state_next;
-		reg [C_S_AXIS_DATA_WIDTH-1:0]		r_tdata, c_s_axis_tdata_d1;
-		reg [C_S_AXIS_TUSER_WIDTH-1:0]		r_tuser, c_s_axis_tuser_d1;
-		reg [C_S_AXIS_DATA_WIDTH/8-1:0]		r_tkeep, c_s_axis_tkeep_d1;
-		reg									r_tlast, c_s_axis_tlast_d1;
-		reg									r_tvalid, c_s_axis_tvalid_d1;
-
-		reg [C_S_AXIS_DATA_WIDTH-1:0]		r_1st_tdata, r_1st_tdata_next;
-		reg [C_S_AXIS_TUSER_WIDTH-1:0]		r_1st_tuser, r_1st_tuser_next;
-		reg [C_S_AXIS_DATA_WIDTH/8-1:0]		r_1st_tkeep, r_1st_tkeep_next;
-		reg									r_1st_tlast, r_1st_tlast_next;
-		reg									r_1st_tvalid, r_1st_tvalid_next;
-
-		reg [7:0]							c_index_cam_next, c_index_act_next;
-		reg									c_wr_en_cam_next, c_wr_en_act_next;
-		reg [204:0]							c_wr_cam_data, c_wr_cam_data_next;
-		reg [ACT_LEN-1:0]					c_wr_act_data, c_wr_act_data_next;
-
-		always @(*) begin
-			c_state_next = c_state;
-
-			r_tdata = 0;
-			r_tkeep = 0;
-			r_tuser = 0;
-			r_tlast = 0;
-			r_tvalid = 0;
-
-			r_1st_tdata_next = r_1st_tdata;
-			r_1st_tkeep_next = r_1st_tkeep;
-			r_1st_tuser_next = r_1st_tuser;
-			r_1st_tlast_next = r_1st_tlast;
-			r_1st_tvalid_next = r_1st_tvalid;
-
-			c_index_cam_next = c_index_cam;
-			c_index_act_next = c_index_act;
-			c_wr_en_cam_next = 0;
-			c_wr_en_act_next = 0;
-			c_wr_cam_data_next = c_wr_cam_data;
-			c_wr_act_data_next = c_wr_act_data;
-
-			case (c_state) 
-				IDLE_C: begin // 1st segment
-					r_tvalid = 0;
-					if (c_s_axis_tvalid) begin
-						// store 1st segment
-						r_1st_tdata_next = c_s_axis_tdata;
-						r_1st_tuser_next = c_s_axis_tuser;
-						r_1st_tkeep_next = c_s_axis_tkeep;
-						r_1st_tlast_next = c_s_axis_tlast;
-						r_1st_tvalid_next = c_s_axis_tvalid;
-
-						c_state_next = PARSE_C;
-					end
-				end
-				PARSE_C: begin // 2nd segment
-					if (mod_id[7:3] == STAGE_ID && mod_id[2:0] == LOOKUP_ID && 
-						control_flag == 16'hf2f1 && c_s_axis_tvalid && resv!=4'b0) begin
-						// should not emit segment
-						c_index_act_next = c_s_axis_tdata[128+:8];
-						c_state_next = ACT_TMP_ENTRY_WAIT;
-					end
-					else if (!c_s_axis_tvalid) begin
-					end
-					else begin
-						// emit
-						r_tdata = r_1st_tdata;
-						r_tkeep = r_1st_tkeep;
-						r_tuser = r_1st_tuser;
-						r_tlast = r_1st_tlast;
-						r_tvalid = r_1st_tvalid;
-						c_state_next = FLUSH_REST_C;
-					end
-				end
-				ACT_TMP_ENTRY_WAIT: begin
-					if (c_s_axis_tvalid) begin
-						c_wr_act_data_next[369+:256] = c_s_axis_tdata_swapped;
-						c_state_next = ACT_TMP_ENTRY_WAIT_2;
-					end
-				end
-				ACT_TMP_ENTRY_WAIT_2: begin
-					if (c_s_axis_tvalid) begin
-						c_wr_act_data_next[113+:256] = c_s_axis_tdata_swapped;
-						c_state_next = ACT_TMP_ENTRY;
-					end
-				end
-				ACT_TMP_ENTRY: begin
-					if (c_s_axis_tvalid) begin
-						c_wr_en_act_next = 1; // next clk to write
-						c_wr_act_data_next[0+:113] = c_s_axis_tdata_swapped[143+:113];
-						c_state_next = IDLE_C;
-					end
-				end
-				FLUSH_REST_C: begin
-					c_wr_en_cam_next = 0;
-					c_wr_en_act_next = 0;
-					r_tdata = c_s_axis_tdata_d1;
-					r_tkeep = c_s_axis_tkeep_d1;
-					r_tuser = c_s_axis_tuser_d1;
-					r_tlast = c_s_axis_tlast_d1;
-					r_tvalid = c_s_axis_tvalid_d1;
-					if (c_s_axis_tvalid_d1 && c_s_axis_tlast_d1) begin
-						c_state_next = IDLE_C;
-					end
-				end
-			endcase
-		end
-
-		always @(posedge clk) begin
-			if (~rst_n) begin
-				c_state <= IDLE_C;
-
-				// control output
-				c_m_axis_tdata <= 0;
-				c_m_axis_tuser <= 0;
-				c_m_axis_tkeep <= 0;
-				c_m_axis_tlast <= 0;
-				c_m_axis_tvalid <= 0;
-				//
-				c_index_cam <= 0;
-				c_index_act <= 0;
-				c_wr_en_cam <= 0;
-				c_wr_en_act <= 0;
-				c_wr_cam_data <= 0;
-				c_wr_act_data <= 0;
-			end
-			else begin
-				c_state <= c_state_next;
-
-
-				// output ctrl master signals
-				c_m_axis_tdata <= r_tdata;
-				c_m_axis_tkeep <= r_tkeep;
-				c_m_axis_tuser <= r_tuser;
-				c_m_axis_tlast <= r_tlast;
-				c_m_axis_tvalid <= r_tvalid;
-				//
-				c_index_cam <= c_index_cam_next;
-				c_index_act <= c_index_act_next;
-				c_wr_en_cam <= c_wr_en_cam_next;
-				c_wr_en_act <= c_wr_en_act_next;
-				c_wr_cam_data <= c_wr_cam_data_next;
-				c_wr_act_data <= c_wr_act_data_next;
-			end
-		end
-
-		always @(posedge clk) begin
-			if (~rst_n) begin
-				// delayed 1 clk
-				c_s_axis_tdata_d1 <= 0;
-				c_s_axis_tuser_d1 <= 0;
-				c_s_axis_tkeep_d1 <= 0;
-				c_s_axis_tlast_d1 <= 0;
-				c_s_axis_tvalid_d1 <= 0;
-				//
-				r_1st_tdata <= 0;
-				r_1st_tkeep <= 0;
-				r_1st_tuser <= 0;
-				r_1st_tlast <= 0;
-				r_1st_tvalid <= 0;
-			end
-			else begin
-				// delayed 1 clk
-				c_s_axis_tdata_d1 <= c_s_axis_tdata;
-				c_s_axis_tuser_d1 <= c_s_axis_tuser;
-				c_s_axis_tkeep_d1 <= c_s_axis_tkeep;
-				c_s_axis_tlast_d1 <= c_s_axis_tlast;
-				c_s_axis_tvalid_d1 <= c_s_axis_tvalid;
-				// 
-				r_1st_tdata <= r_1st_tdata_next;
-				r_1st_tkeep <= r_1st_tkeep_next;
-				r_1st_tuser <= r_1st_tuser_next;
-				r_1st_tlast <= r_1st_tlast_next;
-				r_1st_tvalid <= r_1st_tvalid_next;
-			end
-		end
-
-        //ram for action
-        // blk_mem_gen_1 #(
-        // 	.C_INIT_FILE_NAME	("./llup.mif"),
-        // 	.C_LOAD_INIT_FILE	(1)
-        // )
-        blk_mem_gen_1
-        act_ram_625w_16d
-        (
-            .addra(c_index_act[3:0]),
-            .clka(clk),
-            .dina(c_wr_act_data),
-            .ena(1'b1), // always set to 1
-            .wea(c_wr_en_act),
-
-            .addrb(match_addr),
-            .clkb(clk),
-            .doutb(action_wire),
-            .enb(1'b1) // always set to 1
-        );
     end
 
+    //ram for action
+    // blk_mem_gen_1 #(
+    // 	.C_INIT_FILE_NAME	("./llup.mif"),
+    // 	.C_LOAD_INIT_FILE	(1)
+    // )
+    blk_mem_gen_1
+    act_ram_625w_16d
+    (
+        .addra(c_index_act[3:0]),
+        .clka(clk),
+        .dina(act_entry_tmp),
+        .ena(1'b1),
+        .wea(c_wr_en_act),
+
+        .addrb(match_addr[3:0]),
+        .clkb(clk),
+        .doutb(action_wire),
+        .enb(1'b1)
+    );
 endgenerate
 
 endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/lookup/lookup_engine_top.v parametric_menshen/lookup/lookup_engine_top.v
--- menshen/lookup/lookup_engine_top.v	2025-05-06 16:14:21.368210000 +0200
+++ parametric_menshen/lookup/lookup_engine_top.v	2025-05-06 16:13:52.979209471 +0200
@@ -8,7 +8,8 @@
     parameter KEY_LEN = 48*2+32*2+16*2+5,
     parameter ACT_LEN = 625,
     parameter LOOKUP_ID = 2,
-	parameter C_VLANID_WIDTH = 12
+    parameter C_VLANID_WIDTH = 12,
+    parameter NUM_OF_STAGES = 5
 )
 (
     input clk,
@@ -88,7 +89,8 @@
     .KEY_LEN(KEY_LEN),
     .ACT_LEN(ACT_LEN),
     .LOOKUP_ID(LOOKUP_ID),
-	.C_VLANID_WIDTH(C_VLANID_WIDTH)
+    .C_VLANID_WIDTH(C_VLANID_WIDTH),
+    .NUM_OF_STAGES(NUM_OF_STAGES)
 )
 lke_cam (
 	.clk		(clk),
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/output_arbiter.v parametric_menshen/output_arbiter.v
--- menshen/output_arbiter.v	2025-05-06 16:14:21.369210000 +0200
+++ parametric_menshen/output_arbiter.v	1970-01-01 01:00:00.000000000 +0100
@@ -1,176 +0,0 @@
-`timescale 1ns / 1ps
-
-module output_arbiter #(
-	parameter C_AXIS_DATA_WIDTH=256,
-	parameter C_AXIS_TUSER_WIDTH=128,
-	parameter C_NUM_QUEUES=4,
-	parameter C_NUM_QUEUES_WIDTH=2
-)
-(
-	input									axis_clk,
-	input									aresetn,
-
-	// output
-	output [C_AXIS_DATA_WIDTH-1:0]			m_axis_tdata,
-	output [C_AXIS_DATA_WIDTH/8-1:0]		m_axis_tkeep,
-	output [C_AXIS_TUSER_WIDTH-1:0]			m_axis_tuser,
-	output									m_axis_tvalid,
-	output									m_axis_tlast,
-	input									m_axis_tready,
-
-	// input
-	input [C_AXIS_DATA_WIDTH-1:0]			s_axis_tdata_0,
-	input [C_AXIS_DATA_WIDTH/8-1:0]			s_axis_tkeep_0,
-	input [C_AXIS_TUSER_WIDTH-1:0]			s_axis_tuser_0,
-	input									s_axis_tlast_0,
-	input									s_axis_tvalid_0,
-	output									s_axis_tready_0,
-
-	input [C_AXIS_DATA_WIDTH-1:0]			s_axis_tdata_1,
-	input [C_AXIS_DATA_WIDTH/8-1:0]			s_axis_tkeep_1,
-	input [C_AXIS_TUSER_WIDTH-1:0]			s_axis_tuser_1,
-	input									s_axis_tlast_1,
-	input									s_axis_tvalid_1,
-	output									s_axis_tready_1,
-
-	input [C_AXIS_DATA_WIDTH-1:0]			s_axis_tdata_2,
-	input [C_AXIS_DATA_WIDTH/8-1:0]			s_axis_tkeep_2,
-	input [C_AXIS_TUSER_WIDTH-1:0]			s_axis_tuser_2,
-	input									s_axis_tlast_2,
-	input									s_axis_tvalid_2,
-	output									s_axis_tready_2,
-
-	input [C_AXIS_DATA_WIDTH-1:0]			s_axis_tdata_3,
-	input [C_AXIS_DATA_WIDTH/8-1:0]			s_axis_tkeep_3,
-	input [C_AXIS_TUSER_WIDTH-1:0]			s_axis_tuser_3,
-	input									s_axis_tlast_3,
-	input									s_axis_tvalid_3,
-	output									s_axis_tready_3
-);
-
-wire [C_NUM_QUEUES-1:0]					nearly_full;
-wire [C_NUM_QUEUES-1:0]					empty;
-wire [C_AXIS_DATA_WIDTH-1:0]			in_tdata [C_NUM_QUEUES-1:0];
-wire [C_AXIS_DATA_WIDTH/8-1:0]			in_tkeep [C_NUM_QUEUES-1:0];
-wire [C_AXIS_TUSER_WIDTH-1:0]			in_tuser [C_NUM_QUEUES-1:0];
-wire [C_NUM_QUEUES-1:0]					in_tvalid;
-wire [C_NUM_QUEUES-1:0]					in_tlast;
-
-wire [C_AXIS_DATA_WIDTH-1:0]			fifo_out_tdata [C_NUM_QUEUES-1:0];
-wire [C_AXIS_DATA_WIDTH/8-1:0]			fifo_out_tkeep [C_NUM_QUEUES-1:0];
-wire [C_AXIS_TUSER_WIDTH-1:0]			fifo_out_tuser [C_NUM_QUEUES-1:0];
-wire [C_NUM_QUEUES-1:0]					fifo_out_tlast;
-
-reg [C_NUM_QUEUES-1:0]					rd_en;
-wire [C_NUM_QUEUES_WIDTH-1:0]			cur_queue_plus1;
-reg [C_NUM_QUEUES_WIDTH-1:0]			cur_queue, cur_queue_next;
-
-reg										state, state_next;
-
-
-
-generate
-	genvar i;
-	for (i=0; i<C_NUM_QUEUES; i=i+1) begin:
-		out_arb_queues
-		fallthrough_small_fifo #(
-			.WIDTH(C_AXIS_DATA_WIDTH+C_AXIS_DATA_WIDTH/8+C_AXIS_TUSER_WIDTH+1),
-			.MAX_DEPTH_BITS(4)
-		) out_arb_fifo (
-			.dout			({fifo_out_tdata[i], fifo_out_tuser[i], fifo_out_tkeep[i], fifo_out_tlast[i]}),
-			.rd_en			(rd_en[i]),
-
-			.din			({in_tdata[i], in_tuser[i], in_tkeep[i], in_tlast[i]}),
-			.wr_en			(in_tvalid[i] & ~nearly_full[i]),
-
-			.full			(),
-			.nearly_full	(nearly_full[i]),
-			.empty			(empty[i]),
-			.reset			(~aresetn),
-			.clk			(axis_clk)
-		);
-	end
-endgenerate
-
-assign in_tdata[0] = s_axis_tdata_0;
-assign in_tkeep[0] = s_axis_tkeep_0;
-assign in_tuser[0] = s_axis_tuser_0;
-assign in_tlast[0] = s_axis_tlast_0;
-assign in_tvalid[0] = s_axis_tvalid_0;
-assign s_axis_tready_0 = ~nearly_full[0];
-
-assign in_tdata[1] = s_axis_tdata_1;
-assign in_tkeep[1] = s_axis_tkeep_1;
-assign in_tuser[1] = s_axis_tuser_1;
-assign in_tlast[1] = s_axis_tlast_1;
-assign in_tvalid[1] = s_axis_tvalid_1;
-assign s_axis_tready_1 = ~nearly_full[1];
-
-assign in_tdata[2] = s_axis_tdata_2;
-assign in_tkeep[2] = s_axis_tkeep_2;
-assign in_tuser[2] = s_axis_tuser_2;
-assign in_tlast[2] = s_axis_tlast_2;
-assign in_tvalid[2] = s_axis_tvalid_2;
-assign s_axis_tready_2 = ~nearly_full[2];
-
-assign in_tdata[3] = s_axis_tdata_3;
-assign in_tkeep[3] = s_axis_tkeep_3;
-assign in_tuser[3] = s_axis_tuser_3;
-assign in_tlast[3] = s_axis_tlast_3;
-assign in_tvalid[3] = s_axis_tvalid_3;
-assign s_axis_tready_3 = ~nearly_full[3];
-
-assign cur_queue_plus1 = (cur_queue==C_NUM_QUEUES-1)? 0 : cur_queue+1;
-
-assign m_axis_tdata = fifo_out_tdata[cur_queue];
-assign m_axis_tuser = fifo_out_tuser[cur_queue];
-assign m_axis_tkeep = fifo_out_tkeep[cur_queue];
-assign m_axis_tlast = fifo_out_tlast[cur_queue];
-assign m_axis_tvalid = ~empty[cur_queue] && m_axis_tready;
-
-localparam	IDLE=0,
-			WR_PKT=1;
-
-always @(*) begin
-
-	state_next = state;
-	cur_queue_next = cur_queue;
-	rd_en = 0;
-
-	case (state)
-		IDLE: begin
-			if (!empty[cur_queue]) begin
-				if (m_axis_tready) begin
-					state_next = WR_PKT;
-					rd_en[cur_queue] = 1;
-				end
-			end
-			else begin
-				cur_queue_next = cur_queue_plus1;
-			end
-		end
-		WR_PKT: begin
-			if (m_axis_tready & m_axis_tlast) begin
-				state_next = IDLE;
-				rd_en[cur_queue] = 1;
-				cur_queue_next = cur_queue_plus1;
-			end
-			else if (m_axis_tready && !empty[cur_queue]) begin
-				rd_en[cur_queue] = 1;
-			end
-		end
-	endcase
-end
-
-always @(posedge axis_clk) begin
-	if (~aresetn) begin
-		state <= IDLE;
-		cur_queue <= 0;
-	end
-	else begin
-		state <= state_next;
-		cur_queue <= cur_queue_next;
-	end
-end
-
-endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/parser_do_parsing_top.v parametric_menshen/parser_do_parsing_top.v
--- menshen/parser_do_parsing_top.v	2025-05-06 16:14:21.369210000 +0200
+++ parametric_menshen/parser_do_parsing_top.v	2025-05-06 16:24:50.216223027 +0200
@@ -30,160 +30,107 @@
 	output reg										vlan_out_valid
 );
 
-wire [C_NUM_SEGS*C_AXIS_DATA_WIDTH-1:0]			sub_parser_segs_in [0:1];
-wire											sub_parser_segs_in_valid [0:1];
-wire [C_AXIS_TUSER_WIDTH-1:0]					sub_parser_tuser_1st_in [0:1];
-wire [C_PARSER_RAM_WIDTH-1:0]					sub_parser_bram_in [0:1];
-wire											sub_parser_bram_in_valid [0:1];
-
-reg [1:0] cur_queue, cur_queue_next;
-wire [1:0] cur_queue_plus1;
-
-assign cur_queue_plus1 = (cur_queue==1)?0:cur_queue+1;
-
-
-assign sub_parser_segs_in[0] = segs_in;
-assign sub_parser_segs_in[1] = segs_in;
-// assign sub_parser_segs_in[2] = segs_in;
-// assign sub_parser_segs_in[3] = segs_in;
-assign sub_parser_segs_in_valid[0] = (cur_queue==0)?segs_in_valid:0;
-assign sub_parser_segs_in_valid[1] = (cur_queue==1)?segs_in_valid:0;
-// assign sub_parser_segs_in_valid[2] = (cur_queue==2)?segs_in_valid:0;
-// assign sub_parser_segs_in_valid[3] = (cur_queue==3)?segs_in_valid:0;
-assign sub_parser_tuser_1st_in[0] = tuser_1st_in;
-assign sub_parser_tuser_1st_in[1] = tuser_1st_in;
-// assign sub_parser_tuser_1st_in[2] = tuser_1st_in;
-// assign sub_parser_tuser_1st_in[3] = tuser_1st_in;
-
-assign sub_parser_bram_in[0] = bram_in;
-assign sub_parser_bram_in[1] = bram_in;
-// assign sub_parser_bram_in[2] = bram_in;
-// assign sub_parser_bram_in[3] = bram_in;
-assign sub_parser_bram_in_valid[0] = (cur_queue==0)?bram_in_valid:0;
-assign sub_parser_bram_in_valid[1] = (cur_queue==1)?bram_in_valid:0;
-// assign sub_parser_bram_in_valid[2] = (cur_queue==2)?bram_in_valid:0;
-// assign sub_parser_bram_in_valid[3] = (cur_queue==3)?bram_in_valid:0;
+reg [C_NUM_SEGS*C_AXIS_DATA_WIDTH-1:0]			sub_parser_segs_in;
+reg												sub_parser_segs_in_valid;
+reg [C_AXIS_TUSER_WIDTH-1:0]					sub_parser_tuser_1st_in;
+reg [C_PARSER_RAM_WIDTH-1:0]					sub_parser_bram_in;
+reg												sub_parser_bram_in_valid;
 
 
-
-always @(*) begin
-	cur_queue_next = cur_queue;
-	if (segs_in_valid) begin
-		cur_queue_next = cur_queue_plus1;
-	end
-end
-
 always @(posedge clk) begin
 	if (~aresetn) begin
-		cur_queue <= 0;
+		sub_parser_segs_in <=       0;
+		sub_parser_segs_in_valid <= 0;
+		sub_parser_tuser_1st_in <=  0;
+		
+		sub_parser_bram_in <=       0;
+		sub_parser_bram_in_valid <= 0;
 	end
 	else begin
-		cur_queue <= cur_queue_next;
+		sub_parser_segs_in <=       segs_in;
+		sub_parser_segs_in_valid <= segs_in_valid;
+		sub_parser_tuser_1st_in <=  tuser_1st_in;
+		
+		sub_parser_bram_in <=       bram_in;
+		sub_parser_bram_in_valid <= bram_in_valid;
 	end
 end
 
-wire [1:0]					nearly_full;
-wire [1:0]					empty;
-wire [1:0]					vlan_nearly_full;
-wire [1:0]					vlan_empty;
-wire [PKT_HDR_LEN-1:0]		sub_parser_pkt_hdr_out [0:1];
-wire [1:0]					sub_parser_pkt_hdr_valid;
-wire [C_VLANID_WIDTH-1:0]	sub_parser_vlan_out [0:1];
-wire [1:0]					sub_parser_vlan_out_valid;
-
-reg [PKT_HDR_LEN-1:0]		sub_parser_pkt_hdr_out_d1 [0:1];
-reg [1:0]					sub_parser_pkt_hdr_valid_d1;
-reg [C_VLANID_WIDTH-1:0]	sub_parser_vlan_out_d1 [0:1];
-reg [1:0]					sub_parser_vlan_out_valid_d1;
-
-generate
-	genvar i;
-	for (i=0; i<2; i=i+1) begin:
-		sub_do_parsing
-		parser_do_parsing #(
-			.C_AXIS_DATA_WIDTH(C_AXIS_DATA_WIDTH),
-			.C_AXIS_TUSER_WIDTH(C_AXIS_TUSER_WIDTH)
-		)
-		phv_do_parsing (
-			.axis_clk			(clk),
-			.aresetn			(aresetn),
-			.tdata_segs			(sub_parser_segs_in[i]),
-			.tuser_1st			(sub_parser_tuser_1st_in[i]),
-			.segs_valid			(sub_parser_segs_in_valid[i]),
-
-			.bram_in			(sub_parser_bram_in[i]),
-			.bram_in_valid		(sub_parser_bram_in_valid[i]),
-			.stg_ready_in		(1'b1),
-			// output
-			.parser_valid		(sub_parser_pkt_hdr_valid[i]),
-			.pkt_hdr_vec		(sub_parser_pkt_hdr_out[i]),
-			.vlan_out			(sub_parser_vlan_out[i]),
-			.vlan_out_valid		(sub_parser_vlan_out_valid[i])
-		);
-	end
-endgenerate
+wire [PKT_HDR_LEN-1:0]		sub_parser_pkt_hdr_out;
+wire					sub_parser_pkt_hdr_valid;
+wire [C_VLANID_WIDTH-1:0]	sub_parser_vlan_out;
+wire					sub_parser_vlan_out_valid;
+
+reg [PKT_HDR_LEN-1:0]		sub_parser_pkt_hdr_out_d1;
+reg					sub_parser_pkt_hdr_valid_d1;
+reg [C_VLANID_WIDTH-1:0]	sub_parser_vlan_out_d1;
+reg					sub_parser_vlan_out_valid_d1;
+
+parser_do_parsing #(
+	.C_AXIS_DATA_WIDTH(C_AXIS_DATA_WIDTH),
+	.C_AXIS_TUSER_WIDTH(C_AXIS_TUSER_WIDTH)
+)
+phv_do_parsing (
+	.axis_clk			(clk),
+	.aresetn			(aresetn),
+	.tdata_segs			(sub_parser_segs_in),
+	.tuser_1st			(sub_parser_tuser_1st_in),
+	.segs_valid			(sub_parser_segs_in_valid),
+
+	.bram_in			(sub_parser_bram_in),
+	.bram_in_valid		(sub_parser_bram_in_valid),
+	.stg_ready_in		(1'b1),
+	// output
+	.parser_valid		(sub_parser_pkt_hdr_valid),
+	.pkt_hdr_vec		(sub_parser_pkt_hdr_out),
+	.vlan_out			(sub_parser_vlan_out),
+	.vlan_out_valid		(sub_parser_vlan_out_valid)
+);
+
 
-reg [1:0] out_cur_queue, out_cur_queue_next;
-wire [1:0] out_cur_queue_plus1;
 reg [PKT_HDR_LEN-1:0] pkt_hdr_vec_next;
 reg parser_valid_next;
 
-assign out_cur_queue_plus1 = (out_cur_queue==1)?0:out_cur_queue+1;
-
 always @(*) begin
 	pkt_hdr_vec_next = pkt_hdr_vec;
 	parser_valid_next = 0;
 	
-	out_cur_queue_next = out_cur_queue;
-
-	if (sub_parser_pkt_hdr_valid_d1[out_cur_queue]) begin
-		pkt_hdr_vec_next = sub_parser_pkt_hdr_out_d1[out_cur_queue];
+	if (sub_parser_pkt_hdr_valid_d1) begin
+		pkt_hdr_vec_next = sub_parser_pkt_hdr_out_d1;
 		parser_valid_next = 1;
-		out_cur_queue_next = out_cur_queue_plus1;
 	end
 end
 
 always @(posedge clk) begin
 	if (~aresetn) begin
-		out_cur_queue <= 0;
 		pkt_hdr_vec <= 0;
 		parser_valid <= 0;
 	end
 	else begin
-		out_cur_queue <= out_cur_queue_next;
 		pkt_hdr_vec <= pkt_hdr_vec_next;
 		parser_valid <= parser_valid_next;
 	end
 end
 
-reg [1:0] vlan_out_cur_queue, vlan_out_cur_queue_next;
-wire [1:0] vlan_out_cur_queue_plus1;
 reg [C_VLANID_WIDTH-1:0] vlan_out_next;
 reg vlan_out_valid_next;
 
-assign vlan_out_cur_queue_plus1 = (vlan_out_cur_queue==1)?0:vlan_out_cur_queue+1;
-
 always @(*) begin
 	vlan_out_next = vlan_out;
 	vlan_out_valid_next = 0;
-
-	vlan_out_cur_queue_next = vlan_out_cur_queue;
-
-	if (sub_parser_vlan_out_valid_d1[vlan_out_cur_queue]) begin
-		vlan_out_next = sub_parser_vlan_out_d1[vlan_out_cur_queue];
+        
+	if (sub_parser_vlan_out_valid_d1) begin
+		vlan_out_next = sub_parser_vlan_out_d1;
 		vlan_out_valid_next = 1;
-		vlan_out_cur_queue_next = vlan_out_cur_queue_plus1;
 	end
 end
 
 always @(posedge clk) begin
 	if (~aresetn) begin
-		vlan_out_cur_queue <= 0;
 		vlan_out <= 0;
 		vlan_out_valid <= 0;
 	end
 	else begin
-		vlan_out_cur_queue <= vlan_out_cur_queue_next;
 		vlan_out <= vlan_out_next;
 		vlan_out_valid <= vlan_out_valid_next;
 	end
@@ -191,122 +138,17 @@
 
 always @(posedge clk) begin
 	if (~aresetn) begin
-		sub_parser_pkt_hdr_out_d1[0] <= 0;
-		sub_parser_pkt_hdr_out_d1[1] <= 0;
+		sub_parser_pkt_hdr_out_d1 <= 0;
 		sub_parser_pkt_hdr_valid_d1 <= 0;
-		sub_parser_vlan_out_d1[0] <= 0;
-		sub_parser_vlan_out_d1[1] <= 0;
+		sub_parser_vlan_out_d1 <= 0;
 		sub_parser_vlan_out_valid_d1 <= 0;
 	end
 	else begin
-		sub_parser_pkt_hdr_out_d1[0] <= sub_parser_pkt_hdr_out[0];
-		sub_parser_pkt_hdr_out_d1[1] <= sub_parser_pkt_hdr_out[1];
+		sub_parser_pkt_hdr_out_d1 <= sub_parser_pkt_hdr_out;
 		sub_parser_pkt_hdr_valid_d1 <= sub_parser_pkt_hdr_valid;
-		sub_parser_vlan_out_d1[0] <= sub_parser_vlan_out[0];
-		sub_parser_vlan_out_d1[1] <= sub_parser_vlan_out[1];
+		sub_parser_vlan_out_d1 <= sub_parser_vlan_out;
 		sub_parser_vlan_out_valid_d1 <= sub_parser_vlan_out_valid;
 	end
 end
 
-
-/*
-generate
-	for (i=0; i<2; i=i+1) begin:
-		out_arb_queues
-		fallthrough_small_fifo #(
-			.WIDTH(PKT_HDR_LEN),
-			.MAX_DEPTH_BITS(4)
-		) out_arb_fifo (
-			.dout			(fifo_pkt_hdr_out[i]),
-			.rd_en			(fifo_rd_en[i]),
-
-			.din			(sub_parser_pkt_hdr_out[i]),
-			.wr_en			(sub_parser_pkt_hdr_valid[i] & ~nearly_full[i]),
-
-			.full			(),
-			.nearly_full	(nearly_full[i]),
-			.empty			(empty[i]),
-			.reset			(~aresetn),
-			.clk			(clk)
-		);
-	end
-	// vlan queue
-	for (i=0; i<2; i=i+1) begin:
-		vlan_out_arb_queues
-		fallthrough_small_fifo #(
-			.WIDTH(C_VLANID_WIDTH),
-			.MAX_DEPTH_BITS(4)
-		) vlan_out_arb_fifo (
-			.dout			(fifo_vlan_out[i]),
-			.rd_en			(fifo_vlan_rd_en[i]),
-
-			.din			(sub_parser_vlan_out[i]),
-			.wr_en			(sub_parser_vlan_out_valid[i] & ~vlan_nearly_full[i]),
-
-			.full			(),
-			.nearly_full	(vlan_nearly_full[i]),
-			.empty			(vlan_empty[i]),
-			.reset			(~aresetn),
-			.clk			(clk)
-		);
-	end
-endgenerate
-
-
-localparam	IDLE=0;
-
-reg [1:0] out_cur_queue, out_cur_queue_next;
-wire [1:0] out_cur_queue_plus1;
-reg [1:0] vlan_out_cur_queue, vlan_out_cur_queue_next;
-wire [1:0] vlan_out_cur_queue_plus1;
-
-assign out_cur_queue_plus1 = (out_cur_queue==1)?0:out_cur_queue+1;
-assign vlan_out_cur_queue_plus1 = (vlan_out_cur_queue==1)?0:vlan_out_cur_queue+1;
-
-assign pkt_hdr_vec = fifo_pkt_hdr_out[out_cur_queue];
-assign parser_valid = ~empty[out_cur_queue];
-assign parser_ready = ~nearly_full[0] ||
-						~nearly_full[1];
-						// ~nearly_full[2] ||
-						// ~nearly_full[3];
-assign vlan_out = fifo_vlan_out[vlan_out_cur_queue];
-assign vlan_out_valid = ~vlan_empty[vlan_out_cur_queue];
-
-always @(*) begin
-
-	out_cur_queue_next = out_cur_queue;
-	fifo_rd_en = 0;
-
-	if (!empty[out_cur_queue]) begin
-		if (stg_ready) begin
-			fifo_rd_en[out_cur_queue] = 1;
-			out_cur_queue_next = out_cur_queue_plus1;
-		end
-	end
-end
-
-always @(*) begin
-
-	vlan_out_cur_queue_next = vlan_out_cur_queue;
-	fifo_vlan_rd_en = 0;
-
-	if (!vlan_empty[vlan_out_cur_queue]) begin
-		if (stg_vlan_ready) begin
-			fifo_vlan_rd_en[out_cur_queue] = 1;
-			vlan_out_cur_queue_next = vlan_out_cur_queue_plus1;
-		end
-	end
-end
-
-always @(posedge clk) begin
-	if (~aresetn) begin
-		out_cur_queue <= 0;
-		vlan_out_cur_queue <= 0;
-	end
-	else begin
-		out_cur_queue <= out_cur_queue_next;
-		vlan_out_cur_queue <= vlan_out_cur_queue_next;
-	end
-end*/
-
 endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/parser_do_parsing.v parametric_menshen/parser_do_parsing.v
--- menshen/parser_do_parsing.v	2025-05-06 16:14:21.369210000 +0200
+++ parametric_menshen/parser_do_parsing.v	2025-05-06 16:51:43.107256295 +0200
@@ -73,6 +73,33 @@
 					EMPTY_1=6;
 					
 
+reg [C_NUM_SEGS*C_AXIS_DATA_WIDTH-1:0]		tdata_segs_r;
+reg [C_AXIS_TUSER_WIDTH-1:0]				tuser_1st_r;
+reg											segs_valid_r;
+reg [C_PARSER_RAM_WIDTH-1:0]				bram_in_r;
+reg											bram_in_valid_r;
+reg											stg_ready_in_r;
+
+always @(posedge axis_clk) begin
+	if (~aresetn) begin
+		tdata_segs_r <= 0;
+		tuser_1st_r <= 0;
+		segs_valid_r <= 0;
+		bram_in_r <= 0;
+		bram_in_valid_r <= 0;
+		stg_ready_in_r <= 0;
+	end
+	else begin
+		tdata_segs_r <=    tdata_segs;
+		tuser_1st_r <=     tuser_1st;
+		segs_valid_r <=    segs_valid;
+		bram_in_r <=       bram_in;
+		bram_in_valid_r <= bram_in_valid;
+		stg_ready_in_r <=  stg_ready_in;
+	end
+end
+
+
 //
 reg [PKT_HDR_LEN-1:0]	pkt_hdr_vec_next;
 reg parser_valid_next;
@@ -83,16 +110,16 @@
 // parsing actions
 wire [15:0] parse_action [0:9];		// we have 10 parse action
 
-assign parse_action[9] = bram_in[0+:16];
-assign parse_action[8] = bram_in[16+:16];
-assign parse_action[7] = bram_in[32+:16];
-assign parse_action[6] = bram_in[48+:16];
-assign parse_action[5] = bram_in[64+:16];
-assign parse_action[4] = bram_in[80+:16];
-assign parse_action[3] = bram_in[96+:16];
-assign parse_action[2] = bram_in[112+:16];
-assign parse_action[1] = bram_in[128+:16];
-assign parse_action[0] = bram_in[144+:16];
+assign parse_action[9] = bram_in_r[0+:16];
+assign parse_action[8] = bram_in_r[16+:16];
+assign parse_action[7] = bram_in_r[32+:16];
+assign parse_action[6] = bram_in_r[48+:16];
+assign parse_action[5] = bram_in_r[64+:16];
+assign parse_action[4] = bram_in_r[80+:16];
+assign parse_action[3] = bram_in_r[96+:16];
+assign parse_action[2] = bram_in_r[112+:16];
+assign parse_action[1] = bram_in_r[128+:16];
+assign parse_action[0] = bram_in_r[144+:16];
 
 
 reg [9:0] sub_parse_act_valid;
@@ -164,9 +191,9 @@
 
 	case (state)
 		IDLE: begin
-			if (segs_valid) begin
+			if (segs_valid_r) begin
 				sub_parse_act_valid = 10'b1111111111;
-				vlan_out_next = tdata_segs[116+:12];
+				vlan_out_next = tdata_segs_r[288+:12];
 				state_next = FINISH_SUB_PARSE;
 			end
 		end
@@ -191,13 +218,8 @@
 			pkt_hdr_vec_next ={val_6B_swapped[7], val_6B_swapped[6], val_6B_swapped[5], val_6B_swapped[4], val_6B_swapped[3], val_6B_swapped[2], val_6B_swapped[1], val_6B_swapped[0],
 							val_4B_swapped[7], val_4B_swapped[6], val_4B_swapped[5], val_4B_swapped[4], val_4B_swapped[3], val_4B_swapped[2], val_4B_swapped[1], val_4B_swapped[0],
 							val_2B_swapped[7], val_2B_swapped[6], val_2B_swapped[5], val_2B_swapped[4], val_2B_swapped[3], val_2B_swapped[2], val_2B_swapped[1], val_2B_swapped[0],
-							// Tao: manually set output port to 1 for eazy test
-							// {115{1'b0}}, vlan_id, 1'b0, tuser_1st[127:32], 8'h04, tuser_1st[23:0]};
-							{115{1'b0}}, vlan_out, 1'b0, tuser_1st[127:32], 8'h04, tuser_1st[23:0]};
-							// {115{1'b0}}, vlan_id, 1'b0, tuser_1st};
-							// {128{1'b0}}, tuser_1st[127:32], 8'h04, tuser_1st[23:0]};
-							//
-			if (stg_ready_in) begin
+							{115{1'b0}}, vlan_out, 1'b0, (C_AXIS_TUSER_WIDTH == 128 ? tuser_1st_r : ({{128-C_AXIS_TUSER_WIDTH{1'b0}}, tuser_1st_r})) };
+			if (stg_ready_in_r) begin
 				parser_valid_next = 1;
 				state_next = IDLE;
 			end
@@ -206,7 +228,7 @@
 			end
 		end
 		OUTPUT: begin
-			if (stg_ready_in) begin
+			if (stg_ready_in_r) begin
 				parser_valid_next = 1;
 				state_next = IDLE;
 				
@@ -345,7 +367,7 @@
 			.parse_act_valid	(sub_parse_act_valid[index]),
 			.parse_act			(parse_action[index]),
 
-			.pkts_hdr			(tdata_segs),
+			.pkts_hdr			(tdata_segs_r),
 			.val_out_valid		(sub_parse_val_out_valid[index]),
 			.val_out			(sub_parse_val_out[index]),
 			.val_out_type		(sub_parse_val_out_type[index]),
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/parser_top.v parametric_menshen/parser_top.v
--- menshen/parser_top.v	2025-05-06 16:14:21.369210000 +0200
+++ parametric_menshen/parser_top.v	2025-05-06 16:51:43.107256295 +0200
@@ -37,7 +37,6 @@
 	output reg									out_vlan_valid,
 	input									out_vlan_ready,
 
-	// output to different pkt fifo queues (i.e., data cache)
 	output [C_S_AXIS_DATA_WIDTH-1:0]		m_axis_tdata_0,
 	output [C_S_AXIS_TUSER_WIDTH-1:0]		m_axis_tuser_0,
 	output [C_S_AXIS_DATA_WIDTH/8-1:0]		m_axis_tkeep_0,
@@ -45,27 +44,6 @@
 	output									m_axis_tvalid_0,
 	input									m_axis_tready_0,
 
-	output [C_S_AXIS_DATA_WIDTH-1:0]		m_axis_tdata_1,
-	output [C_S_AXIS_TUSER_WIDTH-1:0]		m_axis_tuser_1,
-	output [C_S_AXIS_DATA_WIDTH/8-1:0]		m_axis_tkeep_1,
-	output									m_axis_tlast_1,
-	output									m_axis_tvalid_1,
-	input									m_axis_tready_1,
-
-	output [C_S_AXIS_DATA_WIDTH-1:0]		m_axis_tdata_2,
-	output [C_S_AXIS_TUSER_WIDTH-1:0]		m_axis_tuser_2,
-	output [C_S_AXIS_DATA_WIDTH/8-1:0]		m_axis_tkeep_2,
-	output									m_axis_tlast_2,
-	output									m_axis_tvalid_2,
-	input									m_axis_tready_2,
-
-	output [C_S_AXIS_DATA_WIDTH-1:0]		m_axis_tdata_3,
-	output [C_S_AXIS_TUSER_WIDTH-1:0]		m_axis_tuser_3,
-	output [C_S_AXIS_DATA_WIDTH/8-1:0]		m_axis_tkeep_3,
-	output									m_axis_tlast_3,
-	output									m_axis_tvalid_3,
-	input									m_axis_tready_3,
-
 	// ctrl path
 	input [C_S_AXIS_DATA_WIDTH-1:0]			ctrl_s_axis_tdata,
 	input [C_S_AXIS_TUSER_WIDTH-1:0]		ctrl_s_axis_tuser,
@@ -96,106 +74,25 @@
 reg bram_ready, bram_ready_next;
 
 
-assign s_axis_tready = bram_ready
-						&& m_axis_tready_0
-						&& m_axis_tready_1
-						&& m_axis_tready_2
-						&& m_axis_tready_3;
-//
-
-wire [3:0] m_axis_tready_queue;
-
-assign m_axis_tready_queue[0] = m_axis_tready_0;
-assign m_axis_tready_queue[1] = m_axis_tready_1;
-assign m_axis_tready_queue[2] = m_axis_tready_2;
-assign m_axis_tready_queue[3] = m_axis_tready_3;
-
-
-localparam	IDLE=0,
-			FLUSH_REST_PKTS=1;
-reg [1:0] state, state_next;
-reg [1:0] cur_queue, cur_queue_next;
-wire [1:0] cur_queue_plus1;
+assign s_axis_tready = bram_ready && m_axis_tready_0;
 
-assign cur_queue_plus1 = (cur_queue==3)?0:cur_queue+1;
-
-// ==================================================
 assign m_axis_tdata_0 = s_axis_tdata;
 assign m_axis_tuser_0 = s_axis_tuser;
 assign m_axis_tkeep_0 = s_axis_tkeep;
 assign m_axis_tlast_0 = s_axis_tlast;
-assign m_axis_tvalid_0 = (cur_queue==0?1:0) & s_axis_tvalid;
-
-assign m_axis_tdata_1 = s_axis_tdata;
-assign m_axis_tuser_1 = s_axis_tuser;
-assign m_axis_tkeep_1 = s_axis_tkeep;
-assign m_axis_tlast_1 = s_axis_tlast;
-assign m_axis_tvalid_1 = (cur_queue==1?1:0) & s_axis_tvalid;
-
-assign m_axis_tdata_2 = s_axis_tdata;
-assign m_axis_tuser_2 = s_axis_tuser;
-assign m_axis_tkeep_2 = s_axis_tkeep;
-assign m_axis_tlast_2 = s_axis_tlast;
-assign m_axis_tvalid_2 = (cur_queue==2?1:0) & s_axis_tvalid;
-
-assign m_axis_tdata_3 = s_axis_tdata;
-assign m_axis_tuser_3 = s_axis_tuser;
-assign m_axis_tkeep_3 = s_axis_tkeep;
-assign m_axis_tlast_3 = s_axis_tlast;
-assign m_axis_tvalid_3 = (cur_queue==3?1:0) & s_axis_tvalid;
-// ==================================================
-
+assign m_axis_tvalid_0 = s_axis_tvalid;
 
-always @(*) begin
-	state_next = state;
-	cur_queue_next = cur_queue;
-
-	case (state)
-		IDLE: begin
-			if (s_axis_tvalid) begin
-				if (m_axis_tready_queue[cur_queue]) begin
-
-					if (!s_axis_tlast) begin
-						state_next = FLUSH_REST_PKTS;
-					end
-					else begin
-						cur_queue_next = cur_queue_plus1;
-					end
-				end
-			end
-		end
-		FLUSH_REST_PKTS: begin
-			if (s_axis_tvalid) begin
-				if (m_axis_tready_queue[cur_queue]) begin
-
-					if (s_axis_tlast) begin
-						cur_queue_next = cur_queue_plus1;
-						state_next = IDLE;
-					end
-				end
-			end
-		end
-	endcase
-end
-
-always @(posedge axis_clk) begin
-	if (~aresetn) begin
-		state <= IDLE;
-		cur_queue <= 0;
-	end
-	else begin
-		state <= state_next;
-		cur_queue <= cur_queue_next;
-	end
-end
 
 // ==================================================
 
-wire [C_VLANID_WIDTH-1:0]				parser_out_vlan, vlan_fifo_out;
+wire [C_VLANID_WIDTH-1:0]				parser_out_vlan;
 wire									parser_out_vlan_valid;
+reg  [C_VLANID_WIDTH-1:0]				parser_out_vlan_r;
+reg										parser_out_vlan_valid_r;
+
 // wire	vlan_fifo_empty, vlan_fifo_nearly_full;
 reg [C_VLANID_WIDTH-1:0] out_vlan_next;
-reg out_vlan_valid_next;
+reg                      out_vlan_valid_next;
 // reg		vlan_fifo_rd_en;
 
 // wire [PKT_HDR_LEN-1:0]		phv_fifo_out;
@@ -204,54 +101,21 @@
 
 
 
-localparam P_IDLE=0;
-
-reg [1:0] p_state, p_state_next;
-reg [1:0] p_cur_queue, p_cur_queue_next;
-wire [1:0] p_cur_queue_plus1;
-
-assign p_cur_queue_plus1 = (p_cur_queue==3)?0:p_cur_queue+1;
 
-wire [3:0] p_cur_queue_val;
-assign p_cur_queue_val[0] = (p_cur_queue==0)?1:0;
-assign p_cur_queue_val[1] = (p_cur_queue==1)?1:0;
-assign p_cur_queue_val[2] = (p_cur_queue==2)?1:0;
-assign p_cur_queue_val[3] = (p_cur_queue==3)?1:0;
-
-wire parser_valid_w;
+wire                   parser_valid_w;
 wire [PKT_HDR_LEN-1:0] pkt_hdr_vec_w;
-reg [PKT_HDR_LEN-1:0] pkt_hdr_vec_next, pkt_hdr_vec_r;
-reg parser_valid_next, parser_valid_r;
+reg                    parser_valid_w_r;
+reg  [PKT_HDR_LEN-1:0] pkt_hdr_vec_w_r;
+reg  [PKT_HDR_LEN-1:0] pkt_hdr_vec_next, pkt_hdr_vec_r;
+reg                    parser_valid_next, parser_valid_r;
 
-/*
 always @(*) begin
-	p_state_next = p_state;
-	p_cur_queue_next = p_cur_queue;
-	
-	pkt_hdr_vec_next = pkt_hdr_vec;
-	parser_valid_next = 0;
-	case (p_state)
-		P_IDLE: begin
-			if (parser_valid_w) begin
-				pkt_hdr_vec_next = {pkt_hdr_vec_w[PKT_HDR_LEN-1:145], p_cur_queue_val, pkt_hdr_vec_w[0+:141]};
-				parser_valid_next = 1;
-
-				p_cur_queue_next = p_cur_queue_plus1;
-			end
-		end
-	endcase
-end*/
-
-always @(*) begin
-	p_cur_queue_next = p_cur_queue;
-	pkt_hdr_vec_next = pkt_hdr_vec_r;
+	pkt_hdr_vec_next = pkt_hdr_vec_w_r;
 	parser_valid_next = 0;
 
-	if (parser_valid_w) begin
-		pkt_hdr_vec_next = {pkt_hdr_vec_w[PKT_HDR_LEN-1:145], p_cur_queue_val, pkt_hdr_vec_w[0+:141]};
+	if (parser_valid_w_r) begin
+		pkt_hdr_vec_next = {pkt_hdr_vec_w_r[PKT_HDR_LEN-1:145], 4'b0001, pkt_hdr_vec_w_r[0+:141]};
 		parser_valid_next = 1;
-
-		p_cur_queue_next = p_cur_queue_plus1;
 	end
 end
 
@@ -259,16 +123,14 @@
 	out_vlan_valid_next = 0;
 	out_vlan_next = out_vlan;
 
-	if (parser_out_vlan_valid) begin
+	if (parser_out_vlan_valid_r) begin
 		out_vlan_valid_next = 1;
-		out_vlan_next = parser_out_vlan;
+		out_vlan_next = parser_out_vlan_r;
 	end
 end
 
 always @(posedge axis_clk) begin
 	if (~aresetn) begin
-		p_state <= P_IDLE;
-		p_cur_queue <= 0;
 		pkt_hdr_vec <= 0;
 		parser_valid <= 0;
 
@@ -277,10 +139,13 @@
 
 		pkt_hdr_vec_r <= 0;
 		parser_valid_r <= 0;
+		
+		parser_out_vlan_r <= 0;
+		parser_out_vlan_valid_r <= 0;
+		parser_valid_r <= 0;
+		pkt_hdr_vec_w_r <= 0;
 	end
 	else begin
-		p_state <= p_state_next;
-		p_cur_queue <= p_cur_queue_next;
 		pkt_hdr_vec_r <= pkt_hdr_vec_next;
 		parser_valid_r <= parser_valid_next;
 		pkt_hdr_vec <= pkt_hdr_vec_r;
@@ -288,6 +153,11 @@
 
 		out_vlan <= out_vlan_next;
 		out_vlan_valid <= out_vlan_valid_next;
+		
+		parser_out_vlan_r <= parser_out_vlan;
+		parser_out_vlan_valid_r <= parser_out_vlan_valid;
+		parser_valid_w_r <= parser_valid_w;
+		pkt_hdr_vec_w_r <= pkt_hdr_vec_w;
 	end
 end
 
@@ -307,6 +177,7 @@
 
 //
 parser_wait_segs #(
+    .C_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH)
 )
 get_segs
 (
@@ -326,6 +197,7 @@
 );
 
 parser_do_parsing_top #(
+    .C_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH)
 )
 do_parsing
 (
@@ -449,7 +321,7 @@
            SU_WRITE_C = 3;
 
 assign mod_id = ctrl_s_axis_tdata[368+:8];
-assign control_flag = ctrl_s_axis_tdata[335:320];
+assign control_flag = ctrl_s_axis_tdata[303:288];
 
 //LE to BE switching
 wire[C_S_AXIS_DATA_WIDTH-1:0] ctrl_s_axis_tdata_swapped;
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/pkt_filter.v parametric_menshen/pkt_filter.v
--- menshen/pkt_filter.v	2025-05-06 16:14:21.369210000 +0200
+++ parametric_menshen/pkt_filter.v	2025-05-06 16:51:43.107256295 +0200
@@ -10,8 +10,8 @@
 	parameter C_VLANID_WIDTH = 12
 )
 (
-	input				clk,
-	input				aresetn,
+	input			clk,
+	input			aresetn,
 
 	input [31:0]		vlan_drop_flags,
 	output [31:0]		ctrl_token,
@@ -19,39 +19,39 @@
 
 	// input Slave AXI Stream
 	input [C_S_AXIS_DATA_WIDTH-1:0]			s_axis_tdata,
-	input [((C_S_AXIS_DATA_WIDTH/8))-1:0]	s_axis_tkeep,
+	input [((C_S_AXIS_DATA_WIDTH/8))-1:0]		s_axis_tkeep,
 	input [C_S_AXIS_TUSER_WIDTH-1:0]		s_axis_tuser,
-	input									s_axis_tvalid,
-	output									s_axis_tready,
-	input									s_axis_tlast,
+	input						s_axis_tvalid,
+	output						s_axis_tready,
+	input						s_axis_tlast,
 
 	// output Master AXI Stream
 	output reg [C_S_AXIS_DATA_WIDTH-1:0]		m_axis_tdata,
 	output reg [((C_S_AXIS_DATA_WIDTH/8))-1:0]	m_axis_tkeep,
 	output reg [C_S_AXIS_TUSER_WIDTH-1:0]		m_axis_tuser,
-	output reg									m_axis_tvalid,
-	input										m_axis_tready,
-	output reg									m_axis_tlast,
+	output reg					m_axis_tvalid,
+	input						m_axis_tready,
+	output reg					m_axis_tlast,
 
-	output reg [C_VLANID_WIDTH-1:0]				vlan_id,
-	output reg									vlan_id_valid,
+	output reg [C_VLANID_WIDTH-1:0]			vlan_id,
+	output reg					vlan_id_valid,
 
 	//TODO a back-pressure is needed?
 	output reg [C_S_AXIS_DATA_WIDTH-1:0]		c_m_axis_tdata,
 	output reg [((C_S_AXIS_DATA_WIDTH/8))-1:0]	c_m_axis_tkeep,
 	output reg [C_S_AXIS_TUSER_WIDTH-1:0]		c_m_axis_tuser,
-	output reg									c_m_axis_tvalid,
-	output reg									c_m_axis_tlast
+	output reg					c_m_axis_tvalid,
+	output reg					c_m_axis_tlast
 
 );
 
 
-wire [C_S_AXIS_DATA_WIDTH-1:0]	pkt_fifo_tdata;
-wire [C_S_AXIS_DATA_WIDTH/8-1:0]	pkt_fifo_tkeep;
-wire [C_S_AXIS_TUSER_WIDTH-1:0]		pkt_fifo_tuser;
-wire								pkt_fifo_tlast;
-reg								pkt_fifo_rd_en;
-wire	pkt_fifo_empty, pkt_fifo_full;
+wire [C_S_AXIS_DATA_WIDTH-1:0] pkt_fifo_tdata;
+wire [C_S_AXIS_DATA_WIDTH/8-1:0] pkt_fifo_tkeep;
+wire [C_S_AXIS_TUSER_WIDTH-1:0] pkt_fifo_tuser;
+wire pkt_fifo_tlast;
+reg pkt_fifo_rd_en;
+wire pkt_fifo_empty, pkt_fifo_full;
 
 //
 assign s_axis_tready = !pkt_fifo_full;
@@ -108,7 +108,7 @@
 assign w_c_switch = c_switch;
 assign ctrl_token = ctrl_token_r;
 
-assign vlan_id_w = pkt_fifo_tdata[116 +: 12];
+assign vlan_id_w = pkt_fifo_tdata[288 +: 12];
 assign vlan_id_one_hot_w = (1'b1 << vlan_id_w[8:4]); 
 
 always @(*) begin
@@ -133,11 +133,11 @@
 		WAIT_FIRST_PKT: begin
 			if (!pkt_fifo_empty) begin
 				if (m_axis_tready) begin
-					if ((pkt_fifo_tdata[143:128]==`ETH_TYPE_IPV4) && 
-						(pkt_fifo_tdata[223:216]==`IPPROT_UDP)) begin
+					if ((pkt_fifo_tdata[111:96] ==`ETH_TYPE_IPV4) && 
+						(pkt_fifo_tdata[191:184]==`IPPROT_UDP)) begin
 						//checkme: we put the security check here
-						// if(s_axis_tdata[335:320] == `CONTROL_PORT && cookie_w == cookie_val_d1) begin
-						if(pkt_fifo_tdata[335:320] == `CONTROL_PORT) begin
+						// if(s_axis_tdata[303:288] == `CONTROL_PORT && cookie_w == cookie_val_d1) begin
+						if(pkt_fifo_tdata[303:288] == `CONTROL_PORT) begin
 							state_next = FLUSH_CTL;
 							c_switch = 1'b1;
 							//modify token once its true
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/rmt_wrapper.sv parametric_menshen/rmt_wrapper.sv
--- menshen/rmt_wrapper.sv	1970-01-01 01:00:00.000000000 +0100
+++ parametric_menshen/rmt_wrapper.sv	2025-05-06 16:24:50.217223027 +0200
@@ -0,0 +1,594 @@
+`timescale 1ns / 1ps
+
+module rmt_wrapper #(
+	// AXI-Lite parameters
+	// Width of AXI lite data bus in bits
+	parameter AXIL_DATA_WIDTH = 32,
+	// Width of AXI lite address bus in bits
+	parameter AXIL_ADDR_WIDTH = 16,
+	// Width of AXI lite wstrb (width of data bus in words)
+	parameter AXIL_STRB_WIDTH = (AXIL_DATA_WIDTH/8),
+	// AXI Stream parameters
+	// Slave
+	parameter C_S_AXIS_DATA_WIDTH = 512,
+	parameter C_S_AXIS_TUSER_WIDTH = 128,
+	// Master
+	// self-defined
+	parameter PHV_LEN = 48*8+32*8+16*8+256,
+	parameter KEY_LEN = 48*2+32*2+16*2+1,
+	parameter ACT_LEN = 25,
+	parameter KEY_OFF = 6*3+20,
+	parameter C_VLANID_WIDTH = 12,
+	parameter C_FIFO_BIT_WIDTH = 4,
+	parameter NUM_OF_STAGES = 5
+)
+(
+	input						clk,		// axis clk
+	input						aresetn,	
+	input [31:0]					vlan_drop_flags,
+	output reg [31:0]				ctrl_token,
+
+	/*
+     * input Slave AXI Stream
+     */
+	input [C_S_AXIS_DATA_WIDTH-1:0]			s_axis_tdata,
+	input [((C_S_AXIS_DATA_WIDTH/8))-1:0]		s_axis_tkeep,
+	input [C_S_AXIS_TUSER_WIDTH-1:0]		s_axis_tuser,
+	input						s_axis_tvalid,
+	output reg					s_axis_tready,
+	input						s_axis_tlast,
+
+	/*
+     * output Master AXI Stream
+     */
+	output reg [C_S_AXIS_DATA_WIDTH-1:0]		m_axis_tdata,
+	output reg [((C_S_AXIS_DATA_WIDTH/8))-1:0]	m_axis_tkeep,
+	output reg [C_S_AXIS_TUSER_WIDTH-1:0]		m_axis_tuser,
+	output reg					m_axis_tvalid,
+	input						m_axis_tready,
+	output reg					m_axis_tlast
+
+	
+);
+
+integer idx;
+
+/*=================================================*/
+localparam PKT_VEC_WIDTH = (6+4+2)*8*8+256;
+
+
+// input and output registers
+logic [C_S_AXIS_DATA_WIDTH-1:0]       s_axis_tdata_r;
+logic [((C_S_AXIS_DATA_WIDTH/8))-1:0] s_axis_tkeep_r;
+logic [C_S_AXIS_TUSER_WIDTH-1:0]      s_axis_tuser_r;
+logic                                 s_axis_tvalid_r;
+logic                                 s_axis_tready_r;
+logic                                 s_axis_tlast_r;
+
+logic [C_S_AXIS_DATA_WIDTH-1:0]       m_axis_tdata_r;
+logic [((C_S_AXIS_DATA_WIDTH/8))-1:0] m_axis_tkeep_r;
+logic [C_S_AXIS_TUSER_WIDTH-1:0]      m_axis_tuser_r;
+logic                                 m_axis_tvalid_r;
+logic                                 m_axis_tready_r;
+logic                                 m_axis_tlast_r;
+
+logic [31:0] vlan_drop_flags_r;
+logic [31:0] ctrl_token_r;
+
+// logic just for the first stage
+logic stg0_phv_in_valid;
+logic stg0_phv_in_valid_sv;
+logic [PKT_VEC_WIDTH-1:0] stg0_phv_in;
+logic [PKT_VEC_WIDTH-1:0] stg0_phv_in_sv;
+logic [C_VLANID_WIDTH-1:0] stg0_vlan_in;
+logic [C_VLANID_WIDTH-1:0] stg0_vlan_in_sv;
+logic stg0_vlan_valid_in;
+logic stg0_vlan_valid_in_sv;
+
+// logic parametric in the number of stages
+logic [PKT_VEC_WIDTH-1:0] stg_phv_out [NUM_OF_STAGES-2:0];
+logic [PKT_VEC_WIDTH-1:0] stg_phv_out_sv [NUM_OF_STAGES-2:0];
+logic stg_phv_out_valid [NUM_OF_STAGES-2:0];
+logic stg_phv_out_valid_sv [NUM_OF_STAGES-2:0];
+logic stg_vlan_ready [NUM_OF_STAGES-1:0];
+logic [C_VLANID_WIDTH-1:0] stg_vlan_out [NUM_OF_STAGES-2:0];
+logic [C_VLANID_WIDTH-1:0] stg_vlan_out_sv [NUM_OF_STAGES-2:0];
+logic stg_vlan_valid_out [NUM_OF_STAGES-2:0];
+logic stg_vlan_valid_out_sv [NUM_OF_STAGES-2:0];
+
+// back pressure signals
+logic s_axis_tready_p;
+logic [NUM_OF_STAGES-1:0] stg_ready;
+
+
+/*=================================================*/
+
+logic [C_VLANID_WIDTH-1:0] s_vlan_id;
+logic s_vlan_id_valid;
+
+logic [C_VLANID_WIDTH-1:0] s_vlan_id_sv;
+logic s_vlan_id_valid_sv;
+
+//NOTE: to filter out packets other than UDP/IP.
+logic [C_S_AXIS_DATA_WIDTH-1:0] s_axis_tdata_f;
+logic [(C_S_AXIS_DATA_WIDTH/8)-1:0] s_axis_tkeep_f;
+logic [C_S_AXIS_TUSER_WIDTH-1:0] s_axis_tuser_f;
+logic s_axis_tvalid_f;
+logic s_axis_tready_f;
+logic s_axis_tlast_f;
+
+logic [C_S_AXIS_DATA_WIDTH-1:0] s_axis_tdata_f_sv;
+logic [(C_S_AXIS_DATA_WIDTH/8)-1:0] s_axis_tkeep_f_sv;
+logic [C_S_AXIS_TUSER_WIDTH-1:0] s_axis_tuser_f_sv;
+logic s_axis_tvalid_f_sv;
+logic s_axis_tlast_f_sv;
+
+//NOTE: filter control packets from data packets.
+logic [C_S_AXIS_DATA_WIDTH-1:0] ctrl_s_axis_tdata [NUM_OF_STAGES+1:0];
+logic [(C_S_AXIS_DATA_WIDTH/8)-1:0] ctrl_s_axis_tkeep [NUM_OF_STAGES+1:0];
+logic [C_S_AXIS_TUSER_WIDTH-1:0] ctrl_s_axis_tuser [NUM_OF_STAGES+1:0];
+logic ctrl_s_axis_tvalid [NUM_OF_STAGES+1:0];
+logic ctrl_s_axis_tlast [NUM_OF_STAGES+1:0];
+
+logic [C_S_AXIS_DATA_WIDTH-1:0] ctrl_s_axis_tdata_sv [NUM_OF_STAGES+1:0];
+logic [(C_S_AXIS_DATA_WIDTH/8)-1:0] ctrl_s_axis_tkeep_sv [NUM_OF_STAGES+1:0];
+logic [C_S_AXIS_TUSER_WIDTH-1:0] ctrl_s_axis_tuser_sv [NUM_OF_STAGES+1:0];
+logic ctrl_s_axis_tvalid_sv [NUM_OF_STAGES+1:0];
+logic ctrl_s_axis_tlast_sv [NUM_OF_STAGES+1:0];
+
+pkt_filter #(
+	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.C_S_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH)
+)pkt_filter
+(
+	.clk			(clk),
+	.aresetn		(aresetn),
+
+	.vlan_drop_flags	(vlan_drop_flags_r),
+	.ctrl_token		(ctrl_token_r),
+
+	// input Slave AXI Stream
+	.s_axis_tdata		(s_axis_tdata_r),
+	.s_axis_tkeep		(s_axis_tkeep_r),
+	.s_axis_tuser		(s_axis_tuser_r),
+	.s_axis_tvalid		(s_axis_tvalid_r),
+	.s_axis_tready		(s_axis_tready_r),
+	.s_axis_tlast		(s_axis_tlast_r),
+
+	.vlan_id		(s_vlan_id),
+	.vlan_id_valid		(s_vlan_id_valid),
+
+	// output Master AXI Stream
+	.m_axis_tdata		(s_axis_tdata_f),
+	.m_axis_tkeep		(s_axis_tkeep_f),
+	.m_axis_tuser		(s_axis_tuser_f),
+	.m_axis_tvalid		(s_axis_tvalid_f),
+	// .m_axis_tready(s_axis_tready_f && s_axis_tready_p),
+	.m_axis_tready		(s_axis_tready_f),
+	.m_axis_tlast		(s_axis_tlast_f),
+
+	//control path
+	.c_m_axis_tdata		(ctrl_s_axis_tdata[0]),
+	.c_m_axis_tkeep		(ctrl_s_axis_tkeep[0]),
+	.c_m_axis_tuser		(ctrl_s_axis_tuser[0]),
+	.c_m_axis_tvalid	(ctrl_s_axis_tvalid[0]),
+	.c_m_axis_tlast		(ctrl_s_axis_tlast[0])
+);
+
+// we will have multiple pkt fifos and phv fifos
+// pkt fifo logics
+logic [C_S_AXIS_DATA_WIDTH-1:0] pkt_fifo_tdata_out;
+logic [C_S_AXIS_TUSER_WIDTH-1:0] pkt_fifo_tuser_out;
+logic [(C_S_AXIS_DATA_WIDTH/8)-1:0] pkt_fifo_tkeep_out;
+logic pkt_fifo_tlast_out;
+
+// output from parser
+logic [C_S_AXIS_DATA_WIDTH-1:0] parser_m_axis_tdata;
+logic [C_S_AXIS_TUSER_WIDTH-1:0] parser_m_axis_tuser;
+logic [(C_S_AXIS_DATA_WIDTH/8)-1:0] parser_m_axis_tkeep;
+logic parser_m_axis_tlast;
+logic parser_m_axis_tvalid;
+
+logic pkt_fifo_rd_en;
+logic pkt_fifo_nearly_full;
+logic pkt_fifo_empty;
+
+assign s_axis_tready_f = !pkt_fifo_nearly_full;
+// equivalent to the old:
+// assign s_axis_tready_f = !pkt_fifo_nearly_full[0] && !pkt_fifo_nearly_full[1] &&
+//                          !pkt_fifo_nearly_full[2] && !pkt_fifo_nearly_full[3];
+
+// create a fifo interposed between the parser and the data cache
+fallthrough_small_fifo #(
+	.WIDTH(C_S_AXIS_DATA_WIDTH+C_S_AXIS_TUSER_WIDTH+C_S_AXIS_DATA_WIDTH/8+1),
+	.MAX_DEPTH_BITS(C_FIFO_BIT_WIDTH)
+)
+pkt_fifo (
+	.clk			(clk),                         // input logic clk
+	.reset			(~aresetn),                    // input logic srst
+	.din			({parser_m_axis_tdata, parser_m_axis_tuser,
+				  parser_m_axis_tkeep, parser_m_axis_tlast}),     // input logic [704 : 0] din
+	.wr_en			(parser_m_axis_tvalid),     // input logic wr_en
+	.rd_en			(pkt_fifo_rd_en),           // input logic rd_en
+	.dout			({pkt_fifo_tdata_out, pkt_fifo_tuser_out,
+				  pkt_fifo_tkeep_out, pkt_fifo_tlast_out}),       // output logic [704 : 0] dout
+	.full			(),
+	.nearly_full		(pkt_fifo_nearly_full),     // output logic full
+	.empty			(pkt_fifo_empty)            // output logic empty
+);
+
+logic [PKT_VEC_WIDTH-1:0] last_stg_phv_out;
+logic [PKT_VEC_WIDTH-1:0] phv_fifo_out;
+logic last_stg_phv_out_valid;
+
+logic phv_fifo_rd_en;
+logic phv_fifo_nearly_full;
+logic phv_fifo_empty;
+logic [(PKT_VEC_WIDTH/2)-1:0] high_phv_out;
+logic [(PKT_VEC_WIDTH/2)-1:0] low_phv_out;
+
+assign phv_fifo_out = {high_phv_out, low_phv_out};
+
+// create 2 fifos (since each fifo is half the size of the phv) interposed between the phv exiting from the last stage and the phv entering the deparser
+fallthrough_small_fifo #(
+	.WIDTH(PKT_VEC_WIDTH/2),
+	.MAX_DEPTH_BITS(6)
+)
+phv_fifo_1 (
+	.clk			(clk),
+	.reset			(~aresetn),
+	.din			(last_stg_phv_out[(PKT_VEC_WIDTH/2)-1:0]),
+	.wr_en			(last_stg_phv_out_valid),
+	.rd_en			(phv_fifo_rd_en),
+	.dout			(low_phv_out),
+	.full			(),
+	.nearly_full		(phv_fifo_nearly_full),
+	.empty			(phv_fifo_empty)
+);
+
+fallthrough_small_fifo #(
+	.WIDTH(PKT_VEC_WIDTH/2),
+	.MAX_DEPTH_BITS(6)
+)
+phv_fifo_2 (
+	.clk			(clk),
+	.reset			(~aresetn),
+	.din			(last_stg_phv_out[PKT_VEC_WIDTH-1:(PKT_VEC_WIDTH/2)]),
+	.wr_en			(last_stg_phv_out_valid),
+	.rd_en			(phv_fifo_rd_en),
+	.dout			(high_phv_out),
+	.full			(),
+	.nearly_full		(),
+	.empty			()
+);
+
+parser_top #(
+	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH), //for 100g mac exclusively
+	.C_S_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH),
+	.PKT_HDR_LEN()
+)
+phv_parser
+(
+	.axis_clk		(clk),
+	.aresetn		(aresetn),
+	// input slave axi stream
+	.s_axis_tdata		(s_axis_tdata_f_sv),
+	.s_axis_tuser		(s_axis_tuser_f_sv),
+	.s_axis_tkeep		(s_axis_tkeep_f_sv),
+	// .s_axis_tvalid(s_axis_tvalid_f_sv & s_axis_tready_f),
+	.s_axis_tvalid		(s_axis_tvalid_f_sv),
+	.s_axis_tlast		(s_axis_tlast_f_sv),
+	.s_axis_tready		(s_axis_tready_p),
+
+	.s_vlan_id		(s_vlan_id_sv),
+	.s_vlan_id_valid	(s_vlan_id_valid_sv),
+
+	// output
+	.parser_valid		(stg0_phv_in_valid),
+	.pkt_hdr_vec		(stg0_phv_in),
+	.out_vlan		(stg0_vlan_in),
+	.out_vlan_valid		(stg0_vlan_valid_in),
+	.out_vlan_ready		(stg_vlan_ready[0]),
+	// 
+	.stg_ready_in		(stg_ready[0]),
+
+	// output to different pkt fifos
+	.m_axis_tdata_0		(parser_m_axis_tdata),
+	.m_axis_tuser_0		(parser_m_axis_tuser),
+	.m_axis_tkeep_0		(parser_m_axis_tkeep),
+	.m_axis_tlast_0		(parser_m_axis_tlast),
+	.m_axis_tvalid_0	(parser_m_axis_tvalid),
+	.m_axis_tready_0	(~pkt_fifo_nearly_full),
+
+	// control path
+	.ctrl_s_axis_tdata	(ctrl_s_axis_tdata_sv[0]),
+	.ctrl_s_axis_tuser	(ctrl_s_axis_tuser_sv[0]),
+	.ctrl_s_axis_tkeep	(ctrl_s_axis_tkeep_sv[0]),
+	.ctrl_s_axis_tlast	(ctrl_s_axis_tlast_sv[0]),
+	.ctrl_s_axis_tvalid	(ctrl_s_axis_tvalid_sv[0]),
+
+	.ctrl_m_axis_tdata	(ctrl_s_axis_tdata[1]),
+	.ctrl_m_axis_tuser	(ctrl_s_axis_tuser[1]),
+	.ctrl_m_axis_tkeep	(ctrl_s_axis_tkeep[1]),
+	.ctrl_m_axis_tlast	(ctrl_s_axis_tlast[1]),
+	.ctrl_m_axis_tvalid	(ctrl_s_axis_tvalid[1])
+);
+
+stage #(
+	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.STAGE_ID(0),
+	.NUM_OF_STAGES(NUM_OF_STAGES),
+	.C_S_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH)
+)
+first_stage
+(
+	.axis_clk		(clk),
+	.aresetn		(aresetn),
+
+	// input
+	.phv_in			(stg0_phv_in_sv),
+	.phv_in_valid		(stg0_phv_in_valid_sv),
+	.vlan_in		(stg0_vlan_in_sv),
+	.vlan_valid_in		(stg0_vlan_valid_in_sv),
+	.vlan_ready_out		(stg_vlan_ready[0]),
+	// output
+	.vlan_out		(stg_vlan_out[0]),
+	.vlan_valid_out		(stg_vlan_valid_out[0]),
+	.vlan_out_ready		(stg_vlan_ready[1]),
+	// output
+	.phv_out		(stg_phv_out[0]),
+	.phv_out_valid		(stg_phv_out_valid[0]),
+	// back-pressure signals
+	.stage_ready_out	(stg_ready[0]),
+	.stage_ready_in		(stg_ready[1]),
+
+	// control path
+	.c_s_axis_tdata		(ctrl_s_axis_tdata_sv[1]),
+	.c_s_axis_tuser		(ctrl_s_axis_tuser_sv[1]),
+	.c_s_axis_tkeep		(ctrl_s_axis_tkeep_sv[1]),
+	.c_s_axis_tlast		(ctrl_s_axis_tlast_sv[1]),
+	.c_s_axis_tvalid	(ctrl_s_axis_tvalid_sv[1]),
+
+	.c_m_axis_tdata		(ctrl_s_axis_tdata[2]),
+	.c_m_axis_tuser		(ctrl_s_axis_tuser[2]),
+	.c_m_axis_tkeep		(ctrl_s_axis_tkeep[2]),
+	.c_m_axis_tlast		(ctrl_s_axis_tlast[2]),
+	.c_m_axis_tvalid	(ctrl_s_axis_tvalid[2])
+);
+
+genvar i;
+generate
+	for (i=0; i<NUM_OF_STAGES+2; i=i+1) begin
+		always_ff @(posedge clk) begin
+			if (~aresetn) begin
+				ctrl_s_axis_tdata_sv[i] <= {C_S_AXIS_DATA_WIDTH{1'b 0}};
+				ctrl_s_axis_tuser_sv[i] <= {C_S_AXIS_TUSER_WIDTH{1'b 0}};
+				ctrl_s_axis_tkeep_sv[i] <= {(C_S_AXIS_DATA_WIDTH/8){1'b 0}};
+				ctrl_s_axis_tlast_sv[i] <= 0;
+				ctrl_s_axis_tvalid_sv[i] <= 0;
+			end
+			else begin
+				ctrl_s_axis_tdata_sv[i] <= ctrl_s_axis_tdata[i];
+				ctrl_s_axis_tuser_sv[i] <= ctrl_s_axis_tuser[i];
+				ctrl_s_axis_tkeep_sv[i] <= ctrl_s_axis_tkeep[i];
+				ctrl_s_axis_tlast_sv[i] <= ctrl_s_axis_tlast[i];
+				ctrl_s_axis_tvalid_sv[i] <= ctrl_s_axis_tvalid[i];
+			end
+		end
+	end
+endgenerate
+
+generate
+	for (i=0; i<NUM_OF_STAGES-1; i=i+1) begin
+		always_ff @(posedge clk) begin
+			if (~aresetn) begin
+				stg_phv_out_sv[i] <= {PKT_VEC_WIDTH{1'b 0}};
+				stg_phv_out_valid_sv[i] <= 0;
+				stg_vlan_out_sv[i] <= {C_VLANID_WIDTH{1'b 0}};
+				stg_vlan_valid_out_sv[i] <= 0;
+			end
+			else begin
+				stg_phv_out_sv[i] <= stg_phv_out[i];
+				stg_phv_out_valid_sv[i] <= stg_phv_out_valid[i];
+				stg_vlan_out_sv[i] <= stg_vlan_out[i];
+				stg_vlan_valid_out_sv[i] <= stg_vlan_valid_out[i];
+			end
+		end
+	end
+endgenerate
+
+generate
+	for (i=0; i<NUM_OF_STAGES-2; i=i+1) begin:
+		middle_stage
+		stage #(
+			.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+			.STAGE_ID(i+1),
+			.NUM_OF_STAGES(NUM_OF_STAGES),
+			.C_S_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH)
+		)
+		stage_i
+		(
+			.axis_clk		(clk),
+			.aresetn		(aresetn),
+
+			// input
+			.phv_in			(stg_phv_out_sv[i]),
+			.phv_in_valid		(stg_phv_out_valid_sv[i]),
+			.vlan_in		(stg_vlan_out_sv[i]),
+			.vlan_valid_in		(stg_vlan_valid_out_sv[i]),
+			.vlan_ready_out		(stg_vlan_ready[i+1]),
+			// output
+			.vlan_out		(stg_vlan_out[i+1]),
+			.vlan_valid_out		(stg_vlan_valid_out[i+1]),
+			.vlan_out_ready		(stg_vlan_ready[i+2]),
+			// output
+			.phv_out		(stg_phv_out[i+1]),
+			.phv_out_valid		(stg_phv_out_valid[i+1]),
+			// back-pressure signals
+			.stage_ready_out	(stg_ready[i+1]),
+			.stage_ready_in		(stg_ready[i+2]),
+
+			// control path
+			.c_s_axis_tdata		(ctrl_s_axis_tdata_sv[i+2]),
+			.c_s_axis_tuser		(ctrl_s_axis_tuser_sv[i+2]),
+			.c_s_axis_tkeep		(ctrl_s_axis_tkeep_sv[i+2]),
+			.c_s_axis_tlast		(ctrl_s_axis_tlast_sv[i+2]),
+			.c_s_axis_tvalid	(ctrl_s_axis_tvalid_sv[i+2]),
+
+			.c_m_axis_tdata		(ctrl_s_axis_tdata[i+3]),
+			.c_m_axis_tuser		(ctrl_s_axis_tuser[i+3]),
+			.c_m_axis_tkeep		(ctrl_s_axis_tkeep[i+3]),
+			.c_m_axis_tlast		(ctrl_s_axis_tlast[i+3]),
+			.c_m_axis_tvalid	(ctrl_s_axis_tvalid[i+3])
+		);
+	end
+endgenerate
+
+// [NOTICE] change to last stage
+last_stage #(
+	.C_S_AXIS_DATA_WIDTH(512),
+	//.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.STAGE_ID(NUM_OF_STAGES-1),
+	.NUM_OF_STAGES(NUM_OF_STAGES),
+	.C_S_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH)
+)
+final_stage
+(
+	.axis_clk		(clk),
+	.aresetn		(aresetn),
+
+	// input
+	.phv_in			(stg_phv_out_sv[NUM_OF_STAGES-2]),
+	.phv_in_valid		(stg_phv_out_valid_sv[NUM_OF_STAGES-2]),
+	.vlan_in		(stg_vlan_out_sv[NUM_OF_STAGES-2]),
+	.vlan_valid_in		(stg_vlan_valid_out_sv[NUM_OF_STAGES-2]),
+	.vlan_ready_out		(stg_vlan_ready[NUM_OF_STAGES-1]),
+	// back-pressure signals
+	.stage_ready_out	(stg_ready[NUM_OF_STAGES-1]),
+	// output
+	.phv_out_0		(last_stg_phv_out),
+	.phv_out_valid_0	(last_stg_phv_out_valid),
+	.phv_fifo_ready_0	(~phv_fifo_nearly_full),
+
+	// control path
+	.c_s_axis_tdata		(ctrl_s_axis_tdata_sv[NUM_OF_STAGES]),
+	.c_s_axis_tuser		(ctrl_s_axis_tuser_sv[NUM_OF_STAGES]),
+	.c_s_axis_tkeep		(ctrl_s_axis_tkeep_sv[NUM_OF_STAGES]),
+	.c_s_axis_tlast		(ctrl_s_axis_tlast_sv[NUM_OF_STAGES]),
+	.c_s_axis_tvalid	(ctrl_s_axis_tvalid_sv[NUM_OF_STAGES]),
+
+	.c_m_axis_tdata		(ctrl_s_axis_tdata[NUM_OF_STAGES+1]),
+	.c_m_axis_tuser		(ctrl_s_axis_tuser[NUM_OF_STAGES+1]),
+	.c_m_axis_tkeep		(ctrl_s_axis_tkeep[NUM_OF_STAGES+1]),
+	.c_m_axis_tlast		(ctrl_s_axis_tlast[NUM_OF_STAGES+1]),
+	.c_m_axis_tvalid	(ctrl_s_axis_tvalid[NUM_OF_STAGES+1])
+);
+
+deparser_top #(
+	.C_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.C_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH),
+	.C_PKT_VEC_WIDTH(),
+	.DEPARSER_MOD_ID()
+)
+phv_deparser (
+	.axis_clk		(clk),
+	.aresetn		(aresetn),
+
+	//data plane
+	.pkt_fifo_tdata		(pkt_fifo_tdata_out),
+	.pkt_fifo_tkeep		(pkt_fifo_tkeep_out),
+	.pkt_fifo_tuser		(pkt_fifo_tuser_out),
+	.pkt_fifo_tlast		(pkt_fifo_tlast_out),
+	.pkt_fifo_empty		(pkt_fifo_empty),
+	// output from STAGE
+	.pkt_fifo_rd_en		(pkt_fifo_rd_en),
+
+	.phv_fifo_out		(phv_fifo_out),
+	.phv_fifo_empty		(phv_fifo_empty),
+	.phv_fifo_rd_en		(phv_fifo_rd_en),
+	// output
+	.depar_out_tdata	(m_axis_tdata_r),
+	.depar_out_tkeep	(m_axis_tkeep_r),
+	.depar_out_tuser	(m_axis_tuser_r),
+	.depar_out_tvalid	(m_axis_tvalid_r),
+	.depar_out_tlast	(m_axis_tlast_r),
+	// input
+	.depar_out_tready	(m_axis_tready_r),
+
+	//control path
+	.ctrl_s_axis_tdata	(ctrl_s_axis_tdata_sv[NUM_OF_STAGES+1]),
+	.ctrl_s_axis_tuser	(ctrl_s_axis_tuser_sv[NUM_OF_STAGES+1]),
+	.ctrl_s_axis_tkeep	(ctrl_s_axis_tkeep_sv[NUM_OF_STAGES+1]),
+	.ctrl_s_axis_tvalid	(ctrl_s_axis_tvalid_sv[NUM_OF_STAGES+1]),
+	.ctrl_s_axis_tlast	(ctrl_s_axis_tlast_sv[NUM_OF_STAGES+1])
+);
+
+
+always_ff @(posedge clk) begin
+    if (~aresetn) begin
+        stg0_phv_in_valid_sv <= 0;
+        stg0_phv_in_sv <= 0;
+        stg0_vlan_in_sv <= 0;
+        stg0_vlan_valid_in_sv <= 0;
+	    
+	    s_axis_tdata_r <= 0;
+        s_axis_tkeep_r <= 0;
+        s_axis_tuser_r <= 0;
+        s_axis_tvalid_r <= 0;
+        s_axis_tready <= 0;
+        s_axis_tlast_r <= 0;
+	    
+	    m_axis_tdata <= 0;
+        m_axis_tkeep <= 0;
+        m_axis_tuser <= 0;
+        m_axis_tvalid <= 0;
+        m_axis_tready_r <= 0;
+        m_axis_tlast <= 0;
+        
+        vlan_drop_flags_r <= 0;
+        ctrl_token <= 0;
+
+        s_axis_tdata_f_sv <= 0;
+        s_axis_tkeep_f_sv <= 0;
+        s_axis_tuser_f_sv <= 0;
+        s_axis_tlast_f_sv <= 0;
+        s_axis_tvalid_f_sv <= 0;
+
+        s_vlan_id_sv <= 0;
+        s_vlan_id_valid_sv <= 0;
+    end
+    else begin
+        stg0_phv_in_valid_sv <= stg0_phv_in_valid;
+        stg0_phv_in_sv <= stg0_phv_in;
+        stg0_vlan_in_sv <= stg0_vlan_in;
+        stg0_vlan_valid_in_sv <= stg0_vlan_valid_in;
+	    
+	    s_axis_tdata_r <= s_axis_tdata;
+        s_axis_tkeep_r <= s_axis_tkeep;
+        s_axis_tuser_r <= s_axis_tuser;
+        s_axis_tvalid_r <= s_axis_tvalid & s_axis_tready;
+        s_axis_tready <= &{stg_ready, s_axis_tready_r};
+        s_axis_tlast_r <= s_axis_tlast;
+        
+	    m_axis_tdata <= m_axis_tdata_r;
+        m_axis_tkeep <= m_axis_tkeep_r;
+        m_axis_tuser <= m_axis_tuser_r;
+        m_axis_tvalid <= m_axis_tvalid_r;
+        m_axis_tready_r <= m_axis_tready;
+        m_axis_tlast <= m_axis_tlast_r;
+        
+        vlan_drop_flags_r <= vlan_drop_flags;
+        ctrl_token <= ctrl_token_r;
+
+        s_axis_tdata_f_sv <= s_axis_tdata_f;
+        s_axis_tkeep_f_sv <= s_axis_tkeep_f;
+        s_axis_tuser_f_sv <= s_axis_tuser_f;
+        s_axis_tlast_f_sv <= s_axis_tlast_f;
+        s_axis_tvalid_f_sv <= s_axis_tvalid_f;
+
+        s_vlan_id_sv <= s_vlan_id;
+        s_vlan_id_valid_sv <= s_vlan_id_valid;
+    end
+end
+
+endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/stage.v parametric_menshen/stage.v
--- menshen/stage.v	2025-05-06 16:14:21.369210000 +0200
+++ parametric_menshen/stage.v	2025-05-06 16:24:50.217223027 +0200
@@ -3,12 +3,13 @@
 module stage #(
     parameter C_S_AXIS_DATA_WIDTH = 512,
     parameter C_S_AXIS_TUSER_WIDTH = 128,
-    parameter STAGE_ID = 0,  // valid: 0-4
+    parameter STAGE_ID = 0,  // valid: 0-32
     parameter PHV_LEN = 48*8+32*8+16*8+256,
     parameter KEY_LEN = 48*2+32*2+16*2+1,
     parameter ACT_LEN = 25,
     parameter KEY_OFF = 6*3+20,
-	parameter C_VLANID_WIDTH = 12
+    parameter C_VLANID_WIDTH = 12,
+    parameter NUM_OF_STAGES = 5
 )
 (
     input									axis_clk,
@@ -45,6 +46,7 @@
 
 );
 
+wire                         key_extract_ready_out;
 //key_extract to lookup_engine
 wire [KEY_LEN-1:0]           key2lookup_key;
 wire                         key2lookup_key_valid;
@@ -102,6 +104,8 @@
 reg							act_vlan_out_valid_r;
 wire						act_vlan_ready;
 
+assign stage_ready_out = key_extract_ready_out & lookup2key_ready;
+
 always @(posedge axis_clk) begin
 	if (~aresetn) begin
 		key2lookup_key_r <= 0;
@@ -175,7 +179,7 @@
     .rst_n(aresetn),
     .phv_in(phv_in),
     .phv_valid_in(phv_in_valid),
-    .ready_out(stage_ready_out),
+    .ready_out(key_extract_ready_out),
 
 	.vlan_in				(vlan_in),
 	.vlan_in_valid			(vlan_valid_in),
@@ -210,7 +214,8 @@
     .PHV_LEN(),
     .KEY_LEN(KEY_LEN),
     .ACT_LEN(),
-    .LOOKUP_ID()
+    .LOOKUP_ID(),
+    .NUM_OF_STAGES(NUM_OF_STAGES)
 ) lookup_engine(
     .clk(axis_clk),
     .rst_n(aresetn),
@@ -252,7 +257,8 @@
 	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
     .PHV_LEN(),
     .ACT_LEN(),
-    .ACTION_ID()
+    .ACTION_ID(),
+    .C_S_AXIS_TUSER_WIDTH(C_S_AXIS_TUSER_WIDTH)
 )action_engine(
     .clk(axis_clk),
     .rst_n(aresetn),
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/tb/tb_rmt_wrapper_calc.sv parametric_menshen/tb/tb_rmt_wrapper_calc.sv
--- menshen/tb/tb_rmt_wrapper_calc.sv	1970-01-01 01:00:00.000000000 +0100
+++ parametric_menshen/tb/tb_rmt_wrapper_calc.sv	2025-05-06 16:51:43.108256295 +0200
@@ -0,0 +1,338 @@
+
+`timescale 1ns / 1ps
+
+module tb_rmt_wrapper_calc #(
+    // Slave AXI parameters
+	parameter C_S_AXI_DATA_WIDTH = 32,
+	parameter C_S_AXI_ADDR_WIDTH = 12,
+	parameter C_BASEADDR = 32'h80000000,
+	// AXI Stream parameters
+	// Slave
+	parameter C_S_AXIS_DATA_WIDTH = 512,
+	parameter C_S_AXIS_TUSER_WIDTH = 128,
+	// Master
+	parameter C_M_AXIS_DATA_WIDTH = 512,
+	// self-defined
+	parameter PHV_ADDR_WIDTH = 4
+)();
+
+reg                                 clk;
+reg                                 aresetn;
+
+reg [C_S_AXIS_DATA_WIDTH-1:0]		s_axis_tdata;
+reg [((C_S_AXIS_DATA_WIDTH/8))-1:0]	s_axis_tkeep;
+reg [C_S_AXIS_TUSER_WIDTH-1:0]		s_axis_tuser;
+reg									s_axis_tvalid;
+wire								s_axis_tready;
+reg									s_axis_tlast;
+
+wire [C_S_AXIS_DATA_WIDTH-1:0]		    m_axis_tdata;
+wire [((C_S_AXIS_DATA_WIDTH/8))-1:0]    m_axis_tkeep;
+wire [C_S_AXIS_TUSER_WIDTH-1:0]		    m_axis_tuser;
+wire								    m_axis_tvalid;
+reg										m_axis_tready;
+wire									m_axis_tlast;
+reg                                     finished_config;
+reg                                     value_detected_add;
+reg                                     value_detected_sub;
+
+//clk signal
+localparam CYCLE = 4;
+
+always begin
+    #(CYCLE/2) clk = ~clk;
+end
+//reset signal
+initial begin
+    finished_config = 0;
+    clk = 0;
+    aresetn = 1;
+    #(10);
+    aresetn = 0; //reset all the values
+    #(10);
+    aresetn = 1;
+end
+
+
+initial begin
+    #(3*CYCLE+CYCLE/2);
+    #(40* CYCLE)
+    m_axis_tready <= 1'b1;
+    s_axis_tdata <= 512'b0; 
+    s_axis_tkeep <= 64'h0;
+    s_axis_tuser <= 128'h0;
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(3*CYCLE)
+    while(~s_axis_tready)
+        #(CYCLE);
+    // conf1.txt:
+    s_axis_tdata <= 512'h00000000000000000000000000000001000000000000882f3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000500000000882a3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000100000000475e2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f01000000000fea3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000002000000006d683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000a00100000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f0200000000e03c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010002000000003d683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0200000000e13b6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+
+
+    // stateconf.txt:
+    s_axis_tdata <= 512'h000000000000000000000000000000010013000000004d542000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000200130000000049532000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000404;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000300130000000045522000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000804;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000400130000000041512000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c04;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    
+    
+    finished_config <= 1;
+    s_axis_tdata <= 512'h000000000000000002000000030000001a00000000004c4d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(1000*CYCLE);
+    if (value_detected_sub) begin
+        $display("SUB Test passed");
+    end else begin
+        $display("SUB Test failed");
+        $display("%h", m_axis_tdata);
+        $finish(0);
+    end
+    
+    // some time has passed   
+    #(1000*CYCLE)
+    s_axis_tdata <= 512'h000000000000000002000000030000000d0000000000594d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(1000*CYCLE);
+    if (value_detected_add) begin
+        $display("ADD Test passed");
+    end else begin
+        $display("ADD Test failed");
+        $display("%h", m_axis_tdata);
+        $finish(0);
+    end
+    $finish(0);
+end
+
+// Output validation
+// Define the target value you are looking for
+// SUB EXPECTED OUTPUT
+localparam logic [C_S_AXIS_DATA_WIDTH-1:0] TARGET_VALUE_SUB = 512'h000000000100000002000000030000001a00000000004c4d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+// ADD EXPECTED OUTPUT
+localparam logic [C_S_AXIS_DATA_WIDTH-1:0] TARGET_VALUE_ADD = 512'h000000000500000002000000030000000d0000000000594d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+
+
+// LOGIC TO CHECK IF THE SUB TARGET VALUE IS DETECTED
+always_ff @(posedge clk) begin
+    if (finished_config && m_axis_tvalid && m_axis_tdata == TARGET_VALUE_SUB) begin
+        value_detected_sub <= 1;
+    end
+    else begin
+        value_detected_sub <= aresetn & value_detected_sub;
+    end
+end
+
+// LOGIC TO CHECK IF THE ADD TARGET VALUE IS DETECTED
+always_ff @(posedge clk) begin
+    if (finished_config && m_axis_tvalid && m_axis_tdata == TARGET_VALUE_ADD) begin
+        value_detected_add <= 1;
+    end
+    else begin
+        value_detected_add <= aresetn & value_detected_add;
+    end
+end
+
+
+rmt_wrapper #(
+	.C_S_AXI_DATA_WIDTH(),
+	.C_S_AXI_ADDR_WIDTH(),
+	.C_BASEADDR(),
+	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.C_S_AXIS_TUSER_WIDTH(),
+	.C_M_AXIS_DATA_WIDTH(C_M_AXIS_DATA_WIDTH),
+	.PHV_ADDR_WIDTH()
+)rmt_wrapper_ins
+(
+	.clk(clk),		// axis clk
+	.aresetn(aresetn),	
+
+	// input Slave AXI Stream
+	.s_axis_tdata(s_axis_tdata),
+	.s_axis_tkeep(s_axis_tkeep),
+	.s_axis_tuser(s_axis_tuser),
+	.s_axis_tvalid(s_axis_tvalid),
+	.s_axis_tready(s_axis_tready),
+	.s_axis_tlast(s_axis_tlast),
+
+	// output Master AXI Stream
+	.m_axis_tdata(m_axis_tdata),
+	.m_axis_tkeep(m_axis_tkeep),
+	.m_axis_tuser(m_axis_tuser),
+	.m_axis_tvalid(m_axis_tvalid),
+	.m_axis_tready(m_axis_tready),
+	.m_axis_tlast(m_axis_tlast)
+	
+);
+
+endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/tb/tb_rmt_wrapper_drop.sv parametric_menshen/tb/tb_rmt_wrapper_drop.sv
--- menshen/tb/tb_rmt_wrapper_drop.sv	1970-01-01 01:00:00.000000000 +0100
+++ parametric_menshen/tb/tb_rmt_wrapper_drop.sv	2025-05-06 16:51:43.108256295 +0200
@@ -0,0 +1,303 @@
+
+`timescale 1ns / 1ps
+
+module tb_rmt_wrapper_drop #(
+    // Slave AXI parameters
+	parameter C_S_AXI_DATA_WIDTH = 32,
+	parameter C_S_AXI_ADDR_WIDTH = 12,
+	parameter C_BASEADDR = 32'h80000000,
+	// AXI Stream parameters
+	// Slave
+	parameter C_S_AXIS_DATA_WIDTH = 512,
+	parameter C_S_AXIS_TUSER_WIDTH = 128,
+	// Master
+	parameter C_M_AXIS_DATA_WIDTH = 512,
+	// self-defined
+	parameter PHV_ADDR_WIDTH = 4
+)();
+
+reg                                 clk;
+reg                                 aresetn;
+
+reg [C_S_AXIS_DATA_WIDTH-1:0]		s_axis_tdata;
+reg [((C_S_AXIS_DATA_WIDTH/8))-1:0]	s_axis_tkeep;
+reg [C_S_AXIS_TUSER_WIDTH-1:0]		s_axis_tuser;
+reg									s_axis_tvalid;
+wire								s_axis_tready;
+reg									s_axis_tlast;
+
+wire [C_S_AXIS_DATA_WIDTH-1:0]		    m_axis_tdata;
+wire [((C_S_AXIS_DATA_WIDTH/8))-1:0]    m_axis_tkeep;
+wire [C_S_AXIS_TUSER_WIDTH-1:0]		    m_axis_tuser;
+wire								    m_axis_tvalid;
+reg										m_axis_tready;
+wire									m_axis_tlast;
+reg                                     finished_config;
+
+//clk signal
+localparam CYCLE = 4;
+
+always begin
+    #(CYCLE/2) clk = ~clk;
+end
+
+//reset signal
+initial begin
+    finished_config = 0;
+    clk = 0;
+    aresetn = 1;
+    #(10);
+    aresetn = 0; //reset all the values
+    #(10);
+    aresetn = 1;
+end
+
+initial begin
+    #(3*CYCLE+CYCLE/2);
+    #(40* CYCLE)
+    m_axis_tready <= 1'b1;
+    s_axis_tdata <= 512'b0; 
+    s_axis_tkeep <= 64'h0;
+    s_axis_tuser <= 128'h0;
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(3*CYCLE)
+    while(~s_axis_tready)
+        #(CYCLE);
+    // conf1.txt:
+    s_axis_tdata <= 512'h00000000000000000000000000000001000000000000882f3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000500000000882a3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000100000000475e2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f01000000000fea3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000002000000006d683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000a00100000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f020000000073c16d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010002000000003d683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0200000000e13b6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+
+
+    // stateconf.txt:
+    s_axis_tdata <= 512'h000000000000000000000000000000010013000000004d542000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000200130000000049532000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000404;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000300130000000045522000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000804;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000400130000000041512000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c04;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    
+    
+    finished_config <= 1;
+    s_axis_tdata <= 512'h000000000000000002000000030000001a00000000004c4d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    repeat(1000)
+    begin
+        #(CYCLE);
+        if(m_axis_tvalid == 1'b1)
+        begin
+            $display ("DROP TEST FAILED");
+            $finish(0);
+        end
+    end
+    $display ("DROP TEST PASSED");
+    $finish(0);
+end
+
+
+// Output validation
+//sequence no_output;
+//    s_axis_tvalid ##1 (m_axis_tvalid == 0) throughout (!s_axis_tvalid);
+//endsequence
+
+property no_output_sim;
+    @(posedge clk) finished_config |-> !m_axis_tvalid;
+endproperty
+
+assert property (no_output_sim) else $fatal("The module tries to write an output, it should discard everything!");
+
+rmt_wrapper #(
+	.C_S_AXI_DATA_WIDTH(),
+	.C_S_AXI_ADDR_WIDTH(),
+	.C_BASEADDR(),
+	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.C_S_AXIS_TUSER_WIDTH(),
+	.C_M_AXIS_DATA_WIDTH(C_M_AXIS_DATA_WIDTH),
+	.PHV_ADDR_WIDTH()
+)rmt_wrapper_ins
+(
+	.clk(clk),		// axis clk
+	.aresetn(aresetn),	
+
+	// input Slave AXI Stream
+	.s_axis_tdata(s_axis_tdata),
+	.s_axis_tkeep(s_axis_tkeep),
+	.s_axis_tuser(s_axis_tuser),
+	.s_axis_tvalid(s_axis_tvalid),
+	.s_axis_tready(s_axis_tready),
+	.s_axis_tlast(s_axis_tlast),
+
+	// output Master AXI Stream
+	.m_axis_tdata(m_axis_tdata),
+	.m_axis_tkeep(m_axis_tkeep),
+	.m_axis_tuser(m_axis_tuser),
+	.m_axis_tvalid(m_axis_tvalid),
+	.m_axis_tready(m_axis_tready),
+	.m_axis_tlast(m_axis_tlast)
+	
+);
+
+endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/tb/tb_rmt_wrapper_modules.sv parametric_menshen/tb/tb_rmt_wrapper_modules.sv
--- menshen/tb/tb_rmt_wrapper_modules.sv	1970-01-01 01:00:00.000000000 +0100
+++ parametric_menshen/tb/tb_rmt_wrapper_modules.sv	2025-05-06 16:51:43.108256295 +0200
@@ -0,0 +1,944 @@
+
+`timescale 1ns / 1ps
+
+module tb_rmt_wrapper_modules #(
+    // Slave AXI parameters
+	parameter C_S_AXI_DATA_WIDTH = 32,
+	parameter C_S_AXI_ADDR_WIDTH = 12,
+	parameter C_BASEADDR = 32'h80000000,
+	// AXI Stream parameters
+	// Slave
+	parameter C_S_AXIS_DATA_WIDTH = 512,
+	parameter C_S_AXIS_TUSER_WIDTH = 128,
+	// Master
+	parameter C_M_AXIS_DATA_WIDTH = 512,
+	// self-defined
+	parameter PHV_ADDR_WIDTH = 4
+)();
+
+// Output validation
+// Define the target value you are looking for
+// SUB EXPECTED OUTPUT
+localparam logic [C_S_AXIS_DATA_WIDTH-1:0] TARGET_VALUE_SUB = 512'h000000000100000002000000030000001a00000000004c4d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+// ADD EXPECTED OUTPUT
+localparam logic [C_S_AXIS_DATA_WIDTH-1:0] TARGET_VALUE_ADD = 512'h000000000500000002000000030000000d0000000000594d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+// TB_STAGES EXPECTED OUTPUT
+localparam logic [C_S_AXIS_DATA_WIDTH-1:0] TARGET_VALUE_STAGES = 512'h0000000050000000050000000a0000000d00000000004c4d1a000030d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+
+reg                                 clk;
+reg                                 aresetn;
+
+reg [C_S_AXIS_DATA_WIDTH-1:0]		s_axis_tdata;
+reg [((C_S_AXIS_DATA_WIDTH/8))-1:0]	s_axis_tkeep;
+reg [C_S_AXIS_TUSER_WIDTH-1:0]		s_axis_tuser;
+reg									s_axis_tvalid;
+wire								s_axis_tready;
+reg									s_axis_tlast;
+
+wire [C_S_AXIS_DATA_WIDTH-1:0]		    m_axis_tdata;
+wire [((C_S_AXIS_DATA_WIDTH/8))-1:0]    m_axis_tkeep;
+wire [C_S_AXIS_TUSER_WIDTH-1:0]		    m_axis_tuser;
+wire								    m_axis_tvalid;
+reg										m_axis_tready;
+wire									m_axis_tlast;
+reg                                     finished_config;
+
+//clk signal
+localparam CYCLE = 4;
+
+always begin
+    #(CYCLE/2) clk = ~clk;
+end
+
+//reset signal
+initial begin
+    finished_config <= 1'b0;
+    clk = 0;
+    aresetn = 1;
+    #(10);
+    aresetn = 0; //reset all the values
+    #(10);
+    aresetn = 1;
+end
+
+
+initial begin
+    #(3*CYCLE+CYCLE/2);
+    #(40* CYCLE)
+    m_axis_tready <= 1'b1;
+    s_axis_tdata <= 512'b0; 
+    s_axis_tkeep <= 64'h0;
+    s_axis_tuser <= 128'h0;
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(3*CYCLE)
+    while(~s_axis_tready)
+        #(CYCLE);
+    // conf1.txt:
+    s_axis_tdata <= 512'h00000000000000000000000000000001000000000000882f3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000500000000882a3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000100000000475e2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f01000000000fea3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000002000000006d683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000a00100000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f0200000000e03c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010002000000003d683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0200000000e13b6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+
+
+    // conf2.txt:
+    s_axis_tdata <= 512'h00000000000000000000000000000002000000000000882e3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000200050000000088293200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000002000100000000475d2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000020f01000000000fe93700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000040002000000005d643800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000a00100000000000000000000000000000000000000002000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000040f020000000073bd6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000050002000000002d643800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000002000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000050f0200000000e1376d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+
+
+    // conf3.txt:
+    s_axis_tdata <= 512'h00000000000000000000000000000003000000000000882d3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000300050000000088283200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000003000100000000475c2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000030f01000000000fe83700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000080002000000004d603800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000a00100000000000000000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000080f020000000020256d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000090002000000001d603800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000090f020000000021246d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000003000900000000c7522300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000030f09000000000fe03700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000008000a000000000d583800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00100000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000080f0a00000000e01c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007809c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000009000a00000000cd553800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200300000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000090f0a00000000e11b6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007809c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000003001100000000c74a2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000030f11000000000fd83700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000080012000000005d503800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900100000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000080f120000000020156d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000090012000000007d4d3800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700300000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000090f120000000021146d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000003001900000000c7422300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000030f19000000000fd03700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000008001a00000000fd483800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000080f1a00000000e00c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007809c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000009001a00000000dd443800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100400000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000090f1a00000000e10b6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007809c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000003002100000000c73a2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000030f21000000000fc83700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000080022000000004d413800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000080f220000000020056d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000090022000000008d3c3800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600400000000000000000000000000003000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000090f220000000021046d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+
+
+    // stateconf.txt:
+    s_axis_tdata <= 512'h000000000000000000000000000000010013000000004d542000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000200130000000049532000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000404;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000300130000000045522000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000804;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000400130000000041512000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c04;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    
+    
+    // TEST SUB    
+    s_axis_tdata <= 512'h000000000000000002000000030000001a00000000004c4d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    @(m_axis_tvalid == 1'b1)
+    #(CYCLE/2)
+	if (m_axis_tdata == TARGET_VALUE_SUB) begin 
+        $display ("SUB TEST PASSED"); 
+    end else begin
+        $display ("SUB TEST FAILED");
+    end
+    #(30*CYCLE);
+    // TEST ADD
+    s_axis_tdata <= 512'h000000000000000002000000030000000d0000000000594d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    @(m_axis_tvalid == 1'b1)
+    #(CYCLE/2)
+	if (m_axis_tdata == TARGET_VALUE_ADD) begin 
+        $display ("ADD TEST PASSED"); 
+    end else begin
+        $display ("ADD TEST FAILED");
+    end
+    #(30*CYCLE);
+    
+    s_axis_tdata <= 512'h0000000028000000050000000a0000000d00000000004c4d1a000030d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;	
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    @(m_axis_tvalid == 1'b1)
+    #(CYCLE/2)
+	if (m_axis_tdata == TARGET_VALUE_STAGES) begin 
+        $display ("STAGES TEST PASSED"); 
+    end else begin
+        $display ("STAGES TEST FAILED");
+    end
+    #(30*CYCLE);
+    
+    s_axis_tdata <= 512'h000000000000000002000000030000001a00000000004c4d1a000020d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(4*CYCLE)
+    finished_config <= 1'b1;
+    repeat(1000)
+    begin
+        #(CYCLE);
+        if(m_axis_tvalid == 1'b1)
+        begin
+            $display ("DROP TEST FAILED");
+            $finish(0);
+        end
+    end
+    $display ("DROP TEST PASSED");
+    
+    $finish(0);
+end
+
+property no_output_sim;
+    @(posedge clk) finished_config |-> !m_axis_tvalid;
+endproperty
+
+assert property (no_output_sim) else $fatal("The module tries to write an output, it should discard everything!");
+
+rmt_wrapper #(
+	.C_S_AXI_DATA_WIDTH(),
+	.C_S_AXI_ADDR_WIDTH(),
+	.C_BASEADDR(),
+	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.C_S_AXIS_TUSER_WIDTH(),
+	.C_M_AXIS_DATA_WIDTH(C_M_AXIS_DATA_WIDTH),
+	.PHV_ADDR_WIDTH()
+)rmt_wrapper_ins
+(
+	.clk(clk),		// axis clk
+	.aresetn(aresetn),	
+
+	// input Slave AXI Stream
+	.s_axis_tdata(s_axis_tdata),
+	.s_axis_tkeep(s_axis_tkeep),
+	.s_axis_tuser(s_axis_tuser),
+	.s_axis_tvalid(s_axis_tvalid),
+	.s_axis_tready(s_axis_tready),
+	.s_axis_tlast(s_axis_tlast),
+
+	// output Master AXI Stream
+	.m_axis_tdata(m_axis_tdata),
+	.m_axis_tkeep(m_axis_tkeep),
+	.m_axis_tuser(m_axis_tuser),
+	.m_axis_tvalid(m_axis_tvalid),
+	.m_axis_tready(m_axis_tready),
+	.m_axis_tlast(m_axis_tlast)
+	
+);
+
+endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/tb/tb_rmt_wrapper_moreStages.sv parametric_menshen/tb/tb_rmt_wrapper_moreStages.sv
--- menshen/tb/tb_rmt_wrapper_moreStages.sv	1970-01-01 01:00:00.000000000 +0100
+++ parametric_menshen/tb/tb_rmt_wrapper_moreStages.sv	2025-05-06 16:51:43.108256295 +0200
@@ -0,0 +1,911 @@
+
+`timescale 1ns / 1ps
+
+module tb_rmt_wrapper_moreStages #(
+    // Slave AXI parameters
+	parameter C_S_AXI_DATA_WIDTH = 32,
+	parameter C_S_AXI_ADDR_WIDTH = 12,
+	parameter C_BASEADDR = 32'h80000000,
+	// AXI Stream parameters
+	// Slave
+	parameter C_S_AXIS_DATA_WIDTH = 512,
+	parameter C_S_AXIS_TUSER_WIDTH = 128,
+	// Master
+	parameter C_M_AXIS_DATA_WIDTH = 512,
+	// self-defined
+	parameter PHV_ADDR_WIDTH = 4
+)();
+
+reg                                 clk;
+reg                                 aresetn;
+
+reg [C_S_AXIS_DATA_WIDTH-1:0]		s_axis_tdata;
+reg [((C_S_AXIS_DATA_WIDTH/8))-1:0]	s_axis_tkeep;
+reg [C_S_AXIS_TUSER_WIDTH-1:0]		s_axis_tuser;
+reg									s_axis_tvalid;
+wire								s_axis_tready;
+reg									s_axis_tlast;
+
+wire [C_S_AXIS_DATA_WIDTH-1:0]		    m_axis_tdata;
+wire [((C_S_AXIS_DATA_WIDTH/8))-1:0]    m_axis_tkeep;
+wire [C_S_AXIS_TUSER_WIDTH-1:0]		    m_axis_tuser;
+wire								    m_axis_tvalid;
+reg										m_axis_tready;
+wire									m_axis_tlast;
+
+
+localparam logic [C_S_AXIS_DATA_WIDTH-1:0] TARGET_VALUE_STAGES= 512'h00000000100000000c000000040000000100000000004c4d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+//clk signal
+localparam CYCLE = 4;
+
+always begin
+    #(CYCLE/2) clk = ~clk;
+end
+
+//reset signal
+initial begin
+    clk = 0;
+    aresetn = 1;
+    #(10);
+    aresetn = 0; //reset all the values
+    #(10);
+    aresetn = 1;
+end
+
+
+initial begin
+    #(3*CYCLE+CYCLE/2);
+    #(40* CYCLE)
+    m_axis_tready <= 1'b1;
+    s_axis_tdata <= 512'b0; 
+    s_axis_tkeep <= 64'h0;
+    s_axis_tuser <= 128'h0;
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(3*CYCLE)
+    while(~s_axis_tready)
+        #(CYCLE);
+    // conf1.txt:
+    s_axis_tdata <= 512'h00000000000000000000000000000001000000000000882f3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000500000000882a3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000100000000475e2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f01000000000fea3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000200000000ed693800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f0200000000e03c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000200000000fd683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0200000000e13b6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000900000000c7542300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f09000000000fe23700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000a00000000ed613800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f0a0000000053e06d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00100c00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000a00000000fd603800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0a0000000053e06d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000c00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000002000a000000000d603800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000020f0a0000000073b76d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001001100000000474e2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f11000000000fda3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000001200000000fd593800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f120000000053f16d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00900800300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010012000000000d593800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f120000000053f26d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00700800300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001001900000000c7452300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f19000000000fd23700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000001a00000000cd513800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f1a00000000bbb16d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c01b00000700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001001a00000000dd503800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f1a00000000bfb06d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c01700000700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001002100000000473d2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f21000000000fca3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000002200000000ad493800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f2200000000e11c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001002200000000bd483800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f2200000000e11b6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001002900000000c7342300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f29000000000fc23700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000002a00000000ad413800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f2a000000009fa16d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c03700000700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001002a000000006d403800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f2a00000000a3a06d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c03300000700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001003100000000472d2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f31000000000fba3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000032000000003d393800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f3200000000e00c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010032000000004d383800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f3200000000e10b6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001003900000000c7242300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f39000000000fb23700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000003a000000000d323800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f3a0000000073896d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+
+
+    // stateconf.txt:
+    s_axis_tdata <= 512'h000000000000000000000000000000010013000000004d542000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000200130000000049532000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000404;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000300130000000045522000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000804;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000400130000000041512000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c04;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    
+    
+    s_axis_tdata <= 512'h000000002800000002000000000000000100000000004c4d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    
+    // Check result
+    @(m_axis_tvalid == 1'b1)
+    #(CYCLE/2)
+    if (m_axis_tdata == TARGET_VALUE_STAGES) begin
+        $display ("STAGES TEST PASSED");
+    end else begin
+        $display ("STAGES TEST FAILED");
+        @(CYCLE);
+        $finish(0);
+    end
+    #CYCLE
+    $finish(0);
+end
+
+
+rmt_wrapper #(
+	.C_S_AXI_DATA_WIDTH(),
+	.C_S_AXI_ADDR_WIDTH(),
+	.C_BASEADDR(),
+	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.C_S_AXIS_TUSER_WIDTH(),
+	.C_M_AXIS_DATA_WIDTH(C_M_AXIS_DATA_WIDTH),
+	.PHV_ADDR_WIDTH(),
+	.NUM_OF_STAGES(16)
+)rmt_wrapper_ins
+(
+	.clk(clk),		// axis clk
+	.aresetn(aresetn),	
+
+	// input Slave AXI Stream
+	.s_axis_tdata(s_axis_tdata),
+	.s_axis_tkeep(s_axis_tkeep),
+	.s_axis_tuser(s_axis_tuser),
+	.s_axis_tvalid(s_axis_tvalid),
+	.s_axis_tready(s_axis_tready),
+	.s_axis_tlast(s_axis_tlast),
+
+	// output Master AXI Stream
+	.m_axis_tdata(m_axis_tdata),
+	.m_axis_tkeep(m_axis_tkeep),
+	.m_axis_tuser(m_axis_tuser),
+	.m_axis_tvalid(m_axis_tvalid),
+	.m_axis_tready(m_axis_tready),
+	.m_axis_tlast(m_axis_tlast)
+	
+);
+
+endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/tb/tb_rmt_wrapper_stages.sv parametric_menshen/tb/tb_rmt_wrapper_stages.sv
--- menshen/tb/tb_rmt_wrapper_stages.sv	1970-01-01 01:00:00.000000000 +0100
+++ parametric_menshen/tb/tb_rmt_wrapper_stages.sv	2025-05-06 16:51:43.108256295 +0200
@@ -0,0 +1,645 @@
+
+`timescale 1ns / 1ps
+
+module tb_rmt_wrapper_stages #(
+    // Slave AXI parameters
+	parameter C_S_AXI_DATA_WIDTH = 32,
+	parameter C_S_AXI_ADDR_WIDTH = 12,
+	parameter C_BASEADDR = 32'h80000000,
+	// AXI Stream parameters
+	// Slave
+	parameter C_S_AXIS_DATA_WIDTH = 512,
+	parameter C_S_AXIS_TUSER_WIDTH = 128,
+	// Master
+	parameter C_M_AXIS_DATA_WIDTH = 512,
+	// self-defined
+	parameter PHV_ADDR_WIDTH = 4
+)();
+
+reg                                 clk;
+reg                                 aresetn;
+
+reg [C_S_AXIS_DATA_WIDTH-1:0]		s_axis_tdata;
+reg [((C_S_AXIS_DATA_WIDTH/8))-1:0]	s_axis_tkeep;
+reg [C_S_AXIS_TUSER_WIDTH-1:0]		s_axis_tuser;
+reg									s_axis_tvalid;
+wire								s_axis_tready;
+reg									s_axis_tlast;
+
+wire [C_S_AXIS_DATA_WIDTH-1:0]		    m_axis_tdata;
+wire [((C_S_AXIS_DATA_WIDTH/8))-1:0]    m_axis_tkeep;
+wire [C_S_AXIS_TUSER_WIDTH-1:0]		    m_axis_tuser;
+wire								    m_axis_tvalid;
+reg										m_axis_tready;
+wire									m_axis_tlast;
+
+
+//clk signal
+localparam CYCLE = 4;
+
+always begin
+    #(CYCLE/2) clk = ~clk;
+end
+
+//reset signal
+initial begin
+    clk = 0;
+    aresetn = 1;
+    #(10);
+    aresetn = 0; //reset all the values
+    #(10);
+    aresetn = 1;
+end
+
+
+initial begin
+	#(3*CYCLE+CYCLE/2);
+    #(40* CYCLE)
+    m_axis_tready <= 1'b1;
+    s_axis_tdata <= 512'b0; 
+    s_axis_tkeep <= 64'h0;
+    s_axis_tuser <= 128'h0;
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+	#(3*CYCLE)
+	while(~s_axis_tready)
+        #(CYCLE);
+	// conf1.txt:
+    s_axis_tdata <= 512'h00000000000000000000000000000001000000000000882f3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000500000000882a3200f2f1d204dededede6f6f6f6f0ade1140000001004600004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000100000000475e2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f01000000000fea3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000002000000006d683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000a00100000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f0200000000202d6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010002000000003d683800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0200000000212c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000900000000c7542300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f09000000000fe23700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000a000000002d603800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e00100000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f0a00000000e0246d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007809c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000a00000000ed5d3800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200300000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0a00000000e1236d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007809c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001001100000000c74c2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f11000000000fda3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000012000000007d583800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900100000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f1200000000201d6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010012000000009d553800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700300000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f1200000000211c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001001900000000c7442300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f19000000000fd23700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000001a000000001d513800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f1a00000000e0146d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007809c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001001a00000000fd4c3800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100400000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f1a00000000e1136d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007809c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001002100000000c73c2300f2f1d204dededede6f6f6f6f19de1140000001003700004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c8001;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f21000000000fca3700f2f1d204dededede6f6f6f6f05de1140000001004b00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffffffffffffffff00000000ffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000022000000006d493800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f2200000000200d6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001002200000000ad443800f2f1d204dededede6f6f6f6f04de1140000001004c00004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600400000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f2200000000210c6d00f2f1d204dededede6f6f6f6fcfdd1140000001008100004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007409c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+
+
+    // stateconf.txt:
+    s_axis_tdata <= 512'h000000000000000000000000000000010013000000004d542000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000200130000000049532000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000404;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000300130000000045522000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000804;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000400130000000041512000f2f1d204dededede6f6f6f6f1cde1140000001003400004500080504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c04;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(30*CYCLE)
+    
+    
+    // test packet
+    // padding: 00000000 bit
+    // res    : 82000000 = 40 	
+    // op_a   : a0000000 = 10
+    // op_b   : 50000000 = 5
+    // op     : 1a00 = - / 0d00 = +
+    //s_axis_tdata <= 512'h0000000026000000050000000a0000000d004c4d1a00e110d204dededede6f6f6f6f22de1140000001002e000045000801000081050403020100090000000000;	
+    s_axis_tdata <= 512'h0000000028000000050000000a0000000d00000000004c4d1a000010d204dededede6f6f6f6f22de1140000001002e0000450008050403020100090000000000;	
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    
+    // Check result
+    @(m_axis_tvalid == 1'b1)
+    #(CYCLE/2)
+    assert (m_axis_tdata[479:472] == 8'h50) $display ("TEST PASSED");
+    $finish;
+end
+
+
+rmt_wrapper #(
+	.C_S_AXI_DATA_WIDTH(),
+	.C_S_AXI_ADDR_WIDTH(),
+	.C_BASEADDR(),
+	.C_S_AXIS_DATA_WIDTH(C_S_AXIS_DATA_WIDTH),
+	.C_S_AXIS_TUSER_WIDTH(),
+	.C_M_AXIS_DATA_WIDTH(C_M_AXIS_DATA_WIDTH),
+	.PHV_ADDR_WIDTH()
+)rmt_wrapper_ins
+(
+	.clk(clk),		// axis clk
+	.aresetn(aresetn),	
+
+	// input Slave AXI Stream
+	.s_axis_tdata(s_axis_tdata),
+	.s_axis_tkeep(s_axis_tkeep),
+	.s_axis_tuser(s_axis_tuser),
+	.s_axis_tvalid(s_axis_tvalid),
+	.s_axis_tready(s_axis_tready),
+	.s_axis_tlast(s_axis_tlast),
+
+	// output Master AXI Stream
+	.m_axis_tdata(m_axis_tdata),
+	.m_axis_tkeep(m_axis_tkeep),
+	.m_axis_tuser(m_axis_tuser),
+	.m_axis_tvalid(m_axis_tvalid),
+	.m_axis_tready(m_axis_tready),
+	.m_axis_tlast(m_axis_tlast)
+	
+);
+
+endmodule
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/tb/tb_rmt_wrapper.v parametric_menshen/tb/tb_rmt_wrapper.v
--- menshen/tb/tb_rmt_wrapper.v	2025-05-06 16:14:21.370210000 +0200
+++ parametric_menshen/tb/tb_rmt_wrapper.v	2025-05-06 16:13:52.982209471 +0200
@@ -61,396 +61,628 @@
     s_axis_tvalid <= 1'b0;
     s_axis_tlast <= 1'b0;
     #(3*CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000001001355541c00f2f1d204dededede6f6f6f6f20de1140000001003000004500080f0000810504030201000b0a09080706;
+    // conf1.txt:
+    s_axis_tdata <= 512'h000000000000000000000000000000010000902f2e00f2f1d204dededede6f6f6f6f0ede1140000001004200004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000010042;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
     #CYCLE
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004; 
-    s_axis_tkeep <= 64'h0000000000000003;
-    s_axis_tuser <= 128'h0;
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010005902a2e00f2f1d204dededede6f6f6f6f0ede1140000001004200004500080f0000810504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108;
+    s_axis_tkeep <= 64'h00000000000fffff;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(3*CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000002001351531c00f2f1d204dededede6f6f6f6f20de1140000001003000004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000100014f5e1f00f2f1d204dededede6f6f6f6f1dde1140000001003300004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000010042;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
     #CYCLE
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000404; 
-    s_axis_tkeep <= 64'h0000000000000003;
-    s_axis_tuser <= 128'h0;
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0117ea3300f2f1d204dededede6f6f6f6f09de1140000001004700004500080f0000810504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(3*CYCLE)
-    s_axis_tdata <= 512'h0000000000000000000000000000000300134d521c00f2f1d204dededede6f6f6f6f20de1140000001003000004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000002056a3400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000010042;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000804; 
-    s_axis_tkeep <= 64'h0000000000000003;
-    s_axis_tuser <= 128'h0;
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(3*CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000004001349511c00f2f1d204dededede6f6f6f6f20de1140000001003000004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f0259a96900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000010042;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c04; 
-    s_axis_tkeep <= 64'h0000000000000003;
-    s_axis_tuser <= 128'h0;
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300802703000e00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(10*CYCLE)
-
-    #(30*CYCLE)
-    s_axis_tdata <= 512'h000000000000000000000000000000010000902f2e00f2f1d204dededede6f6f6f6f0ede1140000001004200004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000215693400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000010054;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108; 
-    s_axis_tkeep <= 64'h00000000000fffff;
-    s_axis_tuser <= 128'h0;
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(30*CYCLE)
-    s_axis_tdata <= 512'h000000000000000000000000000000010005902a2e00f2f1d204dededede6f6f6f6f0ede1140000001004200004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f027bc06900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000010054;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000270e250d230c910ba108; 
-    s_axis_tkeep <= 64'h00000000000fffff;
-    s_axis_tuser <= 128'h0;
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(30*CYCLE)
-    s_axis_tdata <= 512'h0000000000000000000000000000000100014f5e1f00f2f1d204dededede6f6f6f6f1dde1140000001003300004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000100094f561f00f2f1d204dededede6f6f6f6f1dde1140000001003300004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000010045;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000; 
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
     s_axis_tkeep <= 64'h000000000000001f;
-    s_axis_tuser <= 128'h0;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(30*CYCLE)
-    s_axis_tdata <= 512'h000000000000000000000000000000010f0117ea3300f2f1d204dededede6f6f6f6f09de1140000001004700004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0917e23300f2f1d204dededede6f6f6f6f09de1140000001004700004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000010059;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff; 
+    s_axis_tdata <= 512'h0000000000000000000000000000000000000000000000000000000000000000000000000000008000000000ffffffffffffffffffffffffffffffffffffffff;
     s_axis_tkeep <= 64'h0000000001ffffff;
-    s_axis_tuser <= 128'h0;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(30*CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000000000275683400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000af5613400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h0000000000000000000000000001005a;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000a00100000000000000000000000000000000000000001000; 
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000001000;
     s_axis_tkeep <= 64'h0000000003ffffff;
-    s_axis_tuser <= 128'h0;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(30*CYCLE)
-    s_axis_tdata <= 512'h000000000000000000000000000000000f02e83c6900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f0a59996900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h0000000000000000000000000001008f;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0200001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0; 
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300802f03000e00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h0;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700; 
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
     s_axis_tkeep <= 64'h0000000000007fff;
-    s_axis_tuser <= 128'h0;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(30*CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000001000245683400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001000a15613400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h0000000000000000000000000001005a;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000d00000000000000000000000000000000000000000001000; 
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
     s_axis_tkeep <= 64'h0000000003ffffff;
-    s_axis_tuser <= 128'h0;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(30*CYCLE)
-    s_axis_tdata <= 512'h000000000000000000000000000000010f02e93b6900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f0a7bb86900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h0000000000000000000000000001008f;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c003008007808c0100001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0; 
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h0;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
     #(CYCLE)
-    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700; 
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
     s_axis_tkeep <= 64'h0000000000007fff;
-    s_axis_tuser <= 128'h0;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(40*CYCLE)
-    s_axis_tdata <= 512'h000000000000000004000000020000000d009a201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000100114f4e1f00f2f1d204dededede6f6f6f6f1dde1140000001003300004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000004000000020000000d009a201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f1117da3300f2f1d204dededede6f6f6f6f09de1140000001004700004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000004000000020000000d009a201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000080ffff0000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000012055a3400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000004000000020000000d009a201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f127bb16900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000004000000020000000d009a201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-    #(5*CYCLE)
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001001215593400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f125b286900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300809701000e00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000100194f461f00f2f1d204dededede6f6f6f6f1dde1140000001003300004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f1917d23300f2f1d204dededede6f6f6f6f09de1140000001004700004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000000000000000000000000000000000000000000000000008000000000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000001af5513400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f1a7ba96900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001001a15513400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f1a5b186900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300809f01000e00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000100214f3e1f00f2f1d204dededede6f6f6f6f1dde1140000001003300004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f2117ca3300f2f1d204dededede6f6f6f6f09de1140000001004700004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000000000000000000000000000000000000000000000000008000000000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000022f5493400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f2259816900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300802f03000e00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001002215493400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f227ba06900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000100294f361f00f2f1d204dededede6f6f6f6f1dde1140000001003300004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000;
+    s_axis_tkeep <= 64'h000000000000001f;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f2917c23300f2f1d204dededede6f6f6f6f09de1140000001004700004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000000000000000000000000000000000000000000000000008000000000ffffffffffffffffffffffffffffffffffffffff;
+    s_axis_tkeep <= 64'h0000000001ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000002af5413400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000000f2a7b996900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b0;
-	#CYCLE
-    s_axis_tdata <= 512'h000000000000000002000000040000001a008d201a0013001300090000006f6f6f6fd79b1140000001002e000045000801000081a401bdfefd3c050000000000; 
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008d00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000001002a15413400f2f1d204dededede6f6f6f6f08de1140000001004800004500080f0000810504030201000b0a09080706;
     s_axis_tkeep <= 64'hffffffffffffffff;
-    s_axis_tuser <= 128'h00000000000000000000000000000040;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000;
+    s_axis_tkeep <= 64'h0000000003ffffff;
     s_axis_tvalid <= 1'b1;
     s_axis_tlast <= 1'b1;
-	// #CYCLE
-    // s_axis_tdata <= 512'h11; 
-    // s_axis_tkeep <= 64'h0000000000000001;
-    // s_axis_tuser <= 128'h00000000000000000000000000000040;
-    // s_axis_tvalid <= 1'b1;
-    // s_axis_tlast <= 1'b1;
-	#CYCLE
-	s_axis_tdata <= 0;
-	s_axis_tkeep <= 0;
-	s_axis_tuser <= 0;
-	s_axis_tvalid <= 1'b0;
-	s_axis_tlast <= 1'b0;
-
-    #(40*CYCLE);
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h000000000000000000000000000000010f2a5b086900f2f1d204dededede6f6f6f6fd3dd1140000001007d00004500080f0000810504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h000f00001e00003c0000780000f00000e00100c00300809f01000e00001e00003c0000780000f00000e00100c00300800700000f00001e00003c0000780000f0;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00000e00100c00300800700;
+    s_axis_tkeep <= 64'h0000000000007fff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    
+    
+    // stateconf.txt:
+    s_axis_tdata <= 512'h00000000000000000000000000000001001355541c00f2f1d204dededede6f6f6f6f20de1140000001003000004500080f0000810504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000002001351531c00f2f1d204dededede6f6f6f6f20de1140000001003000004500080f0000810504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000404;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h0000000000000000000000000000000300134d521c00f2f1d204dededede6f6f6f6f20de1140000001003000004500080f0000810504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000804;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000004001349511c00f2f1d204dededede6f6f6f6f20de1140000001003000004500080f0000810504030201000b0a09080706;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b0;
+    #(CYCLE)
+    s_axis_tdata <= 512'h00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c04;
+    s_axis_tkeep <= 64'h0000000000000003;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(100*CYCLE)
+    
+    
+    
+    s_axis_tdata <= 512'h0000000000000000020000000a0000000200624d1a00e110d204dededede6f6f6f6f22de1140000001002e000045000801000081050403020100090000000000;
+    s_axis_tkeep <= 64'hffffffffffffffff;
+    s_axis_tvalid <= 1'b1;
+    s_axis_tlast <= 1'b1;
+    #CYCLE
+    s_axis_tvalid <= 1'b0;
+    s_axis_tlast <= 1'b0;
+    #(10000*CYCLE);
+    $finish(0);
 end
 
 rmt_wrapper #(
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/tcl/proj_pkt_gen.tcl parametric_menshen/tcl/proj_pkt_gen.tcl
--- menshen/tcl/proj_pkt_gen.tcl	2025-05-06 16:14:21.370210000 +0200
+++ parametric_menshen/tcl/proj_pkt_gen.tcl	2025-05-06 16:13:52.983209471 +0200
@@ -2,14 +2,12 @@
 set sim_top tb/tb_pkt_gen.v
 set device xcu250-figd2104-2-e
 set proj_dir ./project_pktgen
-set public_repo_dir /home/wtao/workspace/hc20-verilog/corundum/fpga/lib_rmt/netfpga_fifo/
 
 create_project -name ${design} -force -dir "${proj_dir}" -part ${device}
 set_property source_mgmt_mode DisplayOnly [current_project]
 puts "Creating RMT 512b datawidth simulation"
 
 create_fileset -constrset -quiet constrants
-set_property ip_repo_paths ${public_repo_dir} [current_fileset]
 update_ip_catalog
 
 # dummy
@@ -97,7 +95,7 @@
 read_verilog "./deparser_top.v"
 read_verilog "./depar_do_deparsing.v"
 read_verilog "./depar_wait_segs.v"
-read_verilog "./rmt_wrapper.v"
+read_verilog "./rmt_wrapper.sv"
 read_verilog "./stage.v"
 read_verilog "./last_stage.v"
 read_verilog "./output_arbiter.v"
diff -ruN '--exclude=.git' '--exclude=p4c' menshen/tcl/proj_sim.tcl parametric_menshen/tcl/proj_sim.tcl
--- menshen/tcl/proj_sim.tcl	2025-05-06 16:14:21.370210000 +0200
+++ parametric_menshen/tcl/proj_sim.tcl	2025-05-06 16:51:43.108256295 +0200
@@ -2,22 +2,14 @@
 set sim_top tb/tb_rmt_wrapper.v
 set device xcu250-figd2104-2-e
 set proj_dir ./project_sim
-set public_repo_dir /home/wtao/workspace/hc20-verilog/corundum/fpga/lib_rmt/netfpga_fifo/
 
 create_project -name ${design} -force -dir "${proj_dir}" -part ${device}
 set_property source_mgmt_mode DisplayOnly [current_project]
 puts "Creating RMT 512b datawidth simulation"
 
 create_fileset -constrset -quiet constrants
-set_property ip_repo_paths ${public_repo_dir} [current_fileset]
 update_ip_catalog
 
-# dummy
-create_ip -name input_arbiter -vendor NetFPGA -library NetFPGA -module_name input_arbiter_ip
-set_property generate_synth_checkpoint false [get_files input_arbiter_ip.xci]
-reset_target all [get_ips input_arbiter_ip]
-generate_target all [get_ips input_arbiter_ip]
-
 source ./tcl/fifo.tcl
 
 #Add Parser Action RAM IP
@@ -74,18 +66,40 @@
 set_property generate_synth_checkpoint false [get_files page_tbl_16w_32d.xci]
 reset_target all [get_ips page_tbl_16w_32d]
 generate_target all [get_ips page_tbl_16w_32d]
-####################
 
-update_ip_catalog
 
-###
-add_files "./memory_init_files/cam_init_file.mif"
 
-###
-read_vhdl -library cam  ../xilinx_cam/dmem.vhd
-read_vhdl -library cam  [glob ../xilinx_cam/cam*.vhd]
+create_ip -name cam -vendor xilinx.com -library ip -version 2.3 -module_name cam_top
+set_property -dict [list \
+	CONFIG.MODE {CBCAM} \
+	CONFIG.NUM_ENTRIES {16} \
+	CONFIG.KEY_WIDTH {205} \
+	CONFIG.RESP_WIDTH {4} \
+	CONFIG.LOOKUP_RATE {125} \
+	CONFIG.LOOKUP_INTERFACE_FREQ {250} \
+	CONFIG.CLOCKING_MODE {SINGLE CLOCK} \
+] [get_ips cam_top]
+
+# Parametri che non sono riuscito a settare:
+# CONFIG.FLOW_CONTROL {false}
+# CONFIG.PHYSICAL_CONSTRAINTS {false}
+# CONFIG.STATISTIC {false}
+# CONFIG.MEM_TYPE {AUTO}
+# CONFIG.OPTIMIZATION {AUTO}
+# CONFIG.L_MEM_UNITS {AUTO}
+ 
+
+set_property generate_synth_checkpoint false [get_files cam_top.xci]
+reset_target all [get_ips cam_top]
+generate_target all [get_ips cam_top]
+
+
+update_ip_catalog
+####################
 
 # rmt-related
+read_verilog "./fallthrough_small_fifo.v"
+read_verilog "./small_fifo.v"
 read_verilog "./cookie.v"
 read_verilog "./pkt_filter.v"
 read_verilog "./sub_parser.v"
@@ -97,10 +111,10 @@
 read_verilog "./deparser_top.v"
 read_verilog "./depar_do_deparsing.v"
 read_verilog "./depar_wait_segs.v"
-read_verilog "./rmt_wrapper.v"
+read_verilog "./rmt_wrapper.sv"
 read_verilog "./stage.v"
 read_verilog "./last_stage.v"
-read_verilog "./output_arbiter.v"
+#read_verilog "./output_arbiter.v"
 read_verilog "./action/action_engine.v"
 read_verilog "./action/alu_1.v"
 read_verilog "./action/alu_2.v"
@@ -111,13 +125,18 @@
 read_verilog "./lookup/lookup_engine_top.v"
 read_verilog "./lookup/lke_cam_part.v"
 read_verilog "./lookup/lke_ram_part.v"
-###
-read_verilog "./tb/tb_rmt_wrapper.v"
 
-update_compile_order -fileset sources_1
+set_property SOURCE_SET sources_1 [get_filesets sim_1]
+#add_files -fileset sim_1 -norecurse tb/tb_rmt_wrapper.v
+add_files -fileset sim_1 -norecurse tb/tb_rmt_wrapper_calc.sv
+add_files -fileset sim_1 -norecurse tb/tb_rmt_wrapper_drop.sv
+add_files -fileset sim_1 -norecurse tb/tb_rmt_wrapper_modules.sv
+add_files -fileset sim_1 -norecurse tb/tb_rmt_wrapper_stages.sv
+add_files -fileset sim_1 -norecurse tb/tb_rmt_wrapper_moreStages.sv
+set_property top tb_rmt_wrapper_calc [get_filesets sim_1]
+set_property top_lib xil_defaultlib [get_filesets sim_1]
 update_compile_order -fileset sim_1
 
-set_property top ${sim_top} [get_filesets sim_1]
 set_property include_dirs ${proj_dir} [get_filesets sim_1]
 set_property simulator_language Mixed [current_project]
 set_property verilog_define { {SIMULATION=1} } [get_filesets sim_1]
@@ -140,4 +160,6 @@
 launch_simulation -simset sim_1 -mode behavioral
 run 10us
 
+
+
 exit
